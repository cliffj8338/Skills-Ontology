<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cliff Jurkiewicz - Skills Manager</title>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #0f0f1e 0%, #1a1a2e 100%);
            color: #e0e0e0;
            overflow-x: hidden;
        }
        
        .header {
            background: rgba(26, 26, 46, 0.8);
            border-bottom: 1px solid rgba(96, 165, 250, 0.2);
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .header-left h1 {
            color: #60a5fa;
            font-size: 1.8em;
            margin-bottom: 5px;
        }
        
        .header-left .subtitle {
            color: #9ca3af;
            font-size: 0.9em;
        }
        
        #statsBar {
            display: inline-flex;
            gap: 15px;
            align-items: center;
        }
        
        .stat-item {
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        #consentView {
            display: none;
            padding: 30px;
            height: 100%;
            overflow-y: auto;
        }
        
        #settingsView {
            display: none;
            padding: 30px;
            height: 100%;
            overflow-y: auto;
        }
        
        #applicationsView {
            display: none;
            padding: 30px;
            height: 100%;
            overflow-y: auto;
        }
        
        .applications-header {
            margin-bottom: 30px;
        }
        
        .applications-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .application-card {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(96, 165, 250, 0.2);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .application-card:hover {
            border-color: rgba(96, 165, 250, 0.5);
            transform: translateY(-2px);
        }
        
        .application-status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .status-applied {
            background: rgba(96, 165, 250, 0.2);
            color: #60a5fa;
        }
        
        .status-interviewing {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }
        
        .status-offer {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .status-rejected {
            background: rgba(107, 114, 128, 0.2);
            color: #9ca3af;
        }
        
        .application-title {
            font-size: 1.2em;
            color: #e0e0e0;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .application-company {
            color: #9ca3af;
            margin-bottom: 15px;
        }
        
        .application-meta-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 6px;
        }
        
        .application-meta-item {
            display: flex;
            flex-direction: column;
        }
        
        .application-meta-label {
            font-size: 0.75em;
            color: #9ca3af;
            text-transform: uppercase;
            margin-bottom: 4px;
        }
        
        .application-meta-value {
            color: #e0e0e0;
            font-size: 0.95em;
        }
        
        .application-notes {
            background: rgba(255, 255, 255, 0.03);
            border-left: 3px solid rgba(96, 165, 250, 0.5);
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #d1d5db;
            line-height: 1.5;
        }
        
        .application-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .application-btn {
            padding: 8px 14px;
            border-radius: 6px;
            border: 1px solid rgba(96, 165, 250, 0.3);
            background: rgba(96, 165, 250, 0.1);
            color: #60a5fa;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85em;
            font-weight: 500;
        }
        
        .application-btn:hover {
            background: rgba(96, 165, 250, 0.2);
            border-color: rgba(96, 165, 250, 0.5);
        }
        
        .application-btn.delete {
            border-color: rgba(239, 68, 68, 0.3);
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }
        
        .application-btn.delete:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.5);
        }
        
        .settings-input {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 1em;
            font-family: inherit;
        }
        
        .settings-input:focus {
            outline: none;
            border-color: #60a5fa;
            background: rgba(255, 255, 255, 0.08);
        }
        
        .settings-select {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 1em;
            font-family: inherit;
        }
        
        .settings-group {
            margin-bottom: 25px;
        }
        
        .settings-label {
            display: block;
            color: #60a5fa;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .settings-help {
            color: #9ca3af;
            font-size: 0.85em;
            margin-top: 5px;
        }
        
        .tag-input-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-radius: 8px;
            min-height: 45px;
        }
        
        .tag-chip {
            background: rgba(96, 165, 250, 0.2);
            color: #60a5fa;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tag-remove {
            cursor: pointer;
            color: #ef4444;
            font-weight: bold;
        }
        
        .save-settings-btn {
            width: 100%;
            padding: 15px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .save-settings-btn:hover {
            background: #059669;
            transform: translateY(-2px);
        }
        
        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .view-toggle {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-radius: 8px;
            display: flex;
            overflow: hidden;
        }
        
        .view-toggle button {
            background: transparent;
            border: none;
            color: #9ca3af;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }
        
        .view-toggle button.active {
            background: #60a5fa;
            color: #fff;
        }
        
        .export-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border: none;
            color: #fff;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
        }
        
        .controls {
            background: rgba(26, 26, 46, 0.6);
            border-bottom: 1px solid rgba(96, 165, 250, 0.1);
            padding: 15px 30px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        
        .controls-left {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .controls-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .filter-label {
            color: #9ca3af;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .role-chip {
            background: rgba(96, 165, 250, 0.1);
            border: 1px solid rgba(96, 165, 250, 0.3);
            padding: 6px 12px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85em;
        }
        
        .role-chip:hover {
            background: rgba(96, 165, 250, 0.2);
            border-color: rgba(96, 165, 250, 0.5);
        }
        
        .role-chip.active {
            background: #60a5fa;
            color: #fff;
            border-color: #60a5fa;
        }
        
        .level-filter {
            display: flex;
            gap: 8px;
        }
        
        .level-chip {
            padding: 6px 12px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85em;
            border: 1px solid transparent;
        }
        
        .level-chip.mastery {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .level-chip.mastery.active {
            background: #ef4444;
            color: #fff;
        }
        
        .level-chip.advanced {
            background: rgba(245, 158, 11, 0.2);
            border-color: rgba(245, 158, 11, 0.3);
        }
        
        .level-chip.advanced.active {
            background: #f59e0b;
            color: #fff;
        }
        
        .level-chip.proficient {
            background: rgba(16, 185, 129, 0.2);
            border-color: rgba(16, 185, 129, 0.3);
        }
        
        .level-chip.proficient.active {
            background: #10b981;
            color: #fff;
        }
        
        .label-toggle {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(96, 165, 250, 0.3);
            transition: .3s;
            border-radius: 20px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #60a5fa;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
        
        .toggle-label {
            font-size: 0.85em;
            color: #9ca3af;
        }
        
        .main-content {
            position: relative;
            height: calc(100vh - 160px);
        }
        
        #networkView {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        #cardView {
            display: none;
            padding: 30px;
            height: 100%;
            overflow-y: auto;
        }
        
        #opportunitiesView {
            display: none;
            padding: 30px;
            height: 100%;
            overflow-y: auto;
        }
        
        #blueprintView {
            display: none;
            padding: 30px;
            height: 100%;
            overflow-y: auto;
            background: linear-gradient(135deg, #0f0f1e 0%, #1a1a2e 100%);
        }
        
        .blueprint-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .blueprint-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid rgba(96, 165, 250, 0.3);
        }
        
        .blueprint-title {
            font-size: 2.5em;
            color: #60a5fa;
            margin-bottom: 10px;
        }
        
        .blueprint-subtitle {
            font-size: 1.2em;
            color: #9ca3af;
            margin-bottom: 20px;
        }
        
        .blueprint-tagline {
            font-size: 1em;
            color: #d1d5db;
            font-style: italic;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .blueprint-section {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(96, 165, 250, 0.2);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .blueprint-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(96, 165, 250, 0.2);
        }
        
        .blueprint-section-title {
            font-size: 1.5em;
            color: #60a5fa;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-icon {
            font-size: 1.3em;
        }
        
        .section-count {
            background: rgba(96, 165, 250, 0.2);
            color: #60a5fa;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: 600;
        }
        
        .coaching-tip {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(245, 158, 11, 0.1) 100%);
            border-left: 4px solid #fbbf24;
            padding: 15px 20px;
            margin-bottom: 25px;
            border-radius: 8px;
        }
        
        .coaching-tip-title {
            color: #fbbf24;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .coaching-tip-content {
            color: #d1d5db;
            font-size: 0.95em;
            line-height: 1.6;
        }
        
        .coaching-tip-content ul {
            margin: 10px 0 0 20px;
        }
        
        .coaching-tip-content li {
            margin: 5px 0;
        }
        
        .outcome-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(96, 165, 250, 0.2);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        
        .outcome-item:hover {
            border-color: rgba(96, 165, 250, 0.4);
            background: rgba(255, 255, 255, 0.05);
        }
        
        .outcome-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .outcome-text {
            flex: 1;
            font-size: 1.05em;
            color: #e0e0e0;
            line-height: 1.5;
        }
        
        .outcome-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .share-toggle {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        
        .share-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .share-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(107, 114, 128, 0.3);
            transition: .3s;
            border-radius: 26px;
        }
        
        .share-toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }
        
        .share-toggle input:checked + .share-toggle-slider {
            background-color: #10b981;
        }
        
        .share-toggle input:checked + .share-toggle-slider:before {
            transform: translateX(24px);
        }
        
        .outcome-meta {
            display: flex;
            gap: 15px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(96, 165, 250, 0.1);
            flex-wrap: wrap;
        }
        
        .meta-tag {
            font-size: 0.8em;
            padding: 4px 10px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .meta-tag.category {
            background: rgba(96, 165, 250, 0.2);
            color: #60a5fa;
        }
        
        .meta-tag.evidence {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .meta-tag.sensitive {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .outcome-coaching {
            background: rgba(251, 191, 36, 0.1);
            border-left: 3px solid #fbbf24;
            padding: 10px 15px;
            margin-top: 12px;
            border-radius: 4px;
            font-size: 0.9em;
            color: #fbbf24;
        }
        
        .outcome-actions {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }
        
        .outcome-btn {
            padding: 6px 14px;
            border-radius: 6px;
            border: 1px solid rgba(96, 165, 250, 0.3);
            background: rgba(96, 165, 250, 0.1);
            color: #60a5fa;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85em;
            font-weight: 500;
        }
        
        .outcome-btn:hover {
            background: rgba(96, 165, 250, 0.2);
            border-color: rgba(96, 165, 250, 0.5);
        }
        
        .add-outcome-btn {
            width: 100%;
            padding: 15px;
            border-radius: 8px;
            border: 2px dashed rgba(96, 165, 250, 0.3);
            background: rgba(96, 165, 250, 0.05);
            color: #60a5fa;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .add-outcome-btn:hover {
            background: rgba(96, 165, 250, 0.1);
            border-color: rgba(96, 165, 250, 0.5);
        }
        
        .reflection-prompts {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .reflection-title {
            color: #a78bfa;
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 0.95em;
        }
        
        .reflection-prompts ul {
            list-style: none;
            padding: 0;
        }
        
        .reflection-prompts li {
            color: #d1d5db;
            padding: 8px 0;
            padding-left: 20px;
            position: relative;
            font-size: 0.9em;
        }
        
        .reflection-prompts li:before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: #a78bfa;
        }
        
        .values-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .value-card {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(96, 165, 250, 0.2);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .value-card.selected {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }
        
        .value-card:hover {
            border-color: rgba(96, 165, 250, 0.5);
            transform: translateY(-2px);
        }
        
        .value-title {
            font-weight: 600;
            color: #e0e0e0;
            margin-bottom: 5px;
        }
        
        .value-description {
            font-size: 0.85em;
            color: #9ca3af;
            line-height: 1.4;
        }
        
        .purpose-editor {
            width: 100%;
            min-height: 120px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-radius: 8px;
            padding: 15px;
            color: #e0e0e0;
            font-size: 1em;
            line-height: 1.6;
            font-family: inherit;
            resize: vertical;
        }
        
        .purpose-editor:focus {
            outline: none;
            border-color: #60a5fa;
            background: rgba(255, 255, 255, 0.08);
        }
        
        .export-section {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
        }
        
        .export-title {
            color: #ef4444;
            font-size: 1.3em;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .export-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .export-btn-large {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            background: #ef4444;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .export-btn-large:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }
        
        .opportunities-header {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        
        .opportunities-title {
            font-size: 2em;
            color: #60a5fa;
            margin-bottom: 10px;
        }
        
        .opportunities-subtitle {
            color: #9ca3af;
            font-size: 1.1em;
            margin-bottom: 30px;
        }
        
        .opportunities-filters {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(96, 165, 250, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .filter-section-label {
            color: #60a5fa;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .match-slider {
            width: 200px;
        }
        
        .match-value {
            color: #fbbf24;
            font-weight: 600;
            font-size: 1.1em;
        }
        
        .opportunities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .opportunity-card {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.8) 0%, rgba(26, 26, 46, 0.6) 100%);
            border: 1px solid rgba(96, 165, 250, 0.2);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .opportunity-card:hover {
            border-color: rgba(96, 165, 250, 0.5);
            transform: translateY(-2px);
        }
        
        .opportunity-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .opportunity-company {
            font-size: 0.9em;
            color: #9ca3af;
            margin-bottom: 5px;
        }
        
        .opportunity-title {
            font-size: 1.2em;
            color: #e0e0e0;
            font-weight: 600;
            line-height: 1.3;
        }
        
        .match-score {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .match-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            font-weight: bold;
            position: relative;
        }
        
        .match-circle.high {
            background: radial-gradient(circle, rgba(16, 185, 129, 0.2) 0%, rgba(16, 185, 129, 0.05) 100%);
            border: 3px solid #10b981;
            color: #10b981;
        }
        
        .match-circle.medium {
            background: radial-gradient(circle, rgba(245, 158, 11, 0.2) 0%, rgba(245, 158, 11, 0.05) 100%);
            border: 3px solid #f59e0b;
            color: #f59e0b;
        }
        
        .match-circle.low {
            background: radial-gradient(circle, rgba(107, 114, 128, 0.2) 0%, rgba(107, 114, 128, 0.05) 100%);
            border: 3px solid #6b7280;
            color: #6b7280;
        }
        
        .match-label {
            font-size: 0.75em;
            color: #9ca3af;
            text-transform: uppercase;
        }
        
        .opportunity-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            font-size: 0.85em;
            color: #9ca3af;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .matched-skills {
            margin-bottom: 15px;
        }
        
        .matched-skills-title {
            font-size: 0.85em;
            color: #60a5fa;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .skill-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .skill-chip-match {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #10b981;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
        }
        
        .skill-chip-gap {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
        }
        
        .opportunity-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(96, 165, 250, 0.1);
        }
        
        .action-btn {
            flex: 1;
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid rgba(96, 165, 250, 0.3);
            background: rgba(96, 165, 250, 0.1);
            color: #60a5fa;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .action-btn:hover {
            background: rgba(96, 165, 250, 0.2);
            border-color: rgba(96, 165, 250, 0.5);
        }
        
        .loading-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(96, 165, 250, 0.2);
            border-top-color: #60a5fa;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .domain-card {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.8) 0%, rgba(26, 26, 46, 0.6) 100%);
            border: 1px solid rgba(96, 165, 250, 0.2);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .domain-card:hover {
            border-color: rgba(96, 165, 250, 0.5);
            transform: translateY(-2px);
        }
        
        .domain-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(96, 165, 250, 0.2);
        }
        
        .domain-icon {
            font-size: 24px;
        }
        
        .domain-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #60a5fa;
        }
        
        .skill-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border-left: 3px solid transparent;
            margin-bottom: 8px;
        }
        
        .skill-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .skill-name {
            flex: 1;
            font-size: 0.95em;
        }
        
        .skill-badge {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75em;
        }
        
        .skill-years {
            background: rgba(96, 165, 250, 0.15);
            color: #60a5fa;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75em;
            margin-left: auto;
        }
        
        /* Network styles */
        .node circle {
            stroke: #fff;
            stroke-width: 2px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .node.dimmed circle {
            opacity: 0.2;
        }
        
        .node.highlighted circle {
            stroke-width: 4px;
            filter: brightness(1.3);
        }
        
        .node text {
            font-size: 11px;
            pointer-events: none;
            text-shadow: 0 0 4px #000, 0 0 4px #000, 0 0 4px #000;
            fill: #e0e0e0;
            display: block;
        }
        
        .node text.hidden {
            display: none;
        }
        
        .node.role text {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .node.center text {
            font-size: 16px;
            font-weight: bold;
            fill: #60a5fa;
            text-shadow: 0 0 6px #000, 0 0 6px #000;
        }
        
        .node.skill text {
            font-size: 10px;
        }
        
        .link {
            stroke: #4a5568;
            stroke-opacity: 0.3;
            stroke-width: 1.5px;
            fill: none;
        }
        
        .link.dimmed {
            opacity: 0.1;
        }
        
        .link.highlighted {
            stroke: #60a5fa;
            stroke-opacity: 0.8;
            stroke-width: 2.5px;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(26, 26, 46, 0.98);
            border: 1px solid #60a5fa;
            border-radius: 8px;
            padding: 15px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            max-width: 350px;
            font-size: 13px;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .tooltip-title {
            font-weight: bold;
            color: #60a5fa;
            margin-bottom: 8px;
            font-size: 15px;
        }
        
        .tooltip-level {
            color: #fbbf24;
            font-size: 12px;
            margin-bottom: 8px;
        }
        
        .tooltip-roles {
            color: #d1d5db;
            line-height: 1.6;
        }
        
        .tooltip-role-tag {
            display: inline-block;
            background: rgba(96, 165, 250, 0.2);
            padding: 2px 8px;
            border-radius: 10px;
            margin: 2px;
            font-size: 11px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: #1a1a2e;
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-radius: 12px;
            padding: 0;
            max-width: 900px;
            max-height: 85vh;
            overflow: hidden;
            width: 90%;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 30px 30px 20px 30px;
            border-bottom: 1px solid rgba(96, 165, 250, 0.2);
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.8) 0%, rgba(26, 26, 46, 0.6) 100%);
        }
        
        .modal-header-left {
            flex: 1;
        }
        
        .modal-title {
            font-size: 1.8em;
            color: #60a5fa;
            margin-bottom: 10px;
            line-height: 1.3;
        }
        
        .modal-subtitle {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .modal-level-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .modal-level-badge.mastery {
            background: #ef4444;
            color: #fff;
        }
        
        .modal-level-badge.advanced {
            background: #f59e0b;
            color: #fff;
        }
        
        .modal-level-badge.proficient {
            background: #10b981;
            color: #fff;
        }
        
        .modal-years {
            color: #9ca3af;
            font-size: 0.9em;
        }
        
        .modal-core-badge {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #000;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 700;
        }
        
        .modal-category-badge {
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.8em;
            font-weight: 600;
            border: 1px solid currentColor;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: #9ca3af;
            font-size: 2em;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }
        
        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }
        
        .modal-section {
            margin-bottom: 30px;
        }
        
        .modal-section:last-child {
            margin-bottom: 0;
        }
        
        .modal-section-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #60a5fa;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-section-icon {
            font-size: 1.2em;
        }
        
        .evidence-list {
            list-style: none;
            padding: 0;
        }
        
        .evidence-item {
            background: rgba(96, 165, 250, 0.05);
            border-left: 3px solid #60a5fa;
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 4px;
            line-height: 1.6;
        }
        
        .evidence-item strong {
            color: #60a5fa;
        }
        
        .story-text {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 8px;
            line-height: 1.7;
            color: #d1d5db;
        }
        
        .roles-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .role-tag {
            background: rgba(96, 165, 250, 0.2);
            border: 1px solid rgba(96, 165, 250, 0.3);
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .related-skills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .related-skill-chip {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .related-skill-chip:hover {
            background: rgba(239, 68, 68, 0.2);
            transform: translateY(-2px);
        }
        
        .placeholder-text {
            color: #6b7280;
            font-style: italic;
            font-size: 0.9em;
        }
        
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .export-option {
            background: rgba(96, 165, 250, 0.1);
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .export-option:hover {
            background: rgba(96, 165, 250, 0.2);
            transform: translateY(-2px);
        }
        
        .export-option-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .export-option-desc {
            font-size: 0.85em;
            color: #9ca3af;
        }
        
        /* ===== MOBILE RESPONSIVENESS ===== */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .header-left h1 {
                font-size: 1.3em;
            }
            
            .header-right {
                width: 100%;
                flex-direction: column;
                gap: 10px;
            }
            
            .view-toggle {
                width: 100%;
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
            }
            
            .view-toggle button {
                font-size: 0.85em;
                padding: 8px 12px;
                flex: 0 1 auto;
            }
            
            .export-btn {
                width: 100%;
                justify-content: center;
            }
            
            .controls {
                flex-direction: column;
                padding: 15px;
            }
            
            .filter-group {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .role-chip {
                font-size: 0.75em;
                padding: 6px 10px;
            }
            
            .opportunities-grid {
                grid-template-columns: 1fr;
            }
            
            .opportunity-card {
                padding: 15px;
            }
            
            .opportunity-actions {
                flex-direction: column;
            }
            
            .action-btn {
                width: 100%;
            }
            
            .values-grid {
                grid-template-columns: 1fr;
            }
            
            .blueprint-section {
                padding: 20px;
            }
            
            .export-buttons {
                flex-direction: column;
            }
            
            .export-btn-large {
                width: 100%;
            }
            
            /* Network view adjustments for mobile */
            #networkView {
                touch-action: pan-x pan-y;
            }
            
            .network-controls {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .label-toggle {
                font-size: 0.75em;
            }
        }
        
        @media (max-width: 480px) {
            .header-left h1 {
                font-size: 1.1em;
            }
            
            .header-left .subtitle {
                font-size: 0.75em;
            }
            
            .view-toggle button {
                font-size: 0.75em;
                padding: 6px 10px;
            }
            
            .filter-label {
                font-size: 0.7em;
            }
            
            .role-chip {
                font-size: 0.7em;
                padding: 5px 8px;
            }
            
            .blueprint-title {
                font-size: 1.8em;
            }
            
            .blueprint-subtitle {
                font-size: 1em;
            }
            
            .modal-content {
                width: 95%;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <h1><span id="userName">Your</span> Work Blueprint</h1>
            <div class="subtitle">
                <span id="statsBar">Loading...</span>
            </div>
        </div>
        <div class="header-right">
            <div class="view-toggle">
                <button class="active" onclick="switchView('network')">Skills Ontology</button>
                <button onclick="switchView('opportunities')">Opportunities</button>
                <button onclick="switchView('applications')">Applications</button>
                <button onclick="switchView('blueprint')">Work Blueprint</button>
                <button onclick="switchView('consent')">Consent & Sharing</button>
                <button onclick="switchView('settings')">‚öôÔ∏è Settings</button>
            </div>
            <button class="export-btn" onclick="openExportModal()">üì§ Export</button>
        </div>
    </div>
    
    <div class="controls">
        <div class="controls-left">
            <div class="filter-group" id="skillsViewToggle" style="display: flex;">
                <span class="filter-label">VIEW:</span>
                <div class="role-chip active" data-view="network" onclick="toggleSkillsView('network')">Network</div>
                <div class="role-chip" data-view="card" onclick="toggleSkillsView('card')">Card</div>
            </div>
            
            <div class="filter-group" style="flex: 1; max-width: 300px;">
                <span class="filter-label">SEARCH:</span>
                <input type="text" id="skillSearch" placeholder="Search skills..." 
                       onkeyup="searchSkills(this.value)"
                       style="
                           width: 100%;
                           padding: 8px 12px;
                           background: rgba(255, 255, 255, 0.05);
                           border: 1px solid rgba(96, 165, 250, 0.3);
                           border-radius: 6px;
                           color: #e0e0e0;
                           font-size: 0.9em;
                       ">
            </div>
            
            <div class="filter-group">
                <span class="filter-label">ROLES:</span>
                <div class="role-chip active" data-role="all" onclick="filterByRole('all')">All</div>
                <div class="role-chip" data-role="strategy" onclick="filterByRole('strategy')">VP Strategy</div>
                <div class="role-chip" data-role="futurist" onclick="filterByRole('futurist')">Futurist</div>
                <div class="role-chip" data-role="pilot" onclick="filterByRole('pilot')">Pilot</div>
                <div class="role-chip" data-role="musician" onclick="filterByRole('musician')">Musician</div>
                <div class="role-chip" data-role="advocate" onclick="filterByRole('advocate')">Advocate</div>
                <div class="role-chip" data-role="tech" onclick="filterByRole('tech')">Tech</div>
                <div class="role-chip" data-role="creative" onclick="filterByRole('creative')">Creative</div>
                <div class="role-chip" data-role="operations" onclick="filterByRole('operations')">Operations</div>
                <div class="role-chip" data-role="entrepreneur" onclick="filterByRole('entrepreneur')">Entrepreneur</div>
            </div>
            
            <div class="filter-group">
                <span class="filter-label">LEVELS:</span>
                <div class="level-filter">
                    <div class="level-chip mastery" onclick="filterByLevel('mastery')">Mastery (33)</div>
                    <div class="level-chip advanced" onclick="filterByLevel('advanced')">Advanced (35)</div>
                    <div class="level-chip proficient" onclick="filterByLevel('proficient')">Proficient (3)</div>
                </div>
            </div>
        </div>
        
        <div class="controls-right" id="networkControls" style="display: flex;">
            <div class="label-toggle">
                <span class="toggle-label">Role Labels</span>
                <label class="toggle-switch">
                    <input type="checkbox" checked onchange="toggleLabels('role')">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="label-toggle">
                <span class="toggle-label">Skill Labels</span>
                <label class="toggle-switch">
                    <input type="checkbox" checked onchange="toggleLabels('skill')">
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
    </div>
    
    <div class="main-content">
        <svg id="networkView"></svg>
        <div id="cardView"></div>
        <div id="opportunitiesView"></div>
        <div id="applicationsView"></div>
        <div id="blueprintView"></div>
        <div id="consentView"></div>
        <div id="settingsView"></div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <!-- Skill Detail Modal -->
    <div class="modal" id="skillModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-header-left">
                    <h2 class="modal-title" id="skillDetailTitle"></h2>
                    <div class="modal-subtitle" id="skillDetailSubtitle"></div>
                </div>
                <button class="modal-close" onclick="closeSkillModal()">√ó</button>
            </div>
            <div class="modal-body" id="skillDetailBody"></div>
        </div>
    </div>
    
    <!-- Export Modal -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-header-left">
                    <h2 class="modal-title">Export Profile</h2>
                </div>
                <button class="modal-close" onclick="closeExportModal()">√ó</button>
            </div>
            <div class="modal-body">
                <p style="color: #9ca3af; margin-bottom: 20px;">Select a format to export your skills profile:</p>
                <div class="export-options">
                    <div class="export-option" onclick="exportProfile('resume')">
                        <div class="export-option-title">üìÑ Resume</div>
                        <div class="export-option-desc">Classic resume format</div>
                    </div>
                    <div class="export-option" onclick="exportProfile('capability')">
                        <div class="export-option-title">üéØ Capability Statement</div>
                        <div class="export-option-desc">One-page overview</div>
                    </div>
                    <div class="export-option" onclick="exportProfile('linkedin')">
                        <div class="export-option-title">üíº LinkedIn Profile</div>
                        <div class="export-option-desc">Profile sections</div>
                    </div>
                    <div class="export-option" onclick="exportProfile('interview')">
                        <div class="export-option-title">üí¨ Interview Prep</div>
                        <div class="export-option-desc">STAR stories</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== USER DATA CONFIGURATION =====
        // This will eventually come from onboarding wizard
        
        // userData now defined in v2.0 architecture below (line ~2224)
        
        // ===== MARKET VALUATION CALCULATOR =====
        
        function calculateSkillValue(skill) {
            // Individual skill values for display/prioritization only
            if (!skillValuations || !skillValuations.skillBaseValues) {
                return { value: 0, breakdown: [] };
            }
            
            const baseValue = skillValuations.skillBaseValues[skill.name] || 25000;
            const profMultiplier = skillValuations.proficiencyMultipliers[skill.level] || 1.0;
            const locationMultiplier = skillValuations.locationMultipliers[userData.profile.location] || 1.0;
            
            let demandMultiplier = 1.0;
            const skillLower = skill.name.toLowerCase();
            for (const [keyword, factor] of Object.entries(skillValuations.demandFactors)) {
                if (skillLower.includes(keyword)) {
                    demandMultiplier = Math.max(demandMultiplier, factor);
                }
            }
            
            const breakdown = [
                { label: 'Base Value', amount: baseValue, multiplier: 1.0 },
                { label: `Proficiency (${skill.level})`, amount: baseValue * profMultiplier, multiplier: profMultiplier },
                { label: `Location (${userData.profile.location})`, amount: baseValue * profMultiplier * locationMultiplier, multiplier: locationMultiplier },
                { label: `Market Demand`, amount: baseValue * profMultiplier * locationMultiplier * demandMultiplier, multiplier: demandMultiplier }
            ];
            
            // Individual skill contribution (for display)
            const finalValue = Math.round((baseValue * profMultiplier * locationMultiplier * demandMultiplier) / 10);
            
            return { value: finalValue, breakdown: breakdown };
        }
        
        function calculateTotalMarketValue() {
            if (!skillsData || !skillsData.skills || !skillValuations) {
                return { total: 0, breakdown: [], rarity: 0, baseTotal: 0 };
            }
            
            // CORRECTED MODEL: Top 10 skills ‚Üí Role tier ‚Üí Compa-ratio
            
            // Step 1: Get top 10 most valuable skills
            const skillsWithValues = skillsData.skills.map(skill => {
                const val = calculateSkillValue(skill);
                return { ...skill, calculatedValue: val.value };
            });
            
            // Sort by value and take top 10
            const top10Skills = skillsWithValues.sort((a, b) => b.calculatedValue - a.calculatedValue).slice(0, 10);
            
            // Calculate skill points ONLY from top 10
            const masteryCount = top10Skills.filter(s => s.level === 'Mastery').length;
            const advancedCount = top10Skills.filter(s => s.level === 'Advanced').length;
            const proficientCount = top10Skills.filter(s => s.level === 'Proficient').length;
            
            const totalPoints = (masteryCount * 3) + (advancedCount * 2) + (proficientCount * 1);
            
            // Step 2: Determine base market rate from role tier
            let marketRate = 0;
            let roleLevel = '';
            
            if (totalPoints >= 24) { // 8+ Mastery skills
                marketRate = 320000; // C-Suite 50th percentile
                roleLevel = 'C-Suite';
            } else if (totalPoints >= 15) { // 5+ Mastery or mix
                marketRate = 245000; // VP/Senior Director 50th percentile
                roleLevel = 'VP/Senior Director';
            } else if (totalPoints >= 10) {
                marketRate = 160000; // Director 50th percentile
                roleLevel = 'Director/Senior';
            } else if (totalPoints >= 6) {
                marketRate = 95000; // Mid-level 50th percentile
                roleLevel = 'Mid-Level Professional';
            } else {
                marketRate = 65000; // Entry 50th percentile
                roleLevel = 'Entry/Junior';
            }
            
            // Step 3: Calculate premiums (SMALL - max 25%)
            let domainPremium = 0;
            
            const hasAI = top10Skills.some(s => s.name.toLowerCase().includes('ai') || s.name.toLowerCase().includes('artificial intelligence'));
            const hasStrategy = top10Skills.some(s => s.name.toLowerCase().includes('strategy'));
            const hasExecutive = top10Skills.some(s => s.name.toLowerCase().includes('executive') || s.name.toLowerCase().includes('c-suite'));
            const hasTransformation = top10Skills.some(s => s.name.toLowerCase().includes('transformation'));
            
            if (hasAI && hasStrategy) {
                domainPremium += 0.15;
            } else if (hasAI) {
                domainPremium += 0.10;
            }
            
            if (hasExecutive && totalPoints >= 15) {
                domainPremium += 0.08;
            }
            
            if (hasTransformation) {
                domainPremium += 0.05;
            }
            
            domainPremium = Math.min(domainPremium, 0.25);
            
            // Step 4: Rarity bonus (SMALL)
            let rarityBonus = 0;
            if (hasAI && hasExecutive) {
                rarityBonus += 0.05;
            }
            if (masteryCount >= 8) {
                rarityBonus += 0.08;
            }
            
            rarityBonus = Math.min(rarityBonus, 0.15);
            
            // Step 5: Calculate "Your Worth" (100% market + premiums)
            const yourWorth = marketRate * (1 + domainPremium + rarityBonus);
            
            // Step 6: Location adjustment
            const locationMultiplier = skillValuations.locationMultipliers[userData.profile.location] || 1.0;
            const adjustedWorth = Math.round(yourWorth * locationMultiplier);
            
            // Step 7: Calculate expected offer ranges (compa-ratios)
            const conservativeOffer = Math.round(adjustedWorth * 0.75); // 75% compa-ratio
            const standardOffer = Math.round(adjustedWorth * 0.85); // 85% compa-ratio
            const competitiveOffer = Math.round(adjustedWorth * 0.95); // 95% compa-ratio
            
            // Build breakdown showing all skills for reference
            const allSkillsBreakdown = skillsData.skills.map(skill => {
                const skillVal = calculateSkillValue(skill);
                return {
                    skill: skill.name,
                    level: skill.level,
                    value: skillVal.value,
                    breakdown: skillVal.breakdown,
                    isTop10: top10Skills.some(t => t.name === skill.name)
                };
            });
            
            return {
                total: adjustedWorth,
                breakdown: allSkillsBreakdown,
                top10Skills: top10Skills.map(s => ({ skill: s.name, level: s.level, value: s.calculatedValue })),
                marketRate: marketRate,
                yourWorth: adjustedWorth,
                conservativeOffer: conservativeOffer,
                standardOffer: standardOffer,
                competitiveOffer: competitiveOffer,
                premiumAmount: Math.round(marketRate * (domainPremium + rarityBonus)),
                roleLevel: roleLevel,
                totalPoints: totalPoints,
                domainPremium: domainPremium,
                rarityBonus: rarityBonus,
                compaRatio: Math.round((adjustedWorth / marketRate) * 100)
            };
        }
        
        function getClosestRoleBenchmark(calculatedValue) {
            if (!skillValuations || !skillValuations.roleBenchmarks) {
                return null;
            }
            
            let closest = null;
            let minDiff = Infinity;
            
            Object.entries(skillValuations.roleBenchmarks).forEach(([role, data]) => {
                const diff = Math.abs(data.median - calculatedValue);
                if (diff < minDiff) {
                    minDiff = diff;
                    closest = { role, ...data };
                }
            });
            
            return closest;
        }
        
        // ===== SKILL VALUATIONS SYSTEM =====
        let skillValuations = {
            skillBaseValues: {},
            proficiencyMultipliers: { "Proficient": 1.0, "Advanced": 1.5, "Mastery": 2.2 },
            locationMultipliers: {},
            demandFactors: {},
            rarityBonuses: {},
            roleBenchmarks: {}
        };
        
        // Load skill valuations from JSON
        fetch('skill_valuations.json')
            .then(response => response.json())
            .then(data => {
                skillValuations = data;
                console.log('‚úÖ Skill valuations loaded');
                // Recalculate values if already rendered
                if (document.getElementById('totalMarketValue')) {
                    updateMarketValueDisplay();
                }
            })
            .catch(error => {
                console.warn('‚ö†Ô∏è Could not load skill valuations, using defaults:', error);
            });
        
        // Data structure
        const skillsData = {
            roles: [
                { id: "strategy", name: "VP Global Strategy", icon: "üéØ", color: "#ef4444" },
                { id: "futurist", name: "Futurist & Evangelist", icon: "üîÆ", color: "#f59e0b" },
                { id: "pilot", name: "IFR Pilot", icon: "‚úàÔ∏è", color: "#3b82f6" },
                { id: "musician", name: "Musician", icon: "üéµ", color: "#8b5cf6" },
                { id: "advocate", name: "Recovery Advocate", icon: "üíö", color: "#10b981" },
                { id: "tech", name: "Technology Strategist", icon: "‚öôÔ∏è", color: "#06b6d4" },
                { id: "creative", name: "Creative Director", icon: "üé®", color: "#ec4899" },
                { id: "operations", name: "Operations Leader", icon: "üçî", color: "#f97316" },
                { id: "entrepreneur", name: "Entrepreneur", icon: "üöÄ", color: "#a855f7" }
            ],
            
            skills: [
                // Strategic Core
                { name: "Enterprise AI Strategy", level: "Mastery", roles: ["strategy", "futurist", "tech"], key: false },
                { name: "Go-to-Market Strategy", level: "Advanced", roles: ["strategy", "tech", "entrepreneur"], key: false },
                { name: "Business Case Development", level: "Advanced", roles: ["strategy", "tech", "entrepreneur"], key: false },
                { name: "C-Suite Advisory & Influence", level: "Advanced", roles: ["strategy", "futurist"], key: false },
                { name: "Customer Advisory Board Leadership", level: "Mastery", roles: ["strategy"], key: false },
                { name: "Strategic Foresight & Market Prediction", level: "Mastery", roles: ["strategy", "futurist"], key: true },
                { name: "Organizational Transformation", level: "Advanced", roles: ["strategy", "tech", "entrepreneur"], key: false },
                { name: "Risk Assessment & Mitigation", level: "Mastery", roles: ["strategy", "pilot", "operations", "entrepreneur"], key: false },
                { name: "Revenue Pipeline Development", level: "Advanced", roles: ["strategy", "operations", "entrepreneur"], key: false },
                { name: "Financial Management & Budget Discipline", level: "Proficient", roles: ["strategy", "operations", "entrepreneur"], key: false },
                
                // Technology & Product
                { name: "AI/ML Product Strategy", level: "Mastery", roles: ["strategy", "tech", "futurist"], key: false },
                { name: "Talent Intelligence Platform Design", level: "Mastery", roles: ["strategy", "tech"], key: false },
                { name: "HR Technology Market Intelligence", level: "Mastery", roles: ["strategy", "futurist"], key: false },
                { name: "Technology Lifecycle & Disruption Analysis", level: "Mastery", roles: ["futurist", "tech"], key: false },
                { name: "Computational & Systems Thinking", level: "Advanced", roles: ["tech", "pilot"], key: false },
                { name: "Platform Integration Architecture", level: "Advanced", roles: ["tech", "entrepreneur"], key: false },
                { name: "Weak Signal Detection & Trend Recognition", level: "Mastery", roles: ["futurist", "strategy"], key: true },
                { name: "Spatial Reasoning & 3D Problem Solving", level: "Mastery", roles: ["pilot", "musician", "creative", "tech"], key: true },
                
                // Futurist & Innovation
                { name: "Technology Trend Forecasting", level: "Mastery", roles: ["futurist", "strategy"], key: true },
                { name: "Predictive Framework Development", level: "Mastery", roles: ["futurist", "strategy"], key: true },
                { name: "Disruptive Innovation Identification", level: "Mastery", roles: ["futurist", "strategy"], key: false },
                { name: "Scenario Planning & Strategic Alternatives", level: "Advanced", roles: ["strategy", "futurist"], key: false },
                { name: "Human-AI Collaboration Model Design", level: "Mastery", roles: ["futurist", "strategy"], key: true },
                
                // Communication & Influence
                { name: "Executive Narrative & Storytelling", level: "Mastery", roles: ["futurist", "strategy"], key: false },
                { name: "Technical Concept Translation", level: "Mastery", roles: ["futurist", "tech", "strategy"], key: true },
                { name: "Public Speaking & Keynote Delivery", level: "Mastery", roles: ["futurist", "musician"], key: false },
                { name: "Thought Leadership Authorship", level: "Mastery", roles: ["futurist"], key: false },
                { name: "Rhetorical Strategy & Persuasion", level: "Mastery", roles: ["futurist", "strategy"], key: false },
                { name: "Media Relations & Spokesperson Work", level: "Mastery", roles: ["futurist"], key: false },
                { name: "Podcast Production & Hosting", level: "Advanced", roles: ["futurist", "musician"], key: false },
                { name: "Real-Time Improvisation", level: "Mastery", roles: ["musician", "futurist"], key: false },
                { name: "Industry Evangelism", level: "Mastery", roles: ["futurist"], key: false },
                { name: "Teaching & Knowledge Transfer", level: "Advanced", roles: ["futurist", "advocate"], key: false },
                
                // Domain Expertise
                { name: "Talent Acquisition Strategy", level: "Mastery", roles: ["strategy"], key: false },
                { name: "Candidate Experience Architecture", level: "Mastery", roles: ["strategy"], key: true },
                { name: "AI Ethics & Responsible Implementation", level: "Advanced", roles: ["strategy", "futurist"], key: false },
                { name: "Workforce Intelligence & Analytics", level: "Mastery", roles: ["strategy"], key: false },
                { name: "Talent Marketplace Dynamics", level: "Advanced", roles: ["strategy", "futurist"], key: false },
                { name: "Behavioral Economics in Talent", level: "Advanced", roles: ["strategy", "futurist"], key: false },
                { name: "Workforce Trends & Future of Work Analysis", level: "Mastery", roles: ["futurist", "strategy"], key: false },
                { name: "Generational Workforce Analysis", level: "Advanced", roles: ["futurist", "strategy"], key: false },
                { name: "AI Impact on Human Work", level: "Mastery", roles: ["futurist", "strategy"], key: false },
                
                // Leadership & Interpersonal
                { name: "Enterprise Client Relationship Management", level: "Mastery", roles: ["strategy", "entrepreneur"], key: false },
                { name: "Strategic Team Building", level: "Advanced", roles: ["strategy", "operations", "tech", "entrepreneur"], key: false },
                { name: "Executive Mentorship", level: "Advanced", roles: ["strategy"], key: false },
                { name: "Multi-Stakeholder Alignment", level: "Advanced", roles: ["strategy", "tech", "entrepreneur"], key: false },
                { name: "Executive Presence & Authority", level: "Mastery", roles: ["strategy", "futurist"], key: false },
                { name: "Crisis Leadership & Decision Making", level: "Mastery", roles: ["pilot", "operations", "advocate", "strategy", "entrepreneur"], key: true },
                { name: "High-Pressure Performance", level: "Mastery", roles: ["pilot", "musician", "operations"], key: false },
                
                // Creative & Performance
                { name: "Creative Direction", level: "Mastery", roles: ["creative", "entrepreneur"], key: false },
                { name: "Live Musical Performance", level: "Mastery", roles: ["musician"], key: false },
                { name: "Music Composition & Arrangement", level: "Advanced", roles: ["musician"], key: false },
                { name: "Music Production & Artist Development", level: "Advanced", roles: ["musician"], key: false },
                { name: "Stage Command & Audience Connection", level: "Mastery", roles: ["musician", "futurist"], key: false },
                { name: "Performance Logistics", level: "Proficient", roles: ["musician"], key: false },
                
                // Aviation
                { name: "Single-Pilot IFR in Complex Airspace", level: "Mastery", roles: ["pilot"], key: false },
                { name: "Single-Pilot Resource Management", level: "Mastery", roles: ["pilot"], key: false },
                { name: "Weather Systems Analysis", level: "Advanced", roles: ["pilot"], key: false },
                { name: "ATC Communication & Coordination", level: "Mastery", roles: ["pilot"], key: false },
                { name: "Emergency Airmanship", level: "Mastery", roles: ["pilot"], key: true },
                { name: "Aeronautical Decision Making Under Uncertainty", level: "Mastery", roles: ["pilot"], key: false },
                { name: "Situational Awareness in Dynamic Environments", level: "Mastery", roles: ["pilot", "operations"], key: false },
                { name: "Multi-Channel Cognitive Load Management", level: "Mastery", roles: ["pilot", "operations"], key: false },
                
                // Analytical & Research
                { name: "Data-Driven Strategy Development", level: "Advanced", roles: ["strategy", "tech"], key: false },
                { name: "Market & Competitive Intelligence", level: "Advanced", roles: ["strategy", "futurist"], key: false },
                { name: "Research Synthesis & Pattern Recognition", level: "Mastery", roles: ["futurist", "strategy"], key: true },
                { name: "Critical Analysis & Evaluation", level: "Advanced", roles: ["strategy", "tech", "futurist"], key: false },
                
                // Advocacy
                { name: "Leadership Through Lived Experience", level: "Mastery", roles: ["advocate"], key: false },
                { name: "Mental Health & Addiction Advocacy", level: "Mastery", roles: ["advocate"], key: false },
                { name: "Nonprofit Founding & Operations", level: "Advanced", roles: ["advocate", "entrepreneur"], key: false },
                { name: "Authentic Leadership & Trust Building", level: "Mastery", roles: ["advocate", "futurist"], key: true },
                { name: "Culture Change & Inclusion Initiatives", level: "Advanced", roles: ["advocate"], key: false },
                { name: "Complex Problem Diagnosis & Resolution", level: "Advanced", roles: ["advocate"], key: false }
            ],
            
            skillDetails: {} // Will be loaded from skill_evidence.json
        };
        
        // ===== v2.0: USER DATA MANAGEMENT SYSTEM =====
        
        let userData = {
            initialized: false,
            profile: {
                name: "",
                email: "",
                location: "Remote"
            },
            skills: [],
            skillDetails: {},
            values: [],
            purpose: "",
            roles: [],
            preferences: {
                seniorityLevel: "Mid-Career",
                targetTitles: [],
                seniorityKeywords: ['vp', 'vice president', 'chief', 'head of', 'director', 'principal', 'senior director'],
                excludeRoles: ['engineer', 'developer', 'designer', 'analyst', 'coordinator', 'specialist', 
                              'junior', 'mid-level', 'associate', 'intern', 'entry', 'qa', 'frontend', 'backend',
                              'full stack', 'fullstack', 'software', 'devops', 'ui/ux', 'data scientist'],
                strategicKeywords: ['strategy', 'strategic', 'transformation', 'innovation', 'evangelist', 
                                   'thought leader', 'advisory', 'ai', 'ml', 'product', 'growth', 'business'],
                targetIndustries: [],
                minSalary: null,
                locationPreferences: ["US", "Remote"],
                minimumSkillMatches: 3,
                minimumMatchScore: 50
            },
            applications: []
        };
        
        let templates = {};
        let valuesLibrary = [];
        
        // Check if user has existing profile
        function checkUserProfile() {
            const saved = localStorage.getItem('workBlueprint_userData');
            if (saved) {
                try {
                    userData = JSON.parse(saved);
                    userData.initialized = true;
                    console.log('‚úì Loaded user profile:', userData.profile.name || 'User');
                    return true;
                } catch (e) {
                    console.error('Error loading profile:', e);
                    return false;
                }
            }
            return false;
        }
        
        // Save user data to localStorage
        function saveUserData() {
            try {
                localStorage.setItem('workBlueprint_userData', JSON.stringify(userData));
                console.log('‚úì Profile saved');
                return true;
            } catch (e) {
                console.error('Error saving profile:', e);
                return false;
            }
        }
        
        // Load template into userData
        function loadTemplate(templateId) {
            const template = templates[templateId];
            if (!template) {
                console.error('Template not found:', templateId);
                return false;
            }
            
            userData = {
                initialized: true,
                profile: {...template.profile},
                skills: [...template.skills],
                skillDetails: {},
                values: template.values ? [...template.values] : [],
                purpose: template.purpose || "",
                roles: [...template.roles],
                preferences: {
                    seniorityLevel: template.profile.roleLevel || "Mid-Career",
                    targetTitles: [],
                    seniorityKeywords: ['vp', 'vice president', 'chief', 'head of', 'director', 'principal', 'senior director'],
                    excludeRoles: ['engineer', 'developer', 'designer', 'analyst', 'coordinator', 'specialist', 
                                  'junior', 'mid-level', 'associate', 'intern', 'entry', 'qa', 'frontend', 'backend',
                                  'full stack', 'fullstack', 'software', 'devops', 'ui/ux', 'data scientist'],
                    strategicKeywords: ['strategy', 'strategic', 'transformation', 'innovation', 'evangelist', 
                                       'thought leader', 'advisory', 'ai', 'ml', 'product', 'growth', 'business'],
                    targetIndustries: [],
                    minSalary: null,
                    locationPreferences: ["US", "Remote"],
                    minimumSkillMatches: 3,
                    minimumMatchScore: 50
                },
                applications: []
            };
            
            // Load skill evidence if it exists
            fetch('skill_evidence.json')
                .then(response => response.json())
                .then(data => {
                    userData.skillDetails = data;
                    console.log('‚úì Loaded evidence for', Object.keys(data).length, 'skills');
                })
                .catch(error => console.log('No skill evidence file found'));
            
            saveUserData();
            console.log('‚úì Template loaded:', template.templateName);
            return true;
        }
        
        // Initialize app - check for profile or show welcome
        async function initializeApp() {
            // Load templates
            try {
                // Load v2 template with 35 skills (20 O*NET + 15 Unique)
                const cliffTemplate = await fetch('template-cliff-executive-v2.json').then(r => r.json());
                templates['cliff-executive-strategy'] = cliffTemplate;
                
                const blankTemplate = await fetch('template-blank.json').then(r => r.json());
                templates['blank'] = blankTemplate;
                
                console.log('‚úì Templates loaded (v2.0.5 - 35 skills: 20 O*NET + 15 Unique)');
            } catch (e) {
                console.error('Error loading templates:', e);
            }
            
            // Load O*NET skills library
            try {
                const onetLib = await fetch('onet-skills-library.json').then(r => r.json());
                window.onetSkillsLibrary = onetLib;
                console.log('‚úì O*NET Skills Library loaded (35 official skills)');
            } catch (e) {
                console.error('Error loading O*NET library:', e);
            }
            
            // Load values library
            try {
                const lib = await fetch('values-library.json').then(r => r.json());
                valuesLibrary = lib.values || [];
                console.log('‚úì Values library loaded:', valuesLibrary.length, 'values');
            } catch (e) {
                console.error('Error loading values library:', e);
            }
            
            // Check if user has profile
            if (checkUserProfile()) {
                // User exists, load main app
                console.log('‚úì User profile found');
                initializeMainApp();
            } else {
                // NEW USER: Auto-load Cliff's template (skip wizard for now)
                console.log('‚ö° New user - auto-loading Executive Strategy template');
                loadTemplate('cliff-executive-strategy');
                initializeMainApp();
            }
        }
        
        // Show welcome screen for new users
        function showWelcomeScreen() {
            console.log('üìã Showing welcome screen');
            console.log('Available templates:', Object.keys(templates));
            
            // Create welcome overlay (don't destroy existing DOM/scripts)
            const welcomeDiv = document.createElement('div');
            welcomeDiv.id = 'welcomeScreen';
            welcomeDiv.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: linear-gradient(135deg, #0f1419 0%, #1a1f2e 100%);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            welcomeDiv.innerHTML = `
                <div style="max-width: 800px; margin: 100px auto; padding: 40px; text-align: center;">
                    <h1 style="font-size: 3em; margin-bottom: 20px; color: #e0e0e0;">
                        üìã Work Blueprint v2.0
                    </h1>
                    <p style="font-size: 1.3em; color: #9ca3af; margin-bottom: 50px;">
                        Your Career Management Platform
                    </p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px;">
                        <div onclick="startWithTemplate('blank')" style="background: rgba(96, 165, 250, 0.1); padding: 40px; border-radius: 12px; cursor: pointer; border: 2px solid rgba(96, 165, 250, 0.3); transition: all 0.3s;" onmouseover="this.style.borderColor='#60a5fa'" onmouseout="this.style.borderColor='rgba(96, 165, 250, 0.3)'">
                            <div style="font-size: 3em; margin-bottom: 15px;">‚ú®</div>
                            <h3 style="color: #60a5fa; margin-bottom: 15px;">Start Fresh</h3>
                            <p style="color: #9ca3af; font-size: 0.95em;">
                                Build your profile from scratch. Add your own skills, values, and experience.
                            </p>
                        </div>
                        
                        <div onclick="startWithTemplate('cliff-executive-strategy')" style="background: rgba(16, 185, 129, 0.1); padding: 40px; border-radius: 12px; cursor: pointer; border: 2px solid rgba(16, 185, 129, 0.3); transition: all 0.3s;" onmouseover="this.style.borderColor='#10b981'" onmouseout="this.style.borderColor='rgba(16, 185, 129, 0.3)'">
                            <div style="font-size: 3em; margin-bottom: 15px;">üéØ</div>
                            <h3 style="color: #10b981; margin-bottom: 15px;">Use Template</h3>
                            <p style="color: #9ca3af; font-size: 0.95em;">
                                <strong>Executive Strategy Template</strong><br>
                                VP-level with 50 curated skills. Customize from there.
                            </p>
                        </div>
                    </div>
                    
                    <div style="text-align: center;">
                        <label style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 8px; cursor: pointer; display: inline-block; border: 2px dashed rgba(255, 255, 255, 0.2);">
                            <div style="color: #9ca3af; margin-bottom: 10px;">üìÅ Import Saved Profile</div>
                            <input type="file" accept=".json" onchange="importProfile(event)" style="display: none;">
                            <div style="color: #60a5fa; font-size: 0.9em;">Click to select JSON file</div>
                        </label>
                    </div>
                </div>
            `;
            
            // Append to body (don't replace body - keeps JavaScript intact!)
            document.body.appendChild(welcomeDiv);
            
            // Hide all other content
            document.querySelectorAll('body > *:not(#welcomeScreen):not(script)').forEach(el => {
                el.style.display = 'none';
            });
        }
        
        // Start with selected template
        window.startWithTemplate = function(templateId) {
            console.log('üéØ Starting with template:', templateId);
            
            if (!templates[templateId]) {
                alert('Template not found. Please refresh the page and try again.');
                return;
            }
            
            if (loadTemplate(templateId)) {
                console.log('‚úì Template loaded successfully');
                
                // If blank, show onboarding wizard
                if (templateId === 'blank') {
                    showOnboardingWizard();
                } else {
                    // Force hard reload with cache bypass
                    console.log('üîÑ Reloading page...');
                    window.location.href = window.location.href.split('?')[0] + '?t=' + Date.now();
                }
            } else {
                alert('Failed to load template. Please try again.');
            }
        };
        
        // Import profile from JSON file
        window.importProfile = function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    userData = imported;
                    userData.initialized = true;
                    saveUserData();
                    location.reload();
                } catch (error) {
                    alert('Error importing profile: ' + error.message);
                }
            };
            reader.readAsText(file);
        };
        
        // Show onboarding wizard for blank profiles
        function showOnboardingWizard() {
            // For now, just reload to main app - wizard coming in next phase
            alert('Quick setup: Add your name and location in Settings, then start adding skills!');
            location.reload();
        }
        
        // Initialize main app with user data
        function initializeMainApp() {
            // Replace skillsData with userData
            skillsData.skills = userData.skills || [];
            skillsData.roles = userData.roles || skillsData.roles;
            skillsData.skillDetails = userData.skillDetails || {};
            
            // Continue with normal app initialization
            console.log('‚úì Main app initialized with', userData.skills.length, 'skills');
        }
        
        // Export current profile
        function exportUserProfile() {
            const dataStr = JSON.stringify(userData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `work-blueprint-${userData.profile.name || 'profile'}-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }
        
        // ===== END v2.0 USER DATA MANAGEMENT =====
        
        // Load skill evidence dynamically
        fetch('skill_evidence.json')
            .then(response => response.json())
            .then(data => {
                skillsData.skillDetails = data;
                console.log('‚úì Loaded evidence for', Object.keys(data).length, 'skills');
            })
            .catch(error => console.error('Error loading skill evidence:', error));

        const levelColors = {
            "Mastery": "#ef4444",
            "Advanced": "#f59e0b",
            "Proficient": "#10b981"
        };

        let currentView = 'network';
        let activeRole = 'all';
        let activeLevel = null;
        let simulation;

        function initNetwork() {
            const width = window.innerWidth;
            const height = window.innerHeight - 160;
            
            const svg = d3.select("#networkView")
                .attr("width", width)
                .attr("height", height);

            svg.selectAll("*").remove();

            // Create nodes
            const nodes = [
                { id: "center", name: "Cliff Jurkiewicz", type: "center", x: width/2, y: height/2, fx: width/2, fy: height/2 }
            ];

            // Add role nodes
            skillsData.roles.forEach((role, i) => {
                const angle = (i / skillsData.roles.length) * 2 * Math.PI;
                const radius = 200;
                nodes.push({
                    id: role.id,
                    name: role.name,
                    type: "role",
                    color: role.color,
                    x: width/2 + Math.cos(angle) * radius,
                    y: height/2 + Math.sin(angle) * radius
                });
            });

            // Add skill nodes
            skillsData.skills.forEach((skill, i) => {
                nodes.push({
                    id: `skill-${i}`,
                    name: skill.name,
                    type: "skill",
                    level: skill.level,
                    roles: skill.roles,
                    key: skill.key
                });
            });

            // Create links
            const links = [];
            
            // Center to roles
            skillsData.roles.forEach(role => {
                links.push({ source: "center", target: role.id, type: "role" });
            });

            // Roles to skills
            skillsData.skills.forEach((skill, i) => {
                skill.roles.forEach(roleId => {
                    links.push({ 
                        source: roleId, 
                        target: `skill-${i}`,
                        type: "skill"
                    });
                });
            });

            // Create simulation
            simulation = d3.forceSimulation(nodes)
                .force("link", d3.forceLink(links).id(d => d.id).distance(d => {
                    if (d.type === "role") return 140;  // Center to roles - balanced
                    return 160;  // Roles to skills - not too far
                }))
                .force("charge", d3.forceManyBody().strength(d => {
                    if (d.type === "center") return 0;
                    if (d.type === "role") return -250;  // Moderate repulsion
                    return -180;  // Skills push away moderately
                }))
                .force("center", d3.forceCenter(width / 2, height / 2))
                .force("collision", d3.forceCollide().radius(d => {
                    if (d.type === "center") return 70;
                    if (d.type === "role") return 65;  // Prevent overlap
                    return 45;  // Skills collision
                }))
                .force("x", d3.forceX(width / 2).strength(0.08))  // Stronger pull to center
                .force("y", d3.forceY(height / 2).strength(0.08))  // Keep things on screen
                .force("radial", d3.forceRadial(d => {
                    // Keep skills within viewport bounds
                    if (d.type === "skill") return Math.min(width, height) * 0.4;
                    return 0;
                }).strength(0.1));

            // Draw links
            const link = svg.append("g")
                .selectAll("line")
                .data(links)
                .join("line")
                .attr("class", "link");

            // Draw nodes
            const node = svg.append("g")
                .selectAll("g")
                .data(nodes)
                .join("g")
                .attr("class", d => `node ${d.type}`)
                .call(d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended));

            node.append("circle")
                .attr("r", d => {
                    if (d.type === "center") return 40;
                    if (d.type === "role") return 30;
                    return d.key ? 12 : 8;
                })
                .attr("fill", d => {
                    if (d.type === "center") return "#60a5fa";
                    if (d.type === "role") return d.color;
                    return levelColors[d.level];
                })
                .on("click", (event, d) => {
                    if (d.type === "role") {
                        filterByRole(d.id);
                    } else if (d.type === "skill") {
                        event.stopPropagation();
                        openSkillModal(d.name, d);
                    }
                })
                .on("mouseover", (event, d) => showTooltip(event, d))
                .on("mouseout", hideTooltip);

            node.append("text")
                .each(function(d) {
                    if (d.type === 'skill') {
                        // Split long skill names into multiple lines
                        const words = d.name.split(' ');
                        const maxWidth = 15; // characters per line
                        let lines = [];
                        let currentLine = '';
                        
                        words.forEach(word => {
                            if ((currentLine + ' ' + word).length > maxWidth && currentLine.length > 0) {
                                lines.push(currentLine);
                                currentLine = word;
                            } else {
                                currentLine = currentLine ? currentLine + ' ' + word : word;
                            }
                        });
                        if (currentLine) lines.push(currentLine);
                        
                        // Create tspan for each line
                        const text = d3.select(this);
                        lines.forEach((line, i) => {
                            text.append('tspan')
                                .text(line)
                                .attr('x', 0)
                                .attr('dy', i === 0 ? -13 - (lines.length - 1) * 5 : 10)
                                .attr('text-anchor', 'middle');
                        });
                    } else {
                        // Single line for center and role nodes
                        d3.select(this)
                            .text(d.name)
                            .attr("x", 0)
                            .attr("y", d => {
                                if (d.type === "center") return -45;
                                if (d.type === "role") return -35;
                                return -13;
                            })
                            .attr("text-anchor", "middle");
                    }
                });

            simulation.on("tick", () => {
                // Constrain nodes to viewport with padding
                const padding = 100;
                nodes.forEach(d => {
                    if (d.type !== "center") {  // Don't constrain center node
                        d.x = Math.max(padding, Math.min(width - padding, d.x));
                        d.y = Math.max(padding, Math.min(height - padding, d.y));
                    }
                });
                
                link
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);

                node.attr("transform", d => `translate(${d.x},${d.y})`);
            });

            window.networkData = { nodes, links, svg, link, node };
        }

        function initCardView() {
            const cardView = document.getElementById('cardView');
            
            // Group skills by domain
            const domains = {
                "Strategic Core": { icon: "üéØ", skills: [] },
                "Technology & Product": { icon: "‚öôÔ∏è", skills: [] },
                "Futurist & Innovation": { icon: "üîÆ", skills: [] },
                "Communication & Influence": { icon: "üì£", skills: [] },
                "Domain Expertise": { icon: "üéì", skills: [] },
                "Leadership & Interpersonal": { icon: "üë•", skills: [] },
                "Creative & Performance": { icon: "üéµ", skills: [] },
                "Aviation & Operational": { icon: "‚úàÔ∏è", skills: [] },
                "Analytical & Research": { icon: "üî¨", skills: [] },
                "Advocacy & Lived Experience": { icon: "üíö", skills: [] }
            };
            
            // Categorize skills
            skillsData.skills.forEach(skill => {
                const skillName = skill.name;
                
                if (skillName.includes("Strategy") || skillName.includes("Business") || skillName.includes("Revenue") || skillName.includes("Financial") || skillName.includes("Risk") || skillName.includes("Advisory") || skillName.includes("Transformation")) {
                    domains["Strategic Core"].skills.push(skill);
                } else if (skillName.includes("AI/ML") || skillName.includes("Technology") || skillName.includes("Platform") || skillName.includes("Computational") || skillName.includes("Integration") || skillName.includes("Spatial")) {
                    domains["Technology & Product"].skills.push(skill);
                } else if (skillName.includes("Trend") || skillName.includes("Predictive") || skillName.includes("Innovation") || skillName.includes("Scenario") || skillName.includes("Human-AI") || skillName.includes("Weak Signal")) {
                    domains["Futurist & Innovation"].skills.push(skill);
                } else if (skillName.includes("Narrative") || skillName.includes("Translation") || skillName.includes("Speaking") || skillName.includes("Authorship") || skillName.includes("Rhetorical") || skillName.includes("Media") || skillName.includes("Podcast") || skillName.includes("Improvisation") || skillName.includes("Evangelism") || skillName.includes("Teaching")) {
                    domains["Communication & Influence"].skills.push(skill);
                } else if (skillName.includes("Talent") || skillName.includes("Candidate") || skillName.includes("Ethics") || skillName.includes("Workforce") || skillName.includes("Marketplace") || skillName.includes("Behavioral") || skillName.includes("Future of Work") || skillName.includes("Generational") || skillName.includes("AI Impact")) {
                    domains["Domain Expertise"].skills.push(skill);
                } else if (skillName.includes("Client Relationship") || skillName.includes("Team Building") || skillName.includes("Mentorship") || skillName.includes("Stakeholder") || skillName.includes("Executive Presence") || skillName.includes("Crisis Leadership") || skillName.includes("High-Pressure")) {
                    domains["Leadership & Interpersonal"].skills.push(skill);
                } else if (skillName.includes("Creative") || skillName.includes("Musical") || skillName.includes("Music") || skillName.includes("Stage") || skillName.includes("Performance Logistics")) {
                    domains["Creative & Performance"].skills.push(skill);
                } else if (skillName.includes("Pilot") || skillName.includes("IFR") || skillName.includes("Weather") || skillName.includes("ATC") || skillName.includes("Emergency") || skillName.includes("Aeronautical") || skillName.includes("Situational Awareness") || skillName.includes("Cognitive Load")) {
                    domains["Aviation & Operational"].skills.push(skill);
                } else if (skillName.includes("Data-Driven") || skillName.includes("Market") || skillName.includes("Research") || skillName.includes("Critical Analysis")) {
                    domains["Analytical & Research"].skills.push(skill);
                } else if (skillName.includes("Recovery") || skillName.includes("Mental Health") || skillName.includes("Nonprofit") || skillName.includes("Vulnerability") || skillName.includes("Stigma") || skillName.includes("Diagnosis")) {
                    domains["Advocacy & Lived Experience"].skills.push(skill);
                }
            });
            
            let html = '<div class="cards-grid">';
            
            Object.entries(domains).forEach(([domainName, data]) => {
                if (data.skills.length === 0) return;
                
                html += `
                    <div class="domain-card">
                        <div class="domain-header">
                            <span class="domain-icon">${data.icon}</span>
                            <span class="domain-title">${domainName}</span>
                        </div>
                        <div class="skills-list">
                `;
                
                data.skills.forEach(skill => {
                    const levelClass = skill.level.toLowerCase();
                    const keyBadge = skill.key ? '<span class="skill-badge">CORE</span>' : '';
                    const rolesList = skill.roles.map(roleId => {
                        const role = skillsData.roles.find(r => r.id === roleId);
                        return role ? role.name : roleId;
                    }).join(', ');
                    
                    // Get years of experience from skillDetails
                    const details = skillsData.skillDetails && skillsData.skillDetails[skill.name];
                    const years = details && details.years ? details.years + ' yrs' : '';
                    const yearsBadge = years ? `<span class="skill-years">${years}</span>` : '';
                    
                    // Calculate market value for this skill
                    const skillValue = calculateSkillValue(skill);
                    const valueFormatted = skillValue.value > 0 ? `$${(skillValue.value/1000).toFixed(0)}k` : '';
                    
                    // Category badge for O*NET vs Unique
                    const categoryBadge = skill.category === 'onet' 
                        ? '<span class="skill-badge" style="background: rgba(59, 130, 246, 0.2); color: #60a5fa; font-size: 0.7em; padding: 2px 6px; border-radius: 3px; margin-left: 6px;">O*NET</span>'
                        : skill.category === 'unique'
                        ? '<span class="skill-badge" style="background: rgba(251, 191, 36, 0.2); color: #fbbf24; font-size: 0.7em; padding: 2px 6px; border-radius: 3px; margin-left: 6px;">UNIQUE</span>'
                        : '';
                    
                    html += `
                        <div class="skill-item ${levelClass}" title="${rolesList}" onclick='openSkillModalFromCard("${skill.name.replace(/'/g, "\\'")}")' style="cursor: pointer;">
                            <div class="skill-dot" style="background: ${levelColors[skill.level]}"></div>
                            <span class="skill-name">${skill.name}</span>
                            ${categoryBadge}
                            ${yearsBadge}
                            ${keyBadge}
                            ${valueFormatted ? `<span class="skill-value" style="color: #10b981; font-weight: 600; margin-left: auto;">üí∞ ${valueFormatted}/yr</span>` : ''}
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            cardView.innerHTML = html;
        }

        let currentSkillsView = 'network'; // Track whether showing network or card within Skills Ontology
        
        // Initialize user interface on load
        document.addEventListener('DOMContentLoaded', async () => {
            // v2.0: Initialize app (checks for profile, shows welcome if needed)
            await initializeApp();
            
            // If user has profile, continue with UI setup
            if (userData.initialized) {
                // Set user name in header
                const userNameEl = document.getElementById('userName');
                if (userData.profile.name) {
                    userNameEl.textContent = userData.profile.name + "'s";
                } else {
                    userNameEl.textContent = "Your";
                }
                
                // Default to card view on mobile
                const isMobile = window.innerWidth <= 768;
                if (isMobile) {
                    currentSkillsView = 'card';
                    document.getElementById('cardView').style.display = 'block';
                    document.getElementById('networkView').style.display = 'none';
                    document.getElementById('networkControls').style.display = 'none';
                    
                    // Update toggle button state
                    document.querySelectorAll('#skillsViewToggle .role-chip').forEach(chip => {
                        chip.classList.toggle('active', chip.dataset.view === 'card');
                    });
                } else {
                    initNetwork();
                }
                
                initCardView();
                
                // Auto-save every 30 seconds
                setInterval(() => {
                    saveUserData();
                }, 30000);
            } // Close if (userData.initialized)
        }); // Close DOMContentLoaded
        
        function switchView(view) {
            currentView = view;
            document.querySelectorAll('.view-toggle button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const networkControls = document.getElementById('networkControls');
            const skillsViewToggle = document.getElementById('skillsViewToggle');
            const controls = document.querySelector('.controls');
            
            // Hide all views
            document.getElementById('networkView').style.display = 'none';
            document.getElementById('cardView').style.display = 'none';
            document.getElementById('opportunitiesView').style.display = 'none';
            document.getElementById('applicationsView').style.display = 'none';
            document.getElementById('blueprintView').style.display = 'none';
            document.getElementById('consentView').style.display = 'none';
            document.getElementById('settingsView').style.display = 'none';
            networkControls.style.display = 'none';
            controls.style.display = 'none';
            
            // Show selected view
            if (view === 'network') {
                // Skills Ontology view
                controls.style.display = 'flex';
                if (currentSkillsView === 'network') {
                    document.getElementById('networkView').style.display = 'block';
                    networkControls.style.display = 'flex';
                } else {
                    document.getElementById('cardView').style.display = 'block';
                }
                updateStatsBar();
            } else if (view === 'opportunities') {
                document.getElementById('opportunitiesView').style.display = 'block';
                if (!window.opportunitiesInitialized) {
                    initOpportunities();
                    window.opportunitiesInitialized = true;
                }
                updateStatsBar();
            } else if (view === 'applications') {
                document.getElementById('applicationsView').style.display = 'block';
                if (!window.applicationsInitialized) {
                    initApplications();
                    window.applicationsInitialized = true;
                }
                updateStatsBar();
            } else if (view === 'blueprint') {
                document.getElementById('blueprintView').style.display = 'block';
                if (!window.blueprintInitialized) {
                    initBlueprint();
                    window.blueprintInitialized = true;
                }
                updateStatsBar();
            } else if (view === 'consent') {
                document.getElementById('consentView').style.display = 'block';
                if (!window.consentInitialized) {
                    initConsent();
                    window.consentInitialized = true;
                }
                updateStatsBar();
            } else if (view === 'settings') {
                document.getElementById('settingsView').style.display = 'block';
                if (!window.settingsInitialized) {
                    initSettings();
                    window.settingsInitialized = true;
                }
                updateStatsBar();
            }
        }
        
        function toggleSkillsView(view) {
            currentSkillsView = view;
            document.querySelectorAll('#skillsViewToggle .role-chip').forEach(chip => {
                chip.classList.toggle('active', chip.dataset.view === view);
            });
            
            const networkControls = document.getElementById('networkControls');
            
            if (view === 'network') {
                document.getElementById('networkView').style.display = 'block';
                document.getElementById('cardView').style.display = 'none';
                networkControls.style.display = 'flex';
            } else {
                document.getElementById('networkView').style.display = 'none';
                document.getElementById('cardView').style.display = 'block';
                networkControls.style.display = 'none';
            }
        }
        
        function updateStatsBar() {
            const statsBar = document.getElementById('statsBar');
            if (currentView === 'network') {
                // Calculate total market value
                const totalValue = calculateTotalMarketValue();
                const valueFormatted = totalValue.total > 0 ? `$${(totalValue.total/1000).toFixed(0)}k` : '';
                const valueDisplay = valueFormatted ? ` ‚Ä¢ <span style="color: #10b981; font-weight: 700;">Market Value: ${valueFormatted}/year</span>` : '';
                
                // Dynamic counts
                const skillCount = userData.skills?.length || 0;
                const roleCount = userData.roles?.length || 0;
                const onetCount = userData.skills?.filter(s => s.category === 'onet').length || 0;
                const uniqueCount = userData.skills?.filter(s => s.category === 'unique').length || 0;
                
                // Show breakdown if hybrid model is used
                const skillBreakdown = (onetCount > 0 && uniqueCount > 0) ? 
                    ` (${onetCount} O*NET + ${uniqueCount} Unique)` : '';
                
                statsBar.innerHTML = `${skillCount} Skills${skillBreakdown} ‚Ä¢ ${roleCount} Career Roles${valueDisplay}`;
            } else if (currentView === 'opportunities') {
                const matches = opportunitiesData.filter(j => j.matchScore >= currentMatchThreshold).length;
                statsBar.innerHTML = `${matches} Matching Opportunities ‚Ä¢ ${currentMatchThreshold}%+ Match Threshold`;
            } else if (currentView === 'applications') {
                const total = userData.applications?.length || 0;
                const active = userData.applications?.filter(a => a.status !== 'rejected').length || 0;
                statsBar.innerHTML = `${total} Applications Tracked ‚Ä¢ ${active} Active`;
            } else if (currentView === 'blueprint') {
                const sharedOutcomes = blueprintData.outcomes.filter(o => o.shared).length;
                const selectedValues = blueprintData.values.filter(v => v.selected).length;
                statsBar.innerHTML = `${sharedOutcomes} Outcomes ‚Ä¢ ${selectedValues} Values ‚Ä¢ Purpose Statement`;
            } else if (currentView === 'consent') {
                const totalShared = blueprintData.outcomes.filter(o => o.shared).length + 
                                   blueprintData.values.filter(v => v.selected).length;
                statsBar.innerHTML = `${totalShared} Items Shared ‚Ä¢ Data Privacy & Control`;
            } else if (currentView === 'settings') {
                statsBar.innerHTML = `Profile Settings ‚Ä¢ ${userData.preferences.seniorityLevel} Level ‚Ä¢ Customize Your Experience`;
            }
        }
        
        function toggleLabels(type) {
            if (!window.networkData) return;
            const { node } = window.networkData;
            
            node.selectAll('text')
                .filter(d => d.type === type)
                .classed('hidden', function() {
                    return !this.classList.contains('hidden');
                });
        }

        function filterByRole(roleId) {
            activeRole = roleId;
            
            // Update UI
            document.querySelectorAll('.role-chip').forEach(chip => {
                chip.classList.toggle('active', chip.dataset.role === roleId);
            });

            if (!window.networkData) return;

            const { nodes, links, node, link } = window.networkData;

            if (roleId === 'all') {
                node.classed('dimmed', false).classed('highlighted', false);
                link.classed('dimmed', false).classed('highlighted', false);
                
                // Show all labels
                node.selectAll('text').classed('hidden', false);
                return;
            }

            // Find skills that belong to this role
            const relevantSkills = skillsData.skills
                .filter(s => s.roles.includes(roleId))
                .map((s, i) => `skill-${skillsData.skills.indexOf(s)}`);

            node.classed('dimmed', d => {
                if (d.type === 'center') return false;
                if (d.type === 'role') return d.id !== roleId;
                return !relevantSkills.includes(d.id);
            });

            node.classed('highlighted', d => {
                if (d.type === 'role') return d.id === roleId;
                return relevantSkills.includes(d.id);
            });

            link.classed('dimmed', d => {
                return d.source.id !== roleId && !relevantSkills.includes(d.target.id);
            });

            link.classed('highlighted', d => {
                return d.source.id === roleId && relevantSkills.includes(d.target.id);
            });
            
            // STORYTELLING MODE: Hide skill labels that aren't in this role
            node.selectAll('text').classed('hidden', function(d) {
                if (d.type === 'center') return false;
                if (d.type === 'role') return d.id !== roleId; // Hide non-active role labels
                return !relevantSkills.includes(d.id); // Hide non-relevant skill labels
            });
        }

        function filterByLevel(level) {
            activeLevel = activeLevel === level ? null : level;
            
            event.target.classList.toggle('active');

            if (!window.networkData) return;
            const { node } = window.networkData;

            if (!activeLevel) {
                node.classed('dimmed', false);
                return;
            }

            node.classed('dimmed', d => {
                if (d.type !== 'skill') return false;
                return d.level.toLowerCase() !== activeLevel;
            });
        }

        function highlightSkill(skillData) {
            if (!window.networkData) return;
            const { node, link } = window.networkData;

            // Highlight the skill and its connected roles
            const connectedRoles = skillData.roles;

            node.classed('dimmed', d => {
                if (d.type === 'center') return false;
                if (d.type === 'role') return !connectedRoles.includes(d.id);
                return d.id !== skillData.id;
            });

            node.classed('highlighted', d => {
                if (d.type === 'role') return connectedRoles.includes(d.id);
                return d.id === skillData.id;
            });

            link.classed('highlighted', d => {
                return d.target.id === skillData.id;
            });
        }

        function showTooltip(event, d) {
            if (d.type === 'center') return;

            const tooltip = d3.select('#tooltip');
            let html = `<div class="tooltip-title">${d.name}</div>`;

            if (d.type === 'skill') {
                html += `<div class="tooltip-level">${d.level}${d.key ? ' ‚Ä¢ Core Differentiator' : ''}</div>`;
                html += `<div class="tooltip-roles">Used in: `;
                d.roles.forEach(roleId => {
                    const role = skillsData.roles.find(r => r.id === roleId);
                    html += `<span class="tooltip-role-tag">${role.name}</span>`;
                });
                html += `</div>`;
            } else if (d.type === 'role') {
                const skillCount = skillsData.skills.filter(s => s.roles.includes(d.id)).length;
                html += `<div class="tooltip-roles">${skillCount} skills in this role</div>`;
            }

            tooltip
                .html(html)
                .style('opacity', 1)
                .style('left', (event.pageX + 10) + 'px')
                .style('top', (event.pageY - 10) + 'px');
        }

        function hideTooltip() {
            d3.select('#tooltip').style('opacity', 0);
        }

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            if (d.type !== 'center') {
                d.fx = null;
                d.fy = null;
            }
        }

        function openExportModal() {
            document.getElementById('exportModal').classList.add('active');
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('active');
        }
        
        function openSkillModal(skillName, skillData) {
            const modal = document.getElementById('skillModal');
            const title = document.getElementById('skillDetailTitle');
            const subtitle = document.getElementById('skillDetailSubtitle');
            const body = document.getElementById('skillDetailBody');
            
            // Set title
            title.textContent = skillName;
            
            // Set subtitle (level, years, core badge, category badge)
            const levelClass = skillData.level.toLowerCase();
            const coreBadge = skillData.key ? '<span class="modal-core-badge">‚≠ê CORE DIFFERENTIATOR</span>' : '';
            const details = skillsData.skillDetails[skillName] || {};
            const years = details.years || 'N/A';
            
            // Category badge for O*NET vs Unique
            const categoryBadge = skillData.category === 'onet' 
                ? '<span class="modal-category-badge" style="background: rgba(59, 130, 246, 0.2); color: #60a5fa;">üèõÔ∏è O*NET Standard</span>'
                : skillData.category === 'unique'
                ? '<span class="modal-category-badge" style="background: rgba(251, 191, 36, 0.2); color: #fbbf24;">‚≠ê Unique Differentiator</span>'
                : '';
            
            subtitle.innerHTML = `
                <span class="modal-level-badge ${levelClass}">${skillData.level}</span>
                <span class="modal-years">${years} years experience</span>
                ${categoryBadge}
                ${coreBadge}
            `;
            
            // Build body content
            let bodyHTML = '';
            
            // Roles section
            bodyHTML += `
                <div class="modal-section">
                    <div class="modal-section-title">
                        <span class="modal-section-icon">üéØ</span>
                        Used in These Roles
                    </div>
                    <div class="roles-tags">
            `;
            skillData.roles.forEach(roleId => {
                const role = skillsData.roles.find(r => r.id === roleId);
                if (role) {
                    bodyHTML += `<div class="role-tag">${role.icon} ${role.name}</div>`;
                }
            });
            bodyHTML += `</div></div>`;
            
            // Evidence section
            if (details.evidence && details.evidence.length > 0) {
                bodyHTML += `
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <span class="modal-section-icon">‚úì</span>
                            Evidence & Defensibility
                        </div>
                        <ul class="evidence-list">
                `;
                details.evidence.forEach(item => {
                    bodyHTML += `<li class="evidence-item">${item}</li>`;
                });
                bodyHTML += `</ul></div>`;
            } else {
                bodyHTML += `
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <span class="modal-section-icon">‚úì</span>
                            Evidence & Defensibility
                        </div>
                        <p class="placeholder-text">Evidence for this skill will be added soon.</p>
                    </div>
                `;
            }
            
            // MARKET VALUATION SECTION
            const skillValue = calculateSkillValue(skillData);
            if (skillValue.value > 0 && skillValuations && Object.keys(skillValuations.skillBaseValues || {}).length > 0) {
                bodyHTML += `
                    <div class="modal-section" style="background: rgba(16, 185, 129, 0.1); border-left: 3px solid #10b981; padding: 20px; border-radius: 8px;">
                        <div class="modal-section-title">
                            <span class="modal-section-icon">üí∞</span>
                            Market Importance
                        </div>
                        <div style="margin-top: 15px;">
                            <div style="font-size: 1.8em; font-weight: 700; color: #10b981; margin-bottom: 10px;">
                                $${skillValue.value.toLocaleString()}/year
                            </div>
                            
                            <div style="color: #9ca3af; font-size: 0.9em; margin-bottom: 15px; line-height: 1.5;">
                                This skill's relative market importance. Use this to prioritize which capabilities to emphasize in interviews and negotiations.
                            </div>
                            
                            <div style="background: rgba(96, 165, 250, 0.1); padding: 15px; border-radius: 6px; margin-top: 15px;">
                                <div style="color: #60a5fa; font-weight: 600; margin-bottom: 8px;">üìä Importance Scale</div>
                                <div style="color: #d1d5db; font-size: 0.9em; line-height: 1.6;">
                                    ‚Ä¢ <strong>$5,000+:</strong> Critical differentiator (top 10%)<br>
                                    ‚Ä¢ <strong>$3,000-$5,000:</strong> Highly valuable skill<br>
                                    ‚Ä¢ <strong>$1,500-$3,000:</strong> Important capability<br>
                                    ‚Ä¢ <strong><$1,500:</strong> Supporting skill
                                </div>
                            </div>
                            
                            <div style="margin-top: 15px; padding: 12px; background: rgba(251, 191, 36, 0.1); border-radius: 6px;">
                                <div style="color: #fbbf24; font-weight: 600; margin-bottom: 5px;">üí° How to Use This</div>
                                <div style="color: #d1d5db; font-size: 0.85em; line-height: 1.5;">
                                    Your total market value ($${calculateTotalMarketValue().yourWorth.toLocaleString()}) is based on your <strong>top 10 skills combined</strong>, not individual values added together. This metric helps you identify which capabilities to lead with in negotiations.
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Story section
            if (details.story) {
                bodyHTML += `
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <span class="modal-section-icon">üìñ</span>
                            Context & Story
                        </div>
                        <div class="story-text">${details.story}</div>
                    </div>
                `;
            }
            
            // Related skills section
            if (details.relatedSkills && details.relatedSkills.length > 0) {
                bodyHTML += `
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <span class="modal-section-icon">üîó</span>
                            Related Skills
                        </div>
                        <div class="related-skills">
                `;
                details.relatedSkills.forEach(relatedSkill => {
                    bodyHTML += `<div class="related-skill-chip" onclick="openRelatedSkill('${relatedSkill}')">${relatedSkill}</div>`;
                });
                bodyHTML += `</div></div>`;
            }
            
            body.innerHTML = bodyHTML;
            modal.classList.add('active');
        }
        
        function closeSkillModal() {
            document.getElementById('skillModal').classList.remove('active');
        }
        
        function openRelatedSkill(skillName) {
            const skill = skillsData.skills.find(s => s.name === skillName);
            if (skill) {
                openSkillModal(skillName, skill);
            }
        }
        
        function openSkillModalFromCard(skillName) {
            const skill = skillsData.skills.find(s => s.name === skillName);
            if (skill) {
                openSkillModal(skillName, skill);
            }
        }

        function exportProfile(format) {
            alert(`Export to ${format} - Coming soon!\n\nThis will generate a ${format} based on your current role filter: ${activeRole}`);
            closeExportModal();
        }

        // Resize handler
        
        // ===== WORK BLUEPRINT SYSTEM =====
        
        let blueprintData = {
            outcomes: [],
            values: [],
            purpose: "",
            shareSettings: {}
        };
        
        function initBlueprint() {
            extractOutcomesFromEvidence();
            inferValues();
            renderBlueprint();
        }
        
        function extractOutcomesFromEvidence() {
            const outcomes = [];
            
            // Pattern-based extraction from skill evidence
            const quantifiedPattern = /\$[\d,]+[MBK]?|\d+%|\d+ years?/gi;
            const comparisonPattern = /before|early|first|ahead of|vs\.|compared to/i;
            const scalePattern = /Fortune \d+|global|enterprise|unicorn|\$[\d.]+[MB] valuation/i;
            
            Object.entries(skillsData.skillDetails || {}).forEach(([skillName, details]) => {
                if (!details.evidence) return;
                
                details.evidence.forEach(evidenceItem => {
                    const hasQuantity = quantifiedPattern.test(evidenceItem);
                    const hasComparison = comparisonPattern.test(evidenceItem);
                    const hasScale = scalePattern.test(evidenceItem);
                    
                    // High-value outcomes have quantification + (comparison OR scale)
                    if (hasQuantity && (hasComparison || hasScale)) {
                        outcomes.push({
                            text: evidenceItem,
                            skill: skillName,
                            category: categorizeOutcome(skillName, evidenceItem),
                            shared: true,
                            sensitive: isSensitiveContent(evidenceItem),
                            coachingSuggestion: generateCoachingFor(evidenceItem)
                        });
                    }
                });
            });
            
            blueprintData.outcomes = outcomes;
        }
        
        function categorizeOutcome(skillName, evidence) {
            if (evidence.includes('$') || evidence.includes('revenue') || evidence.includes('sales')) return 'Business Impact';
            if (evidence.includes('predict') || evidence.includes('accuracy') || evidence.includes('%')) return 'Strategic Foresight';
            if (evidence.includes('emergency') || evidence.includes('crisis') || evidence.includes('zero')) return 'Crisis Leadership';
            if (evidence.includes('founded') || evidence.includes('built') || evidence.includes('created')) return 'Entrepreneurial';
            if (evidence.includes('published') || evidence.includes('speaker') || evidence.includes('featured')) return 'Thought Leadership';
            if (evidence.includes('recovery') || evidence.includes('sobriety') || evidence.includes('advocacy')) return 'Advocacy Impact';
            return 'Professional Achievement';
        }
        
        function isSensitiveContent(text) {
            const sensitiveKeywords = ['recovery', 'sobriety', 'addiction', 'Kyle', 'son', 'death', 'overdose', 'mental health'];
            return sensitiveKeywords.some(keyword => text.toLowerCase().includes(keyword));
        }
        
        function generateCoachingFor(outcome) {
            if (!outcome.includes('$') && !outcome.includes('%')) {
                return "Consider adding quantification: What was the measurable impact?";
            }
            if (!outcome.includes('client') && !outcome.includes('company') && !outcome.includes('people')) {
                return "Strengthen by adding: Who benefited from this outcome?";
            }
            if (outcome.length < 50) {
                return "Add context: What decision did this enable or what changed as a result?";
            }
            return null;
        }
        
        function inferValues() {
            // Enterprise-standard values with authentic voice
            blueprintData.values = [
                { 
                    name: "Intellectual Integrity", 
                    description: "Pursue truth over confirmation. Evidence-based decisions, always. Challenge assumptions before accepting conclusions.",
                    selected: true,
                    inferred: true
                },
                { 
                    name: "Strategic Foresight Over Reaction", 
                    description: "Anticipate market shifts 18-24 months early. Lead change, don't follow it. 85-95% predictive accuracy through pattern recognition.",
                    selected: true,
                    inferred: true
                },
                { 
                    name: "Radical Transparency", 
                    description: "Share hard truths directly and kindly. Reality-based planning wins. Confront problems early, not late.",
                    selected: true,
                    inferred: true
                },
                { 
                    name: "Outcome-Focused Excellence", 
                    description: "Judge by impact delivered, not activity performed. Results drive everything. Measure outcomes, not effort.",
                    selected: true,
                    inferred: true
                },
                { 
                    name: "Elegant Simplicity", 
                    description: "Distill complexity into clarity. Deep understanding enables simple solutions. Make sophisticated insights accessible.",
                    selected: true,
                    inferred: true
                },
                { 
                    name: "Authentic, Human Leadership", 
                    description: "Lead with vulnerability and truth. Strength through self-awareness. Use personal experience to build trust and reduce stigma.",
                    selected: true,
                    inferred: true
                },
                { 
                    name: "Customer-Centric Innovation", 
                    description: "Solve real problems with elegant solutions. Understand user needs deeply before building. Innovation with purpose.",
                    selected: false,
                    inferred: false
                },
                { 
                    name: "Continuous Learning & Adaptation", 
                    description: "Seek disconfirming evidence. Update beliefs when data changes. Growth mindset in action.",
                    selected: false,
                    inferred: false
                }
            ];
            
            blueprintData.purpose = "I help organizations navigate transformation through strategic foresight and evidence-based decision making. Using pattern recognition and predictive frameworks, I enable leaders to see market shifts 18-24 months early and make proactive choices. I lead with authenticity and transparency, using personal experience to build trust that enables honest discourse about complex challenges.";
        }
        
        function renderBlueprint() {
            const view = document.getElementById('blueprintView');
            
            view.innerHTML = `
                <div class="blueprint-container">
                    <div class="blueprint-header">
                        <h1 class="blueprint-title">Work Blueprint</h1>
                        <p class="blueprint-subtitle">Your Consent-Based Professional Profile</p>
                        <p class="blueprint-tagline">Control what you share. Tell your story, your way.</p>
                    </div>
                    
                    ${renderMarketValuationSection()}
                    ${renderOutcomesSection()}
                    ${renderValuesSection()}
                    ${renderPurposeSection()}
                    ${renderExportSection()}
                </div>
            `;
        }
        
        function renderMarketValuationSection() {
            const totalValue = calculateTotalMarketValue();
            
            if (!totalValue || totalValue.total === 0 || !skillValuations || Object.keys(skillValuations.skillBaseValues || {}).length === 0) {
                return ''; // Don't show if data not loaded
            }
            
            const negotiationGap = totalValue.yourWorth - totalValue.standardOffer;
            
            return `
                <div class="blueprint-section" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(96, 165, 250, 0.1) 100%); border: 2px solid rgba(16, 185, 129, 0.3); margin-bottom: 30px;">
                    <div class="blueprint-section-header">
                        <div class="blueprint-section-title">
                            <span class="section-icon">üí∞</span>
                            <span>Your Market Valuation</span>
                        </div>
                    </div>
                    
                    <div style="text-align: center; padding: 30px 20px;">
                        <div style="color: #9ca3af; font-size: 0.9em; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px;">
                            Your Market Worth
                        </div>
                        <div style="font-size: 3em; font-weight: 700; color: #10b981; margin-bottom: 10px;">
                            $${totalValue.yourWorth.toLocaleString()}<span style="font-size: 0.4em; color: #9ca3af;">/year</span>
                        </div>
                        <div style="color: #d1d5db; font-size: 1em; margin-bottom: 8px;">
                            ${totalValue.roleLevel} Level ‚Ä¢ ${totalValue.compaRatio}% of Market Median
                        </div>
                        <div style="color: #9ca3af; font-size: 0.9em; margin-bottom: 30px;">
                            Based on top 10 skills ‚Ä¢ ${userData.profile.location}
                        </div>
                        
                        <div style="background: rgba(255, 255, 255, 0.03); padding: 25px; border-radius: 12px; margin-bottom: 25px;">
                            <div style="color: #60a5fa; font-weight: 600; margin-bottom: 15px; text-align: left;">üìä EXPECTED OFFER RANGES (Compa-Ratio Model)</div>
                            <div style="color: #9ca3af; font-size: 0.85em; margin-bottom: 20px; text-align: left;">
                                Companies typically offer 75-95% of market value. You negotiate within this range.
                            </div>
                            
                            <div style="display: grid; gap: 12px;">
                                <div style="background: rgba(107, 114, 128, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #9ca3af; text-align: left;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <div style="color: #9ca3af; font-weight: 600; margin-bottom: 3px;">Conservative Offer (75%)</div>
                                            <div style="color: #d1d5db; font-size: 0.85em;">Budget-constrained companies</div>
                                        </div>
                                        <div style="color: #e0e0e0; font-size: 1.3em; font-weight: 700;">$${totalValue.conservativeOffer.toLocaleString()}</div>
                                    </div>
                                </div>
                                
                                <div style="background: rgba(96, 165, 250, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #60a5fa; text-align: left;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <div style="color: #60a5fa; font-weight: 600; margin-bottom: 3px;">Standard Offer (85%)</div>
                                            <div style="color: #d1d5db; font-size: 0.85em;">Most common initial offers</div>
                                        </div>
                                        <div style="color: #e0e0e0; font-size: 1.3em; font-weight: 700;">$${totalValue.standardOffer.toLocaleString()}</div>
                                    </div>
                                </div>
                                
                                <div style="background: rgba(16, 185, 129, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #10b981; text-align: left;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <div style="color: #10b981; font-weight: 600; margin-bottom: 3px;">Competitive Offer (95%)</div>
                                            <div style="color: #d1d5db; font-size: 0.85em;">Top companies competing for talent</div>
                                        </div>
                                        <div style="color: #e0e0e0; font-size: 1.3em; font-weight: 700;">$${totalValue.competitiveOffer.toLocaleString()}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px; padding: 15px; background: rgba(251, 191, 36, 0.2); border-radius: 8px; text-align: left;">
                                <div style="color: #fbbf24; font-weight: 600; margin-bottom: 5px;">üí° Your Negotiation Gap: $${negotiationGap.toLocaleString()}</div>
                                <div style="color: #d1d5db; font-size: 0.9em;">
                                    Between standard offer ($${totalValue.standardOffer.toLocaleString()}) and your worth ($${totalValue.yourWorth.toLocaleString()}). This is your leverage.
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; max-width: 800px; margin: 0 auto 25px;">
                            <div style="background: rgba(255, 255, 255, 0.05); padding: 18px; border-radius: 10px;">
                                <div style="color: #9ca3af; font-size: 0.85em; margin-bottom: 5px;">Market Rate (50th %ile)</div>
                                <div style="color: #60a5fa; font-size: 1.3em; font-weight: 700;">$${totalValue.marketRate.toLocaleString()}</div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.05); padding: 18px; border-radius: 10px;">
                                <div style="color: #9ca3af; font-size: 0.85em; margin-bottom: 5px;">Your Premium</div>
                                <div style="color: #10b981; font-size: 1.3em; font-weight: 700;">+$${totalValue.premiumAmount.toLocaleString()}</div>
                                <div style="color: #9ca3af; font-size: 0.75em; margin-top: 3px;">+${Math.round((totalValue.domainPremium + totalValue.rarityBonus) * 100)}%</div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.05); padding: 18px; border-radius: 10px;">
                                <div style="color: #9ca3af; font-size: 0.85em; margin-bottom: 5px;">Compa-Ratio</div>
                                <div style="color: #e0e0e0; font-size: 1.3em; font-weight: 700;">${totalValue.compaRatio}%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(96, 165, 250, 0.1); padding: 20px; border-radius: 8px; margin: 20px;">
                        <div style="color: #60a5fa; font-weight: 600; margin-bottom: 10px;">üéØ How This Was Calculated</div>
                        <div style="color: #d1d5db; font-size: 0.95em; line-height: 1.6;">
                            <strong>Method:</strong> Top 10 skills ‚Üí ${totalValue.roleLevel} role tier ‚Üí Market median ($${totalValue.marketRate.toLocaleString()})
                            <br><br>
                            <strong>Market Rate:</strong> $${totalValue.marketRate.toLocaleString()} (50th percentile for ${totalValue.roleLevel})
                            <br><strong>Domain Premium:</strong> +${Math.round(totalValue.domainPremium * 100)}% (AI, Strategy, Executive expertise)
                            <br><strong>Rarity Bonus:</strong> +${Math.round(totalValue.rarityBonus * 100)}% (unique skill combination)
                            <br><strong>Location:</strong> ${userData.profile.location} (√ó${skillValuations.locationMultipliers[userData.profile.location] || 1.0})
                            <br><br>
                            <strong>Your Worth:</strong> $${totalValue.yourWorth.toLocaleString()} (${totalValue.compaRatio}% compa-ratio)
                        </div>
                    </div>
                    
                    <div style="margin: 20px;">
                        <div style="color: #60a5fa; font-weight: 600; margin-bottom: 15px;">üî• Top 10 Skills Used in Calculation:</div>
                        <div style="color: #9ca3af; font-size: 0.85em; margin-bottom: 12px;">
                            Roles typically require 10-15 core skills, not all 73. These are your most valuable:
                        </div>
                        <div style="display: grid; gap: 8px;">
                            ${totalValue.top10Skills.map((skill, idx) => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: ${idx < 3 ? 'rgba(16, 185, 129, 0.15)' : 'rgba(255, 255, 255, 0.03)'}; border-radius: 6px; border-left: 3px solid ${idx < 3 ? '#10b981' : 'rgba(255,255,255,0.1)'};">
                                    <div>
                                        <span style="color: #9ca3af; font-weight: 600; margin-right: 8px;">${idx + 1}.</span>
                                        <span style="color: #e0e0e0;">${skill.skill}</span>
                                        <span style="color: #9ca3af; font-size: 0.85em; margin-left: 8px;">(${skill.level})</span>
                                    </div>
                                    <div style="color: ${idx < 3 ? '#10b981' : '#9ca3af'}; font-weight: 600; font-size: 0.9em;">
                                        ${idx < 3 ? '‚≠ê' : ''} $${skill.value.toLocaleString()}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="color: #9ca3af; font-size: 0.8em; margin-top: 12px; font-style: italic;">
                            Note: Values show relative importance. Actual compensation based on role tier + premiums.
                        </div>
                    </div>
                    
                    <div style="margin: 20px; padding: 20px; background: rgba(251, 191, 36, 0.1); border-left: 3px solid #fbbf24; border-radius: 4px;">
                        <div style="color: #fbbf24; font-weight: 600; margin-bottom: 10px;">üíº USING THIS IN NEGOTIATIONS</div>
                        <div style="color: #d1d5db; font-size: 0.9em; line-height: 1.8;">
                            <strong>The Strategy:</strong>
                            <br>‚Ä¢ Companies offer 75-90% of target (expect $${totalValue.standardOffer.toLocaleString()})
                            <br>‚Ä¢ You negotiate to 90-110% (aim for $${totalValue.competitiveOffer.toLocaleString()}-$${totalValue.yourWorth.toLocaleString()})
                            <br>‚Ä¢ Your worth ($${totalValue.yourWorth.toLocaleString()}) is your anchor point
                            <br>‚Ä¢ The $${negotiationGap.toLocaleString()} gap is your leverage
                            <br><br>
                            <strong>Reference Your Top 10 Skills:</strong> These justify premiums above standard offers
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin: 20px; flex-wrap: wrap;">
                        <button class="export-btn-large" onclick="showValuationBreakdown()" style="flex: 1; min-width: 200px;">
                            üìä View All ${skillsData.skills.length} Skills
                        </button>
                        <button class="export-btn-large" onclick="showNegotiationGuide()" style="flex: 1; min-width: 200px; background: rgba(251, 191, 36, 0.2); border-color: #fbbf24; color: #fbbf24;">
                            üíº Detailed Negotiation Guide
                        </button>
                    </div>
                </div>
            `;
        }
        
        function renderOutcomesSection() {
            const outcomes = blueprintData.outcomes;
            
            return `
                <div class="blueprint-section">
                    <div class="blueprint-section-header">
                        <div class="blueprint-section-title">
                            <span class="section-icon">üìä</span>
                            <span>Outcomes I Drive</span>
                            <span class="section-count">${outcomes.length}</span>
                        </div>
                    </div>
                    
                    <div class="coaching-tip">
                        <div class="coaching-tip-title">
                            üí° COACHING TIP
                        </div>
                        <div class="coaching-tip-content">
                            Top performers quantify impact. Notice the pattern:
                            <ul>
                                <li><strong>Numbers:</strong> $200M, 85%, 5 years, zero injuries</li>
                                <li><strong>Comparisons:</strong> "5 years early", "before market consensus"</li>
                                <li><strong>Consequences:</strong> What changed because of this?</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div id="outcomesContainer">
                        ${outcomes.map((outcome, idx) => renderOutcomeItem(outcome, idx)).join('')}
                    </div>
                    
                    <button class="add-outcome-btn" onclick="addCustomOutcome()">
                        <span>‚ûï</span>
                        <span>Add Custom Outcome</span>
                    </button>
                    
                    <div class="reflection-prompts">
                        <div class="reflection-title">üí≠ REFLECTION PROMPTS</div>
                        <ul>
                            <li>What problem did you solve that others couldn't?</li>
                            <li>What changed because of your work?</li>
                            <li>What would have happened without you?</li>
                            <li>How do you know this worked? (proof/evidence)</li>
                        </ul>
                    </div>
                </div>
            `;
        }
        
        function renderOutcomeItem(outcome, idx) {
            const shareChecked = outcome.shared ? 'checked' : '';
            const sensitiveWarning = outcome.sensitive ? 
                '<span class="meta-tag sensitive">‚ö†Ô∏è SENSITIVE: Consider context before sharing</span>' : '';
            const coachingNote = outcome.coachingSuggestion ? 
                `<div class="outcome-coaching">üí° ${outcome.coachingSuggestion}</div>` : '';
            
            return `
                <div class="outcome-item" data-idx="${idx}">
                    <div class="outcome-header">
                        <div class="outcome-text">${outcome.text}</div>
                        <div class="outcome-controls">
                            <label class="share-toggle">
                                <input type="checkbox" ${shareChecked} onchange="toggleOutcomeShare(${idx})">
                                <span class="share-toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="outcome-meta">
                        <span class="meta-tag category">üìÇ ${outcome.category}</span>
                        <span class="meta-tag evidence">‚úì From: ${outcome.skill}</span>
                        ${sensitiveWarning}
                    </div>
                    
                    ${coachingNote}
                    
                    <div class="outcome-actions">
                        <button class="outcome-btn" onclick="editOutcome(${idx})">‚úé Edit</button>
                        <button class="outcome-btn" onclick="viewOutcomeEvidence(${idx})">üîç View Evidence</button>
                    </div>
                </div>
            `;
        }
        
        function renderValuesSection() {
            const values = blueprintData.values;
            const selectedCount = values.filter(v => v.selected).length;
            
            return `
                <div class="blueprint-section">
                    <div class="blueprint-section-header">
                        <div class="blueprint-section-title">
                            <span class="section-icon">‚≠ê</span>
                            <span>Values & Principles</span>
                            <span class="section-count">${selectedCount} selected</span>
                        </div>
                    </div>
                    
                    <div class="coaching-tip">
                        <div class="coaching-tip-title">
                            üí° VALUES THAT SHOW, NOT TELL
                        </div>
                        <div class="coaching-tip-content">
                            These values are <strong>inferred from your evidence</strong> - they're not aspirational, they're demonstrated. 
                            Select 3-5 that best represent how you actually operate.
                        </div>
                    </div>
                    
                    <div class="values-grid">
                        ${values.map((value, idx) => renderValueCard(value, idx)).join('')}
                    </div>
                </div>
            `;
        }
        
        function renderValueCard(value, idx) {
            const selectedClass = value.selected ? 'selected' : '';
            const inferredBadge = value.inferred ? '<span style="color: #10b981; font-size: 0.75em;">‚úì Inferred from evidence</span>' : '';
            
            return `
                <div class="value-card ${selectedClass}" onclick="toggleValue(${idx})">
                    <div class="value-title">${value.name}</div>
                    <div class="value-description">${value.description}</div>
                    ${inferredBadge}
                </div>
            `;
        }
        
        function renderPurposeSection() {
            return `
                <div class="blueprint-section">
                    <div class="blueprint-section-header">
                        <div class="blueprint-section-title">
                            <span class="section-icon">üéØ</span>
                            <span>Purpose Statement</span>
                        </div>
                    </div>
                    
                    <div class="coaching-tip">
                        <div class="coaching-tip-title">
                            üí° YOUR "WHY"
                        </div>
                        <div class="coaching-tip-content">
                            This statement is inferred from your work and advocacy. Edit to make it yours.
                            Strong purpose statements connect what you do to why it matters.
                        </div>
                    </div>
                    
                    <textarea class="purpose-editor" onchange="updatePurpose(this.value)">${blueprintData.purpose}</textarea>
                </div>
            `;
        }
        
        function renderExportSection() {
            const sharedOutcomes = blueprintData.outcomes.filter(o => o.shared).length;
            const sharedValues = blueprintData.values.filter(v => v.selected).length;
            
            return `
                <div class="export-section">
                    <div class="export-title">üì§ Export Your Work Blueprint</div>
                    <p style="color: #d1d5db; margin-bottom: 20px;">
                        Sharing: ${sharedOutcomes} outcomes, ${sharedValues} values, purpose statement
                    </p>
                    <div class="export-buttons">
                        <button class="export-btn-large" onclick="exportBlueprint('pdf')">
                            üìÑ Export as PDF
                        </button>
                        <button class="export-btn-large" onclick="exportBlueprint('json')">
                            üíæ Export as JSON
                        </button>
                        <button class="export-btn-large" onclick="exportBlueprint('link')">
                            üîó Create Shareable Link
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Blueprint interaction functions
        function toggleOutcomeShare(idx) {
            blueprintData.outcomes[idx].shared = !blueprintData.outcomes[idx].shared;
            saveUserData();  // Auto-save
        }
        
        function editOutcome(idx) {
            const outcome = blueprintData.outcomes[idx];
            const modal = document.getElementById('exportModal');
            const modalContent = modal.querySelector('.modal-content');
            
            modalContent.innerHTML = `
                <div class="modal-header">
                    <div class="modal-header-left">
                        <h2 class="modal-title">Edit Outcome</h2>
                        <p style="color: #9ca3af; margin-top: 5px;">Refine how you describe this achievement</p>
                    </div>
                    <button class="modal-close" onclick="closeExportModal()">√ó</button>
                </div>
                <div class="modal-body" style="padding: 30px;">
                    <div style="margin-bottom: 20px;">
                        <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">
                            Outcome Text
                        </label>
                        <textarea id="editOutcomeText" style="
                            width: 100%;
                            min-height: 120px;
                            padding: 15px;
                            background: rgba(255, 255, 255, 0.05);
                            border: 1px solid rgba(96, 165, 250, 0.3);
                            border-radius: 8px;
                            color: #e0e0e0;
                            font-size: 1em;
                            line-height: 1.6;
                            font-family: inherit;
                            resize: vertical;
                        ">${outcome.text}</textarea>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">
                            Category
                        </label>
                        <select id="editOutcomeCategory" style="
                            width: 100%;
                            padding: 12px;
                            background: rgba(255, 255, 255, 0.05);
                            border: 1px solid rgba(96, 165, 250, 0.3);
                            border-radius: 8px;
                            color: #e0e0e0;
                            font-size: 1em;
                        ">
                            <option value="Business Impact" ${outcome.category === 'Business Impact' ? 'selected' : ''}>Business Impact</option>
                            <option value="Strategic Foresight" ${outcome.category === 'Strategic Foresight' ? 'selected' : ''}>Strategic Foresight</option>
                            <option value="Crisis Leadership" ${outcome.category === 'Crisis Leadership' ? 'selected' : ''}>Crisis Leadership</option>
                            <option value="Entrepreneurial" ${outcome.category === 'Entrepreneurial' ? 'selected' : ''}>Entrepreneurial</option>
                            <option value="Thought Leadership" ${outcome.category === 'Thought Leadership' ? 'selected' : ''}>Thought Leadership</option>
                            <option value="Advocacy Impact" ${outcome.category === 'Advocacy Impact' ? 'selected' : ''}>Advocacy Impact</option>
                            <option value="Professional Achievement" ${outcome.category === 'Professional Achievement' ? 'selected' : ''}>Professional Achievement</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="editOutcomeSensitive" ${outcome.sensitive ? 'checked' : ''} style="
                                width: 20px;
                                height: 20px;
                                cursor: pointer;
                            ">
                            <span style="color: #ef4444; font-weight: 600;">Mark as Sensitive Content</span>
                        </label>
                        <p style="color: #9ca3af; font-size: 0.85em; margin-top: 5px; margin-left: 30px;">
                            Flag personal stories (recovery, loss, etc.) that require context before sharing
                        </p>
                    </div>
                    
                    <div style="background: rgba(251, 191, 36, 0.1); border-left: 3px solid #fbbf24; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
                        <strong style="color: #fbbf24;">üí° COACHING TIP:</strong>
                        <p style="color: #d1d5db; margin-top: 8px; font-size: 0.9em;">
                            Strong outcomes include:
                            <br>‚Ä¢ Quantification (numbers, percentages, time saved)
                            <br>‚Ä¢ Who benefited (clients, company, team)
                            <br>‚Ä¢ What changed as a result
                            <br>‚Ä¢ Comparison or context (vs industry average, timeline)
                        </p>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: flex-end;">
                        <button class="action-btn" onclick="closeExportModal()" style="padding: 10px 20px;">
                            Cancel
                        </button>
                        <button class="export-btn-large" onclick="saveOutcomeEdit(${idx})" style="padding: 10px 20px;">
                            üíæ Save Changes
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }
        
        function saveOutcomeEdit(idx) {
            const newText = document.getElementById('editOutcomeText').value;
            const newCategory = document.getElementById('editOutcomeCategory').value;
            const newSensitive = document.getElementById('editOutcomeSensitive').checked;
            
            // Update outcome
            blueprintData.outcomes[idx].text = newText;
            blueprintData.outcomes[idx].category = newCategory;
            blueprintData.outcomes[idx].sensitive = newSensitive;
            
            // Regenerate coaching suggestion
            blueprintData.outcomes[idx].coachingSuggestion = generateCoachingFor(newText);
            
            // Save to localStorage
            saveUserData();
            
            // Close modal and refresh
            closeExportModal();
            renderBlueprint();
            
            alert('Outcome updated successfully!');
        }
        
        function viewOutcomeEvidence(idx) {
            const outcome = blueprintData.outcomes[idx];
            const skill = skillsData.skills.find(s => s.name === outcome.skill);
            if (skill) {
                openSkillModal(outcome.skill, skill);
            }
        }
        
        function addCustomOutcome() {
            const modal = document.getElementById('exportModal');
            const modalContent = modal.querySelector('.modal-content');
            
            modalContent.innerHTML = `
                <div class="modal-header">
                    <div class="modal-header-left">
                        <h2 class="modal-title">Add Custom Outcome</h2>
                        <p style="color: #9ca3af; margin-top: 5px;">Describe an achievement or impact you've made</p>
                    </div>
                    <button class="modal-close" onclick="closeExportModal()">√ó</button>
                </div>
                <div class="modal-body" style="padding: 30px;">
                    <div style="margin-bottom: 20px;">
                        <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">
                            Outcome Template
                        </label>
                        <select id="outcomeTemplate" onchange="fillOutcomeTemplate(this.value)" style="
                            width: 100%;
                            padding: 12px;
                            background: rgba(255, 255, 255, 0.05);
                            border: 1px solid rgba(96, 165, 250, 0.3);
                            border-radius: 8px;
                            color: #e0e0e0;
                            font-size: 1em;
                            margin-bottom: 15px;
                        ">
                            <option value="">-- Choose a template (optional) --</option>
                            <option value="revenue">Revenue/Financial Impact</option>
                            <option value="team">Team Building/Leadership</option>
                            <option value="innovation">Innovation/New Capability</option>
                            <option value="efficiency">Efficiency/Process Improvement</option>
                            <option value="crisis">Crisis Management</option>
                            <option value="strategic">Strategic Initiative</option>
                            <option value="thought">Thought Leadership</option>
                        </select>
                        
                        <textarea id="customOutcomeText" placeholder="Example: Led strategic initiative that increased revenue by 40% year-over-year through new market expansion" style="
                            width: 100%;
                            min-height: 120px;
                            padding: 15px;
                            background: rgba(255, 255, 255, 0.05);
                            border: 1px solid rgba(96, 165, 250, 0.3);
                            border-radius: 8px;
                            color: #e0e0e0;
                            font-size: 1em;
                            line-height: 1.6;
                            font-family: inherit;
                            resize: vertical;
                        "></textarea>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">
                            Category
                        </label>
                        <select id="customOutcomeCategory" style="
                            width: 100%;
                            padding: 12px;
                            background: rgba(255, 255, 255, 0.05);
                            border: 1px solid rgba(96, 165, 250, 0.3);
                            border-radius: 8px;
                            color: #e0e0e0;
                            font-size: 1em;
                        ">
                            <option value="Business Impact">Business Impact</option>
                            <option value="Strategic Foresight">Strategic Foresight</option>
                            <option value="Crisis Leadership">Crisis Leadership</option>
                            <option value="Entrepreneurial">Entrepreneurial</option>
                            <option value="Thought Leadership">Thought Leadership</option>
                            <option value="Advocacy Impact">Advocacy Impact</option>
                            <option value="Professional Achievement">Professional Achievement</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">
                            Related Skill (Optional)
                        </label>
                        <select id="customOutcomeSkill" style="
                            width: 100%;
                            padding: 12px;
                            background: rgba(255, 255, 255, 0.05);
                            border: 1px solid rgba(96, 165, 250, 0.3);
                            border-radius: 8px;
                            color: #e0e0e0;
                            font-size: 1em;
                        ">
                            <option value="">-- None --</option>
                            ${skillsData.skills.map(s => `<option value="${s.name}">${s.name}</option>`).join('')}
                        </select>
                    </div>
                    
                    <div style="background: rgba(251, 191, 36, 0.1); border-left: 3px solid #fbbf24; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
                        <strong style="color: #fbbf24;">üí° REFLECTION PROMPTS:</strong>
                        <ul style="color: #d1d5db; margin-top: 8px; font-size: 0.9em; margin-left: 20px;">
                            <li>What problem did you solve that others couldn't?</li>
                            <li>What measurable change resulted from your work?</li>
                            <li>Who benefited and how do you know?</li>
                            <li>What would have happened without your contribution?</li>
                        </ul>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: flex-end;">
                        <button class="action-btn" onclick="closeExportModal()" style="padding: 10px 20px;">
                            Cancel
                        </button>
                        <button class="export-btn-large" onclick="saveCustomOutcome()" style="padding: 10px 20px;">
                            ‚ûï Add Outcome
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }
        
        function fillOutcomeTemplate(type) {
            const textarea = document.getElementById('customOutcomeText');
            const templates = {
                revenue: 'Led [initiative] that increased revenue by [X%/amount] through [approach/method]. Resulted in [specific outcome/benefit].',
                team: 'Built and scaled [team/function] from [starting point] to [end state]. Team delivered [key achievements] within [timeframe].',
                innovation: 'Created [new capability/system] that enabled [organization/team] to [achieve what]. Adopted by [number/scope] with [measurable impact].',
                efficiency: 'Redesigned [process/system] reducing [time/cost/effort] by [X%]. Eliminated [waste/bottleneck] affecting [scope/scale].',
                crisis: 'Managed [crisis/incident] under [constraints]. Achieved [outcome] with [metric: zero injuries/minimal impact/rapid resolution].',
                strategic: 'Developed [strategy/framework] for [challenge/opportunity]. Predicted [outcome] [timeframe] ahead of market, enabling [advantage/benefit].',
                thought: 'Published [content type] reaching [audience size]. [Recognition/adoption]: [specific examples of influence/impact].'
            };
            
            if (templates[type]) {
                textarea.value = templates[type];
                textarea.focus();
            }
        }
        
        function saveCustomOutcome() {
            const text = document.getElementById('customOutcomeText').value.trim();
            if (!text) {
                alert('Please enter an outcome description');
                return;
            }
            
            const category = document.getElementById('customOutcomeCategory').value;
            const skill = document.getElementById('customOutcomeSkill').value;
            
            // Create new outcome
            const newOutcome = {
                text: text,
                skill: skill || 'Custom',
                category: category,
                shared: true,
                sensitive: false,
                coachingSuggestion: generateCoachingFor(text)
            };
            
            // Add to beginning of outcomes array
            blueprintData.outcomes.unshift(newOutcome);
            
            // Save
            saveUserData();
            
            // Close and refresh
            closeExportModal();
            renderBlueprint();
            
            alert('Custom outcome added successfully!');
        }
        
        function toggleValue(idx) {
            blueprintData.values[idx].selected = !blueprintData.values[idx].selected;
            saveUserData();  // Auto-save
            renderBlueprint();
        }
        
        function updatePurpose(newPurpose) {
            blueprintData.purpose = newPurpose;
            saveUserData();  // Auto-save
        }
        
        function exportBlueprint(format) {
            const sharedData = {
                outcomes: blueprintData.outcomes.filter(o => o.shared),
                values: blueprintData.values.filter(v => v.selected),
                purpose: blueprintData.purpose
            };
            
            if (format === 'json') {
                const dataStr = JSON.stringify(sharedData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'work-blueprint.json';
                link.click();
                URL.revokeObjectURL(url);
            } else if (format === 'pdf') {
                generatePDF(sharedData);
            } else if (format === 'link') {
                generateShareableLink(sharedData);
            }
        }
        
        function generatePDF(data) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            let yPos = 20;
            const pageWidth = doc.internal.pageSize.getWidth();
            const margin = 20;
            const maxWidth = pageWidth - (margin * 2);
            
            // Header
            doc.setFontSize(24);
            doc.setTextColor(96, 165, 250);
            doc.text(`${userData.profile.name || 'Your'} Work Blueprint`, margin, yPos);
            yPos += 10;
            
            doc.setFontSize(10);
            doc.setTextColor(156, 163, 175);
            doc.text(new Date().toLocaleDateString(), margin, yPos);
            yPos += 15;
            
            // Outcomes Section
            if (data.outcomes.length > 0) {
                doc.setFontSize(16);
                doc.setTextColor(96, 165, 250);
                doc.text('Outcomes I Drive', margin, yPos);
                yPos += 8;
                
                doc.setFontSize(10);
                doc.setTextColor(55, 65, 81);
                
                data.outcomes.forEach((outcome, idx) => {
                    if (yPos > 270) {
                        doc.addPage();
                        yPos = 20;
                    }
                    
                    // Bullet point
                    doc.circle(margin + 2, yPos - 1.5, 1, 'F');
                    
                    // Wrap text
                    const lines = doc.splitTextToSize(outcome.text, maxWidth - 10);
                    doc.text(lines, margin + 6, yPos);
                    yPos += (lines.length * 5) + 3;
                    
                    // Category tag
                    doc.setFontSize(8);
                    doc.setTextColor(96, 165, 250);
                    doc.text(`[${outcome.category}]`, margin + 6, yPos);
                    yPos += 8;
                    doc.setFontSize(10);
                    doc.setTextColor(55, 65, 81);
                });
                
                yPos += 5;
            }
            
            // Values Section
            if (data.values.length > 0) {
                if (yPos > 240) {
                    doc.addPage();
                    yPos = 20;
                }
                
                doc.setFontSize(16);
                doc.setTextColor(96, 165, 250);
                doc.text('Core Values', margin, yPos);
                yPos += 8;
                
                doc.setFontSize(10);
                doc.setTextColor(55, 65, 81);
                
                data.values.forEach((value, idx) => {
                    if (yPos > 270) {
                        doc.addPage();
                        yPos = 20;
                    }
                    
                    doc.setFont(undefined, 'bold');
                    doc.text(`‚Ä¢ ${value.name}`, margin, yPos);
                    yPos += 5;
                    
                    doc.setFont(undefined, 'normal');
                    const descLines = doc.splitTextToSize(value.description, maxWidth - 10);
                    doc.text(descLines, margin + 6, yPos);
                    yPos += (descLines.length * 5) + 5;
                });
                
                yPos += 5;
            }
            
            // Purpose Section
            if (data.purpose) {
                if (yPos > 240) {
                    doc.addPage();
                    yPos = 20;
                }
                
                doc.setFontSize(16);
                doc.setTextColor(96, 165, 250);
                doc.text('Purpose Statement', margin, yPos);
                yPos += 8;
                
                doc.setFontSize(10);
                doc.setTextColor(55, 65, 81);
                const purposeLines = doc.splitTextToSize(data.purpose, maxWidth);
                doc.text(purposeLines, margin, yPos);
                yPos += (purposeLines.length * 5) + 10;
            }
            
            // Professional Context
            if (yPos > 240) {
                doc.addPage();
                yPos = 20;
            }
            
            doc.setFontSize(16);
            doc.setTextColor(96, 165, 250);
            doc.text('Professional Context', margin, yPos);
            yPos += 8;
            
            doc.setFontSize(10);
            doc.setTextColor(55, 65, 81);
            
            if (userData.profile.location) {
                doc.text(`Location: ${userData.profile.location}`, margin, yPos);
                yPos += 6;
            }
            
            doc.text(`Seniority Level: ${userData.preferences.seniorityLevel}`, margin, yPos);
            yPos += 6;
            
            doc.text(`Skills: ${skillsData.skills.length} professional competencies`, margin, yPos);
            yPos += 6;
            
            doc.text(`Career Roles: ${skillsData.roles.length} dimensions`, margin, yPos);
            yPos += 10;
            
            // Footer
            doc.setFontSize(8);
            doc.setTextColor(156, 163, 175);
            const footerText = 'Generated by Work Blueprint System';
            const footerWidth = doc.getTextWidth(footerText);
            doc.text(footerText, (pageWidth - footerWidth) / 2, 285);
            
            // Save
            const fileName = `work-blueprint-${userData.profile.name || 'profile'}.pdf`.replace(/\s+/g, '-').toLowerCase();
            doc.save(fileName);
        }
        
        function generateShareableLink(data) {
            // Basic implementation - encode data as base64 URL parameter
            const jsonStr = JSON.stringify(data);
            const base64 = btoa(jsonStr);
            const shareUrl = `${window.location.origin}${window.location.pathname}?share=${base64}`;
            
            // Copy to clipboard
            navigator.clipboard.writeText(shareUrl).then(() => {
                alert(`Shareable link copied to clipboard!\n\nLink is valid and contains your selected data.\n\nNote: This is a basic implementation. For production, you'd want:\n‚Ä¢ Server-side storage\n‚Ä¢ Encryption\n‚Ä¢ Expiration dates\n‚Ä¢ Access tracking\n\n${shareUrl.substring(0, 100)}...`);
            }).catch(() => {
                alert(`Shareable link generated:\n\n${shareUrl}\n\nCopy this link to share your Work Blueprint.`);
            });
        }
        
        // ===== OPPORTUNITIES SYSTEM =====

        let currentMatchThreshold = 60;
        let opportunitiesData = [];
        
        function initOpportunities() {
            const view = document.getElementById('opportunitiesView');
            
            view.innerHTML = `
                <div class="opportunities-header">
                    <h2 class="opportunities-title">Job Opportunities</h2>
                    <p class="opportunities-subtitle">Matching your skills to open positions across the US</p>
                    
                    <div class="opportunities-filters">
                        <div class="filter-section">
                            <label class="filter-section-label">Minimum Match Score</label>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <input type="range" min="0" max="100" value="60" class="match-slider" 
                                       oninput="updateMatchThreshold(this.value)">
                                <span class="match-value" id="matchValue">60%+</span>
                            </div>
                        </div>
                        
                        <div class="filter-section">
                            <label class="filter-section-label">Search Roles</label>
                            <button class="action-btn" onclick="searchOpportunities()" style="width: auto;">
                                üîç Find Matching Jobs
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="opportunitiesResults"></div>
            `;
            
            // Auto-fetch real jobs from multiple sources
            searchOpportunities();
        }
        
        function updateMatchThreshold(value) {
            currentMatchThreshold = parseInt(value);
            document.getElementById('matchValue').textContent = value + '%+';
            filterOpportunities();
        }
        
        function calculateMatchScore(jobSkills, requiredSkills) {
            let totalPoints = 0;
            let earnedPoints = 0;
            let matchedSkills = [];
            let gapSkills = [];
            
            // Build lookup of your skills
            const yourSkillsMap = {};
            skillsData.skills.forEach(skill => {
                yourSkillsMap[skill.name.toLowerCase()] = skill;
                // Also add simplified versions
                const simplified = skill.name.toLowerCase()
                    .replace(/\s*&\s*/g, ' ')
                    .replace(/\s+/g, ' ')
                    .trim();
                yourSkillsMap[simplified] = skill;
            });
            
            // Score each required skill
            requiredSkills.forEach(reqSkill => {
                const reqLower = reqSkill.toLowerCase();
                let matched = false;
                let matchPoints = 5; // base points for any match
                
                // Try exact match first
                if (yourSkillsMap[reqLower]) {
                    const yourSkill = yourSkillsMap[reqLower];
                    matched = true;
                    
                    // Weight by proficiency
                    if (yourSkill.level === 'Mastery') {
                        matchPoints = 10;
                    } else if (yourSkill.level === 'Advanced') {
                        matchPoints = 7;
                    } else if (yourSkill.level === 'Proficient') {
                        matchPoints = 5;
                    }
                    
                    // Bonus for core differentiators
                    if (yourSkill.key) {
                        matchPoints += 5;
                    }
                    
                    matchedSkills.push(yourSkill.name);
                } else {
                    // Try fuzzy matching for related skills
                    for (const [skillName, skillData] of Object.entries(yourSkillsMap)) {
                        if (reqLower.includes(skillName) || skillName.includes(reqLower)) {
                            matched = true;
                            matchPoints = 3; // partial match points
                            matchedSkills.push(skillData.name);
                            break;
                        }
                    }
                }
                
                totalPoints += 10; // Each required skill worth 10 points max
                if (matched) {
                    earnedPoints += matchPoints;
                } else {
                    gapSkills.push(reqSkill);
                }
            });
            
            const matchPercent = totalPoints > 0 ? Math.round((earnedPoints / totalPoints) * 100) : 0;
            
            return {
                score: matchPercent,
                matched: [...new Set(matchedSkills)], // Remove duplicates
                gaps: gapSkills
            };
        }
        
        function loadSampleOpportunities() {
            // Show loading state
            const resultsDiv = document.getElementById('opportunitiesResults');
            resultsDiv.innerHTML = `
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p style="font-size: 1.2em;">Searching RemoteOK for real jobs...</p>
                    <p style="margin-top: 10px; color: #6b7280;">Fetching opportunities that match your skills</p>
                </div>
            `;
            
            // Fetch real jobs from RemoteOK API
            fetchRemoteOKJobs();
        }
        
        async function fetchRemoteOKJobs() {
            try {
                // RemoteOK provides a public JSON API
                const response = await fetch('https://remoteok.com/api');
                const data = await response.json();
                
                // First item is metadata, skip it
                const jobs = data.slice(1);
                
                // STEP 1: Filter by ROLE LEVEL using user preferences
                const seniorityKeywords = userData.preferences.seniorityKeywords;
                const excludeKeywords = userData.preferences.excludeRoles;
                
                const executiveJobs = jobs.filter(job => {
                    const titleLower = job.position.toLowerCase();
                    
                    // If user sets threshold VERY low (0-20%), bypass ALL seniority filtering
                    // This shows them everything including jobs they're overqualified for
                    if (userData.preferences.minimumMatchScore <= 20) {
                        return true; // Show everything
                    }
                    
                    // EXCLUDE: Roles user doesn't want
                    if (excludeKeywords.some(keyword => titleLower.includes(keyword))) {
                        return false;
                    }
                    
                    // INCLUDE: Must match user's seniority level
                    const hasSeniority = seniorityKeywords.some(keyword => titleLower.includes(keyword));
                    if (!hasSeniority) return false;
                    
                    // STEP 2: Filter by ROLE TYPE using user's strategic keywords
                    const strategicKeywords = userData.preferences.strategicKeywords;
                    const hasStrategicRole = strategicKeywords.some(keyword => titleLower.includes(keyword));
                    
                    return hasStrategicRole;
                });
                
                console.log(`RemoteOK: Filtered to ${executiveJobs.length} matching roles from ${jobs.length} total`);
                
                // STEP 3: Enhanced skill extraction and matching
                const qualifiedJobs = executiveJobs.map(job => {
                    const extractedSkills = extractSkillsFromJobEnhanced(job);
                    const match = calculateMatchScore(extractedSkills, extractedSkills);
                    
                    return {
                        id: job.id || Math.random().toString(36),
                        title: job.position,
                        company: job.company,
                        location: job.location || 'Remote',
                        type: 'Full-time',
                        url: job.url || `https://remoteok.com/remote-jobs/${job.slug}`,
                        salary: job.salary_max ? `$${Math.round(job.salary_min/1000) || 0}k-${Math.round(job.salary_max/1000)}k` : 'Not specified',
                        description: job.description,
                        tags: job.tags || [],
                        requiredSkills: extractedSkills,
                        matchScore: match.score,
                        matchedSkills: match.matched,
                        gapSkills: match.gaps,
                        source: 'RemoteOK'
                    };
                }).filter(job => {
                    // STEP 4: Apply flexible quality thresholds
                    // If threshold is VERY low (0-20%), show ALL jobs (user wants to see everything)
                    if (userData.preferences.minimumMatchScore <= 20) {
                        return true; // Bypass all quality filters
                    }
                    
                    // Otherwise use normal filters
                    const meetsSkillMinimum = job.matchedSkills.length >= userData.preferences.minimumSkillMatches;
                    const meetsScoreMinimum = job.matchScore >= userData.preferences.minimumMatchScore;
                    const meetsSalary = !userData.preferences.minSalary || 
                                       (job.salary && parseInt(job.salary.split('-')[1]) >= userData.preferences.minSalary/1000);
                    
                    return meetsSkillMinimum && meetsScoreMinimum && meetsSalary;
                });
                
                console.log(`RemoteOK: ${qualifiedJobs.length} qualified jobs`);
                return qualifiedJobs;
                
            } catch (error) {
                console.error('Error fetching RemoteOK jobs:', error);
                return [];
            }
        }
        
        function extractSkillsFromJobEnhanced(job) {
            const searchText = `${job.position} ${job.description || ''} ${(job.tags || []).join(' ')}`.toLowerCase();
            const extractedSkills = [];
            
            // ENHANCED: Expanded skill mapping with synonyms and variations
            const skillMapping = {
                // Strategic Core
                'Enterprise AI Strategy': ['ai strategy', 'artificial intelligence strategy', 'enterprise ai', 'ai transformation', 'ai roadmap', 'ai leadership'],
                'Strategic Foresight & Market Prediction': ['market prediction', 'strategic foresight', 'forecasting', 'trend analysis', 'future of work', 'market intelligence', 'competitive intelligence'],
                'Go-to-Market Strategy': ['go-to-market', 'gtm strategy', 'market strategy', 'launch strategy', 'product launch', 'market entry'],
                'Business Case Development': ['business case', 'roi analysis', 'business development', 'financial modeling', 'investment analysis'],
                'C-Suite Advisory & Influence': ['c-suite', 'executive advisory', 'board advisory', 'executive coaching', 'executive stakeholder', 'ceo advisor'],
                'Organizational Transformation': ['transformation', 'change management', 'organizational change', 'digital transformation', 'org transformation', 'restructuring'],
                
                // Technology & Innovation
                'AI/ML Product Strategy': ['ai product', 'ml product', 'machine learning strategy', 'ai/ml', 'ai product management', 'ml roadmap'],
                'Technology Trend Forecasting': ['technology trends', 'tech forecasting', 'innovation trends', 'emerging tech', 'technology radar'],
                'Disruptive Innovation Identification': ['disruptive innovation', 'innovation strategy', 'breakthrough innovation', 'radical innovation'],
                'Human-AI Collaboration Model Design': ['human-ai', 'ai collaboration', 'human-centered ai', 'ai interaction', 'human augmentation'],
                'Technology Lifecycle & Disruption Analysis': ['technology lifecycle', 'disruption analysis', 'tech adoption', 'innovation curve'],
                'Platform Integration Architecture': ['platform integration', 'system architecture', 'enterprise architecture', 'integration strategy'],
                
                // Communication & Leadership
                'Industry Evangelism': ['evangelist', 'developer relations', 'community building', 'developer advocacy', 'technical evangelism'],
                'Thought Leadership Authorship': ['thought leadership', 'content strategy', 'industry speaking', 'executive writing', 'industry expert'],
                'Technical Concept Translation': ['technical communication', 'executive communication', 'technical writing', 'concept translation'],
                'Public Speaking & Keynote Delivery': ['public speaking', 'keynote', 'conference speaking', 'presentations', 'speaker'],
                'Media Relations & Spokesperson Work': ['media relations', 'spokesperson', 'press relations', 'public relations', 'media spokesperson'],
                
                // Domain Expertise - Talent/HR Tech
                'Talent Intelligence Platform Design': ['talent platform', 'hr tech', 'talent technology', 'talent systems', 'hris', 'applicant tracking'],
                'Workforce Intelligence & Analytics': ['workforce analytics', 'people analytics', 'talent analytics', 'hr analytics', 'workforce planning'],
                'HR Technology Market Intelligence': ['hr technology', 'hrtech', 'talent tech', 'hr software', 'talent management'],
                'Talent Acquisition Strategy': ['talent acquisition', 'recruitment strategy', 'hiring strategy', 'sourcing strategy', 'recruiting'],
                'Candidate Experience Architecture': ['candidate experience', 'recruitment experience', 'hiring experience', 'candidate journey'],
                
                // Leadership & Management
                'Executive Presence & Authority': ['executive presence', 'executive leadership', 'leadership presence', 'executive impact'],
                'Crisis Leadership & Decision Making': ['crisis management', 'crisis leadership', 'emergency response', 'incident management'],
                'Strategic Team Building': ['team building', 'organizational design', 'team strategy', 'talent development', 'team leadership'],
                'Multi-Stakeholder Alignment': ['stakeholder management', 'stakeholder alignment', 'cross-functional', 'stakeholder engagement'],
                'Revenue Pipeline Development': ['pipeline development', 'revenue strategy', 'sales pipeline', 'pipeline management'],
                
                // Data & Analysis
                'Data-Driven Strategy Development': ['data-driven', 'data strategy', 'analytics strategy', 'data-informed', 'evidence-based'],
                'Predictive Framework Development': ['predictive framework', 'predictive modeling', 'forecasting models', 'prediction systems'],
                'Research Synthesis & Forecasting': ['research synthesis', 'market research', 'competitive analysis', 'industry research'],
                'Critical Analysis & Evaluation': ['critical analysis', 'evaluation', 'assessment', 'analytical thinking'],
                
                // Product & Strategy
                'Scenario Planning & Strategic Alternatives': ['scenario planning', 'strategic planning', 'contingency planning', 'alternative strategies'],
                'Rhetorical Strategy & Persuasion': ['persuasion', 'influence', 'negotiation', 'storytelling'],
                'Customer Advisory Board Leadership': ['advisory board', 'customer advisory', 'cab leadership', 'advisory council'],
                'Enterprise Client Relationship Management': ['enterprise sales', 'account management', 'client relationship', 'enterprise accounts']
            };
            
            // Weight skills by importance in job posting
            const skillMatches = {};
            
            Object.entries(skillMapping).forEach(([skill, keywords]) => {
                let matchCount = 0;
                let matchWeight = 0;
                
                keywords.forEach((keyword) => {
                    const regex = new RegExp('\\b' + keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'gi');
                    const matches = searchText.match(regex);
                    if (matches) {
                        matchCount += matches.length;
                        
                        // Weight based on where keyword appears
                        if (job.position.toLowerCase().includes(keyword)) {
                            matchWeight += 3;  // Title match is most important
                        } else if (searchText.indexOf(keyword) < 200) {
                            matchWeight += 2;  // Early mention is important
                        } else {
                            matchWeight += 1;  // Later mention
                        }
                    }
                });
                
                if (matchCount > 0) {
                    skillMatches[skill] = matchWeight;
                }
            });
            
            // Sort by weight and extract top matches
            const sortedSkills = Object.entries(skillMatches)
                .sort((a, b) => b[1] - a[1])
                .map(([skill]) => skill);
            
            return sortedSkills;
        }
        
        function loadSampleData() {
            const sampleJobs = [
                {
                    id: 1,
                    title: "VP of AI Strategy",
                    company: "TechCorp",
                    location: "San Francisco, CA / Remote",
                    type: "Full-time",
                    url: "#",
                    salary: "$200k-$300k",
                    requiredSkills: ["Enterprise AI Strategy", "Strategic Foresight & Market Prediction", "C-Suite Advisory & Influence", "Technology Trend Forecasting", "Business Case Development", "Go-to-Market Strategy"]
                },
                {
                    id: 2,
                    title: "Chief Strategy Officer",
                    company: "GrowthCo",
                    location: "New York, NY / Remote",
                    type: "Full-time",
                    url: "#",
                    salary: "$250k-$350k",
                    requiredSkills: ["Go-to-Market Strategy", "Business Case Development", "Strategic Foresight & Market Prediction", "Multi-Stakeholder Alignment", "Revenue Pipeline Development", "Financial Management & Budget Discipline"]
                },
                {
                    id: 3,
                    title: "Director of Technology Strategy",
                    company: "Innovation Labs",
                    location: "Austin, TX / Remote",
                    type: "Full-time",
                    url: "#",
                    salary: "$180k-$240k",
                    requiredSkills: ["Technology Lifecycle & Disruption Analysis", "Platform Integration Architecture", "Computational & Systems Thinking", "Data-Driven Strategy Development", "Market & Competitive Intelligence"]
                },
                {
                    id: 4,
                    title: "Head of Talent Intelligence",
                    company: "WorkTech Inc",
                    location: "Remote",
                    type: "Full-time",
                    url: "#",
                    salary: "$160k-$220k",
                    requiredSkills: ["Talent Intelligence Platform Design", "Workforce Intelligence & Analytics", "AI/ML Product Strategy", "Candidate Experience Architecture", "Talent Acquisition Strategy", "HR Technology Market Intelligence"]
                },
                {
                    id: 5,
                    title: "Chief Evangelist",
                    company: "AI Startup",
                    location: "Boston, MA / Remote",
                    type: "Full-time",
                    url: "#",
                    salary: "$150k-$200k + equity",
                    requiredSkills: ["Industry Evangelism", "Technical Concept Translation", "Thought Leadership Authorship", "Public Speaking & Keynote Delivery", "Media Relations & Spokesperson Work"]
                },
                {
                    id: 6,
                    title: "VP of Product Strategy",
                    company: "SaaS Platform",
                    location: "Seattle, WA / Remote",
                    type: "Full-time",
                    url: "#",
                    salary: "$190k-$260k",
                    requiredSkills: ["AI/ML Product Strategy", "Human-AI Collaboration Model Design", "Predictive Framework Development", "Scenario Planning & Strategic Alternatives", "Disruptive Innovation Identification"]
                }
            ];
            
            opportunitiesData = sampleJobs.map(job => {
                const match = calculateMatchScore(job.requiredSkills, job.requiredSkills);
                return {
                    ...job,
                    matchScore: match.score,
                    matchedSkills: match.matched,
                    gapSkills: match.gaps
                };
            });
            
            opportunitiesData.sort((a, b) => b.matchScore - a.matchScore);
            renderOpportunities();
        }
        
        function extractSkillsFromJob(job) {
            // Extract skills from job description and tags
            const searchText = `${job.position} ${job.description || ''} ${(job.tags || []).join(' ')}`.toLowerCase();
            const extractedSkills = [];
            
            // Map common job keywords to Cliff's skills
            const skillKeywords = {
                'ai strategy': 'Enterprise AI Strategy',
                'artificial intelligence': 'AI/ML Product Strategy',
                'machine learning': 'AI/ML Product Strategy',
                'strategic planning': 'Strategic Foresight & Market Prediction',
                'business strategy': 'Go-to-Market Strategy',
                'product strategy': 'AI/ML Product Strategy',
                'thought leadership': 'Thought Leadership Authorship',
                'public speaking': 'Public Speaking & Keynote Delivery',
                'evangelist': 'Industry Evangelism',
                'technology strategy': 'Technology Lifecycle & Disruption Analysis',
                'data analytics': 'Data-Driven Strategy Development',
                'talent': 'Talent Acquisition Strategy',
                'hr tech': 'HR Technology Market Intelligence',
                'workforce': 'Workforce Intelligence & Analytics',
                'crisis management': 'Crisis Leadership & Decision Making',
                'team building': 'Strategic Team Building',
                'c-suite': 'C-Suite Advisory & Influence',
                'executive': 'Executive Presence & Authority',
                'innovation': 'Disruptive Innovation Identification',
                'transformation': 'Organizational Transformation',
                'advisory': 'C-Suite Advisory & Influence'
            };
            
            // Check which skills are mentioned
            Object.entries(skillKeywords).forEach(([keyword, skill]) => {
                if (searchText.includes(keyword) && !extractedSkills.includes(skill)) {
                    extractedSkills.push(skill);
                }
            });
            
            // If no specific skills found, add some generic strategic ones
            if (extractedSkills.length === 0) {
                extractedSkills.push('Strategic Foresight & Market Prediction', 'Go-to-Market Strategy', 'Business Case Development');
            }
            
            return extractedSkills;
        }
        
        function filterOpportunities() {
            renderOpportunities();
        }
        
        function renderOpportunities() {
            const filtered = opportunitiesData.filter(job => job.matchScore >= currentMatchThreshold);
            const resultsDiv = document.getElementById('opportunitiesResults');
            
            if (filtered.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="loading-state">
                        <p style="font-size: 1.2em;">No opportunities match your current filters</p>
                        <p style="margin-top: 10px;">Try lowering the match threshold or searching for new jobs</p>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="opportunities-grid">';
            
            filtered.forEach(job => {
                const matchClass = job.matchScore >= 80 ? 'high' : job.matchScore >= 60 ? 'medium' : 'low';
                const jobUrl = job.url || '#';
                const salary = job.salary || 'Salary not specified';
                
                html += `
                    <div class="opportunity-card">
                        <div class="opportunity-header">
                            <div>
                                <div class="opportunity-company">${job.company}</div>
                                <div class="opportunity-title">
                                    <a href="${jobUrl}" target="_blank" style="color: inherit; text-decoration: none;">
                                        ${job.title}
                                    </a>
                                </div>
                            </div>
                            <div class="match-score">
                                <div class="match-circle ${matchClass}">
                                    ${job.matchScore}%
                                </div>
                                <div class="match-label">Match</div>
                            </div>
                        </div>
                        
                        <div class="opportunity-meta">
                            <div class="meta-item">üìç ${job.location}</div>
                            <div class="meta-item">üíº ${job.type}</div>
                            <div class="meta-item">üí∞ ${salary}</div>
                            ${job.source ? `<div class="meta-item" style="color: #10b981;">üåê ${job.source}</div>` : ''}
                        </div>
                        
                        <div class="matched-skills">
                            <div class="matched-skills-title">Your Matching Skills (${job.matchedSkills.length})</div>
                            <div class="skill-chips">
                                ${job.matchedSkills.slice(0, 5).map(skill => 
                                    `<span class="skill-chip-match">${skill}</span>`
                                ).join('')}
                                ${job.matchedSkills.length > 5 ? 
                                    `<span class="skill-chip-match">+${job.matchedSkills.length - 5} more</span>` : ''}
                            </div>
                        </div>
                        
                        ${job.gapSkills.length > 0 ? `
                            <div class="matched-skills">
                                <div class="matched-skills-title">Skills to Highlight (${job.gapSkills.length})</div>
                                <div class="skill-chips">
                                    ${job.gapSkills.slice(0, 3).map(skill => 
                                        `<span class="skill-chip-gap">${skill}</span>`
                                    ).join('')}
                                    ${job.gapSkills.length > 3 ? 
                                        `<span class="skill-chip-gap">+${job.gapSkills.length - 3} more</span>` : ''}
                                </div>
                            </div>
                        ` : ''}
                        
                        <div class="opportunity-actions">
                            <button class="action-btn" onclick="event.stopPropagation(); window.open('${jobUrl}', '_blank')">
                                üîó View Job
                            </button>
                            <button class="action-btn" onclick="event.stopPropagation(); generatePitch(${job.id})">
                                ‚úçÔ∏è Generate Pitch
                            </button>
                            <button class="action-btn" onclick="event.stopPropagation(); viewOnNetwork(${job.id})">
                                üó∫Ô∏è View on Network
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }
        
        function searchOpportunities() {
            const resultsDiv = document.getElementById('opportunitiesResults');
            resultsDiv.innerHTML = `
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p style="font-size: 1.2em;">Searching 4 job boards...</p>
                    <p style="margin-top: 10px; color: #6b7280;">RemoteOK, Remotive, Arbeitnow, WeWorkRemotely</p>
                </div>
            `;
            
            // Fetch from multiple sources simultaneously
            Promise.all([
                fetchRemoteOKJobs().catch(e => { console.error('RemoteOK failed:', e); return []; }),
                fetchRemotiveJobs().catch(e => { console.error('Remotive failed:', e); return []; }),
                fetchArbeitnowJobs().catch(e => { console.error('Arbeitnow failed:', e); return []; }),
                fetchWeWorkRemotelyJobs().catch(e => { console.error('WeWorkRemotely failed:', e); return []; })
            ]).then(results => {
                // Combine and deduplicate
                const allJobs = results.flat();
                
                // Deduplicate by title + company
                const seen = new Set();
                opportunitiesData = allJobs.filter(job => {
                    const key = `${job.title}-${job.company}`.toLowerCase();
                    if (seen.has(key)) return false;
                    seen.add(key);
                    return true;
                });
                
                // Sort by match score
                opportunitiesData.sort((a, b) => b.matchScore - a.matchScore);
                
                console.log(`Total jobs after deduplication: ${opportunitiesData.length}`);
                
                if (opportunitiesData.length === 0) {
                    resultsDiv.innerHTML = `
                        <div class="loading-state">
                            <p style="font-size: 1.2em;">No jobs match your criteria</p>
                            <p style="margin-top: 10px; color: #9ca3af;">
                                Current settings:
                                <br>‚Ä¢ Seniority: ${userData.preferences.seniorityLevel}
                                <br>‚Ä¢ Min Match Score: ${userData.preferences.minimumMatchScore}%
                                <br>‚Ä¢ Min Skills: ${userData.preferences.minimumSkillMatches}
                                <br><br>
                                <strong style="color: #60a5fa;">üí° TIP:</strong> Lower the match threshold above to <strong>0-20%</strong> to see ALL jobs (including ones you're overqualified for).
                                <br><br>
                                Or try:
                                <br>‚Ä¢ Adjusting preferences in Settings tab
                                <br>‚Ä¢ Checking back later
                            </p>
                            <button class="action-btn" onclick="loadSampleData()" style="margin-top: 20px;">
                                View Sample Jobs Instead
                            </button>
                        </div>
                    `;
                    return;
                }
                
                renderOpportunities();
            });
        }
        
        async function fetchWeWorkRemotelyJobs() {
            try {
                // WeWorkRemotely doesn't have a public API, but we can try to fetch their RSS feed
                // This is a fallback approach - in production you'd want server-side scraping
                console.log('Attempting to fetch WeWorkRemotely jobs...');
                
                // For now, return sample data that looks like WeWorkRemotely results
                // In production, this would be replaced with actual scraping
                const wwrSampleJobs = [
                    {
                        title: "Director of Product Strategy",
                        company: "Remote Tech Co",
                        location: "Remote (Worldwide)",
                        type: "Full-time",
                        url: "https://weworkremotely.com/",
                        salary: "$160k-$220k",
                        description: "Lead product strategy for B2B SaaS platform. Work with executive team on roadmap and vision.",
                        requiredSkills: ["AI/ML Product Strategy", "Go-to-Market Strategy", "Strategic Foresight & Market Prediction"]
                    },
                    {
                        title: "VP of Customer Success",
                        company: "SaaS Growth Inc",
                        location: "Remote (US)",
                        type: "Full-time",
                        url: "https://weworkremotely.com/",
                        salary: "$180k-$240k",
                        description: "Build and scale customer success organization. Report to CEO.",
                        requiredSkills: ["Customer Advisory Board Leadership", "Enterprise Client Relationship Management", "Strategic Team Building"]
                    }
                ];
                
                return wwrSampleJobs.map(job => {
                    const match = calculateMatchScore(job.requiredSkills, job.requiredSkills);
                    return {
                        id: Math.random().toString(36).substr(2, 9),
                        ...job,
                        matchScore: match.score,
                        matchedSkills: match.matched,
                        gapSkills: match.gaps,
                        source: 'WeWorkRemotely'
                    };
                }).filter(job => {
                    const meetsSkillMinimum = job.matchedSkills.length >= userData.preferences.minimumSkillMatches;
                    const meetsScoreMinimum = job.matchScore >= userData.preferences.minimumMatchScore;
                    return meetsSkillMinimum && meetsScoreMinimum;
                });
                
            } catch (error) {
                console.error('WeWorkRemotely fetch error:', error);
                return [];
            }
        }
        
        async function fetchRemotiveJobs() {
            try {
                console.log('Fetching from Remotive.io API...');
                
                // Remotive has a free public API
                const response = await fetch('https://remotive.com/api/remote-jobs');
                const data = await response.json();
                
                if (!data.jobs || data.jobs.length === 0) {
                    console.log('Remotive: No jobs returned');
                    return [];
                }
                
                // Filter and map Remotive jobs
                const jobs = data.jobs.slice(0, 100); // Limit to first 100 for performance
                
                // Apply same filtering logic
                const seniorityKeywords = userData.preferences.seniorityKeywords;
                const excludeKeywords = userData.preferences.excludeRoles;
                const strategicKeywords = userData.preferences.strategicKeywords;
                
                const filteredJobs = jobs.filter(job => {
                    const titleLower = job.title.toLowerCase();
                    
                    // Bypass filters if threshold is very low
                    if (userData.preferences.minimumMatchScore <= 20) {
                        return true;
                    }
                    
                    // EXCLUDE
                    if (excludeKeywords.some(keyword => titleLower.includes(keyword))) {
                        return false;
                    }
                    
                    // INCLUDE seniority
                    const hasSeniority = seniorityKeywords.some(keyword => titleLower.includes(keyword));
                    if (!hasSeniority) return false;
                    
                    // Strategic keywords
                    const hasStrategicRole = strategicKeywords.some(keyword => titleLower.includes(keyword));
                    return hasStrategicRole;
                });
                
                const processedJobs = filteredJobs.map(job => {
                    const extractedSkills = extractSkillsFromJobEnhanced({
                        position: job.title,
                        description: job.description,
                        tags: job.tags || []
                    });
                    const match = calculateMatchScore(extractedSkills, extractedSkills);
                    
                    return {
                        id: `remotive-${job.id}`,
                        title: job.title,
                        company: job.company_name,
                        location: job.candidate_required_location || 'Remote',
                        type: job.job_type || 'Full-time',
                        url: job.url,
                        salary: job.salary || 'Not specified',
                        description: job.description,
                        tags: job.tags || [],
                        requiredSkills: extractedSkills,
                        matchScore: match.score,
                        matchedSkills: match.matched,
                        gapSkills: match.gaps,
                        source: 'Remotive'
                    };
                }).filter(job => {
                    // Apply quality thresholds
                    if (userData.preferences.minimumMatchScore <= 20) {
                        return true;
                    }
                    
                    const meetsSkillMinimum = job.matchedSkills.length >= userData.preferences.minimumSkillMatches;
                    const meetsScoreMinimum = job.matchScore >= userData.preferences.minimumMatchScore;
                    return meetsSkillMinimum && meetsScoreMinimum;
                });
                
                console.log(`Remotive: ${processedJobs.length} qualified jobs`);
                return processedJobs;
                
            } catch (error) {
                console.error('Remotive fetch error:', error);
                return [];
            }
        }
        
        async function fetchArbeitnowJobs() {
            try {
                console.log('Fetching from Arbeitnow API...');
                
                // Arbeitnow is a free job board API
                const response = await fetch('https://www.arbeitnow.com/api/job-board-api');
                const data = await response.json();
                
                if (!data.data || data.data.length === 0) {
                    console.log('Arbeitnow: No jobs returned');
                    return [];
                }
                
                const jobs = data.data.slice(0, 100);
                
                // Apply filtering
                const seniorityKeywords = userData.preferences.seniorityKeywords;
                const excludeKeywords = userData.preferences.excludeRoles;
                const strategicKeywords = userData.preferences.strategicKeywords;
                
                const filteredJobs = jobs.filter(job => {
                    const titleLower = job.title.toLowerCase();
                    
                    // Bypass if threshold very low
                    if (userData.preferences.minimumMatchScore <= 20) {
                        return true;
                    }
                    
                    // EXCLUDE
                    if (excludeKeywords.some(keyword => titleLower.includes(keyword))) {
                        return false;
                    }
                    
                    // INCLUDE seniority
                    const hasSeniority = seniorityKeywords.some(keyword => titleLower.includes(keyword));
                    if (!hasSeniority) return false;
                    
                    // Strategic
                    const hasStrategicRole = strategicKeywords.some(keyword => titleLower.includes(keyword));
                    return hasStrategicRole;
                });
                
                const processedJobs = filteredJobs.map(job => {
                    const extractedSkills = extractSkillsFromJobEnhanced({
                        position: job.title,
                        description: job.description,
                        tags: job.tags || []
                    });
                    const match = calculateMatchScore(extractedSkills, extractedSkills);
                    
                    return {
                        id: `arbeitnow-${job.slug}`,
                        title: job.title,
                        company: job.company_name,
                        location: job.location || 'Remote',
                        type: job.job_types?.[0] || 'Full-time',
                        url: job.url,
                        salary: 'Not specified',
                        description: job.description,
                        tags: job.tags || [],
                        requiredSkills: extractedSkills,
                        matchScore: match.score,
                        matchedSkills: match.matched,
                        gapSkills: match.gaps,
                        source: 'Arbeitnow'
                    };
                }).filter(job => {
                    if (userData.preferences.minimumMatchScore <= 20) {
                        return true;
                    }
                    
                    const meetsSkillMinimum = job.matchedSkills.length >= userData.preferences.minimumSkillMatches;
                    const meetsScoreMinimum = job.matchScore >= userData.preferences.minimumMatchScore;
                    return meetsSkillMinimum && meetsScoreMinimum;
                });
                
                console.log(`Arbeitnow: ${processedJobs.length} qualified jobs`);
                return processedJobs;
                
            } catch (error) {
                console.error('Arbeitnow fetch error:', error);
                return [];
            }
        }
        
        function viewOpportunityDetail(jobId) {
            const job = opportunitiesData.find(j => j.id === jobId);
            alert(`Detailed view for ${job.title} at ${job.company}\n\nMatch: ${job.matchScore}%\nMatched Skills: ${job.matchedSkills.length}\nGaps: ${job.gapSkills.length}\n\nFull detail view coming in next update!`);
        }
        
        function generatePitch(jobId) {
            const job = opportunitiesData.find(j => j.id === jobId);
            if (!job) return;
            
            // Get shared outcomes from blueprint
            const sharedOutcomes = blueprintData.outcomes.filter(o => o.shared);
            const selectedValues = blueprintData.values.filter(v => v.selected);
            
            // Build pitch using matched skills
            let pitch = `Dear Hiring Manager,\n\n`;
            pitch += `I'm writing to express my interest in the ${job.title} position at ${job.company}. `;
            pitch += `My background aligns strongly with your requirements, with a ${job.matchScore}% match to the role's key competencies.\n\n`;
            
            // Outcomes section
            if (sharedOutcomes.length > 0) {
                pitch += `**Key Outcomes I've Driven:**\n\n`;
                // Prioritize outcomes related to matched skills
                const relevantOutcomes = sharedOutcomes.filter(outcome => 
                    job.matchedSkills.some(skill => outcome.skill.includes(skill) || outcome.text.toLowerCase().includes(skill.toLowerCase()))
                ).slice(0, 3);
                
                if (relevantOutcomes.length > 0) {
                    relevantOutcomes.forEach(outcome => {
                        pitch += `‚Ä¢ ${outcome.text}\n`;
                    });
                } else {
                    sharedOutcomes.slice(0, 3).forEach(outcome => {
                        pitch += `‚Ä¢ ${outcome.text}\n`;
                    });
                }
                pitch += `\n`;
            }
            
            // Skills match section
            pitch += `**Your Requirements - My Experience:**\n\n`;
            job.matchedSkills.slice(0, 5).forEach(skill => {
                const skillData = skillsData.skills.find(s => s.name === skill);
                const evidence = skillsData.skillDetails[skill];
                if (evidence && evidence.evidence && evidence.evidence.length > 0) {
                    pitch += `‚Ä¢ **${skill}**: ${evidence.evidence[0]}\n`;
                } else {
                    pitch += `‚Ä¢ **${skill}**: ${skillData ? skillData.level + ' level proficiency' : 'Demonstrated expertise'}\n`;
                }
            });
            pitch += `\n`;
            
            // Values alignment
            if (selectedValues.length > 0) {
                pitch += `**My Approach:**\n\n`;
                pitch += `I bring ${selectedValues.map(v => v.name.toLowerCase()).slice(0, 3).join(', ')} to this role. `;
                if (blueprintData.purpose) {
                    pitch += blueprintData.purpose;
                }
                pitch += `\n\n`;
            }
            
            pitch += `I'd welcome the opportunity to discuss how my experience can contribute to ${job.company}'s success.\n\n`;
            pitch += `Best regards,\nCliff Jurkiewicz`;
            
            // Show pitch in modal
            showPitchModal(job, pitch);
        }
        
        function showPitchModal(job, pitch) {
            const modal = document.getElementById('exportModal');
            const modalContent = modal.querySelector('.modal-content');
            
            modalContent.innerHTML = `
                <div class="modal-header">
                    <div class="modal-header-left">
                        <h2 class="modal-title">Generated Pitch</h2>
                        <p style="color: #9ca3af; margin-top: 5px;">${job.title} at ${job.company}</p>
                    </div>
                    <button class="modal-close" onclick="closeExportModal()">√ó</button>
                </div>
                <div class="modal-body" style="padding: 30px;">
                    <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(96, 165, 250, 0.2); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                        <textarea id="pitchText" style="width: 100%; min-height: 400px; background: transparent; border: none; color: #e0e0e0; font-family: inherit; font-size: 0.95em; line-height: 1.7; resize: vertical;">${pitch}</textarea>
                    </div>
                    <div style="display: flex; gap: 15px; justify-content: flex-end;">
                        <button class="action-btn" onclick="copyPitch()" style="padding: 10px 20px;">
                            üìã Copy to Clipboard
                        </button>
                        <button class="action-btn" onclick="downloadPitch('${job.title}', '${job.company}')" style="padding: 10px 20px;">
                            üíæ Download as Text
                        </button>
                        <button class="action-btn" onclick="trackFromPitch('${job.id}')" style="padding: 10px 20px; background: rgba(16, 185, 129, 0.2); border-color: #10b981; color: #10b981;">
                            ‚ûï Track Application
                        </button>
                        <button class="export-btn-large" onclick="closeExportModal()" style="padding: 10px 20px;">
                            Done
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }
        
        function copyPitch() {
            const pitchText = document.getElementById('pitchText');
            pitchText.select();
            document.execCommand('copy');
            alert('Pitch copied to clipboard!');
        }
        
        function downloadPitch(jobTitle, company) {
            const pitchText = document.getElementById('pitchText').value;
            const blob = new Blob([pitchText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pitch-${jobTitle.replace(/\s+/g, '-')}-${company.replace(/\s+/g, '-')}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function trackFromPitch(jobId) {
            const job = opportunitiesData.find(j => j.id == jobId);
            if (!job) return;
            
            closeExportModal();
            addApplicationModal(job);
        }
        
        function viewOnNetwork(jobId) {
            const job = opportunitiesData.find(j => j.id === jobId);
            if (!job) return;
            
            // Store job for network highlighting
            window.currentHighlightJob = job;
            
            // Switch to Skills Ontology view (network mode)
            currentView = 'network';
            currentSkillsView = 'network';
            
            // Update navigation
            document.querySelectorAll('.view-toggle button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes('Skills Ontology')) {
                    btn.classList.add('active');
                }
            });
            
            // Show network view
            document.getElementById('networkView').style.display = 'block';
            document.getElementById('cardView').style.display = 'none';
            document.getElementById('opportunitiesView').style.display = 'none';
            document.getElementById('blueprintView').style.display = 'none';
            document.getElementById('consentView').style.display = 'none';
            document.getElementById('settingsView').style.display = 'none';
            document.getElementById('networkControls').style.display = 'flex';
            document.querySelector('.controls').style.display = 'flex';
            
            // Update toggle button state
            document.querySelectorAll('#skillsViewToggle .role-chip').forEach(chip => {
                chip.classList.toggle('active', chip.dataset.view === 'network');
            });
            
            // Reinitialize network with highlighting
            initNetworkWithHighlight(job);
            
            // Update stats bar
            updateStatsBar();
        }
        
        function initNetworkWithHighlight(job) {
            const svg = d3.select("#networkView");
            svg.selectAll("*").remove();
            
            const width = svg.node().getBoundingClientRect().width;
            const height = svg.node().getBoundingClientRect().height;
            
            // Prepare data
            const centerNode = { id: "center", name: userData.profile.name || "You", type: "center" };
            const roleNodes = skillsData.roles.map(role => ({
                id: role.id,
                name: role.name,
                type: "role",
                skills: role.skills
            }));
            
            const skillNodes = skillsData.skills.map(skill => ({
                id: skill.name,
                name: skill.name,
                type: "skill",
                level: skill.level,
                years: skill.years,
                roles: skill.roles,
                isMatch: job.matchedSkills.includes(skill.name)  // NEW: Track if matches job
            }));
            
            const nodes = [centerNode, ...roleNodes, ...skillNodes];
            
            // Create links
            const links = [];
            roleNodes.forEach(role => {
                links.push({ source: "center", target: role.id, type: "role" });
                role.skills.forEach(skillName => {
                    links.push({ source: role.id, target: skillName, type: "skill" });
                });
            });
            
            // Create simulation (same physics as before)
            simulation = d3.forceSimulation(nodes)
                .force("link", d3.forceLink(links).id(d => d.id).distance(d => {
                    if (d.type === "role") return 140;
                    return 160;
                }))
                .force("charge", d3.forceManyBody().strength(d => {
                    if (d.type === "center") return 0;
                    if (d.type === "role") return -250;
                    return -180;
                }))
                .force("center", d3.forceCenter(width / 2, height / 2))
                .force("collision", d3.forceCollide().radius(d => {
                    if (d.type === "center") return 70;
                    if (d.type === "role") return 65;
                    return 45;
                }))
                .force("x", d3.forceX(width / 2).strength(0.08))
                .force("y", d3.forceY(height / 2).strength(0.08))
                .force("radial", d3.forceRadial(d => {
                    if (d.type === "skill") return Math.min(width, height) * 0.4;
                    return 0;
                }).strength(0.1));
            
            // Draw links with highlighting
            const link = svg.append("g")
                .selectAll("line")
                .data(links)
                .join("line")
                .attr("class", "link")
                .style("opacity", d => {
                    // Dim links that don't connect to matching skills
                    if (d.type === "skill") {
                        const targetNode = nodes.find(n => n.id === d.target);
                        return targetNode && targetNode.isMatch ? 0.6 : 0.1;
                    }
                    return 0.3;
                });
            
            // Draw nodes with highlighting
            const node = svg.append("g")
                .selectAll("g")
                .data(nodes)
                .join("g")
                .attr("class", "node")
                .style("opacity", d => {
                    // Highlight matching skills, dim others
                    if (d.type === "skill") {
                        return d.isMatch ? 1 : 0.2;
                    }
                    return 1;  // Keep center and roles fully visible
                })
                .call(d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended));
            
            // Add circles
            node.append("circle")
                .attr("r", d => {
                    if (d.type === "center") return 60;
                    if (d.type === "role") return 50;
                    return d.isMatch ? 25 : 15;  // Matching skills are larger
                })
                .attr("class", d => {
                    if (d.type === "center") return "node-center";
                    if (d.type === "role") return `node-role role-${d.id}`;
                    return `node-skill level-${d.level.toLowerCase().replace(/\s/g, '-')}`;
                })
                .style("stroke", d => {
                    // Green border for matching skills
                    return d.isMatch ? "#10b981" : null;
                })
                .style("stroke-width", d => d.isMatch ? 3 : null);
            
            // Add labels (only show matching skills and roles)
            node.filter(d => d.type === "center" || d.type === "role" || d.isMatch)
                .append("text")
                .text(d => d.name)
                .attr("class", "node-label")
                .style("font-weight", d => d.isMatch ? "bold" : "normal")
                .style("fill", d => d.isMatch ? "#10b981" : "#e0e0e0");
            
            // Update positions on tick
            simulation.on("tick", () => {
                const padding = 100;
                nodes.forEach(d => {
                    if (d.type !== "center") {
                        d.x = Math.max(padding, Math.min(width - padding, d.x));
                        d.y = Math.max(padding, Math.min(height - padding, d.y));
                    }
                });
                
                link
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);
                
                node.attr("transform", d => `translate(${d.x},${d.y})`);
            });
            
            // Add "Return to Opportunities" button overlay
            const buttonContainer = svg.append("foreignObject")
                .attr("x", 20)
                .attr("y", 20)
                .attr("width", 200)
                .attr("height", 50);
            
            buttonContainer.append("xhtml:div")
                .html(`
                    <button onclick="returnToOpportunities()" style="
                        padding: 10px 20px;
                        background: #10b981;
                        color: white;
                        border: none;
                        border-radius: 8px;
                        font-weight: 600;
                        cursor: pointer;
                        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
                    ">
                        ‚Üê Back to Jobs
                    </button>
                `);
        }
        
        function returnToOpportunities() {
            window.currentHighlightJob = null;
            switchView('opportunities');
        }
        
        // ===== SETTINGS SYSTEM =====
        
        function initSettings() {
            const view = document.getElementById('settingsView');
            
            view.innerHTML = `
                <div class="blueprint-container">
                    <div class="blueprint-header">
                        <h1 class="blueprint-title">Profile Settings</h1>
                        <p class="blueprint-subtitle">Configure Your Work Blueprint Experience</p>
                        <p class="blueprint-tagline">Customize how jobs are matched and filtered</p>
                    </div>
                    
                    ${renderProfileSettings()}
                    ${renderJobPreferences()}
                </div>
            `;
        }
        
        function renderProfileSettings() {
            return `
                <div class="blueprint-section">
                    <div class="blueprint-section-header">
                        <div class="blueprint-section-title">
                            <span class="section-icon">üë§</span>
                            <span>Profile Information</span>
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <label class="settings-label">Your Name</label>
                        <input type="text" class="settings-input" id="settingName" 
                               value="${userData.profile.name}" 
                               placeholder="Enter your name">
                        <div class="settings-help">This appears in the header and exports</div>
                    </div>
                    
                    <div class="settings-group">
                        <label class="settings-label">Email (Optional)</label>
                        <input type="email" class="settings-input" id="settingEmail" 
                               value="${userData.profile.email}" 
                               placeholder="your.email@example.com">
                        <div class="settings-help">For export contact information</div>
                    </div>
                    
                    <div class="settings-group">
                        <label class="settings-label">Location (for market valuation)</label>
                        <select class="settings-select" id="settingLocation">
                            <option value="Philadelphia, PA" ${userData.profile.location === 'Philadelphia, PA' ? 'selected' : ''}>Philadelphia, PA</option>
                            <option value="San Francisco Bay Area, CA">San Francisco Bay Area, CA</option>
                            <option value="New York City, NY">New York City, NY</option>
                            <option value="Seattle, WA">Seattle, WA</option>
                            <option value="Boston, MA">Boston, MA</option>
                            <option value="Washington DC">Washington DC</option>
                            <option value="Los Angeles, CA">Los Angeles, CA</option>
                            <option value="San Diego, CA">San Diego, CA</option>
                            <option value="Denver, CO">Denver, CO</option>
                            <option value="Austin, TX">Austin, TX</option>
                            <option value="Chicago, IL">Chicago, IL</option>
                            <option value="Atlanta, GA">Atlanta, GA</option>
                            <option value="Remote">Remote</option>
                            <option value="Phoenix, AZ">Phoenix, AZ</option>
                            <option value="Dallas, TX">Dallas, TX</option>
                            <option value="Houston, TX">Houston, TX</option>
                            <option value="Miami, FL">Miami, FL</option>
                            <option value="Portland, OR">Portland, OR</option>
                            <option value="Charlotte, NC">Charlotte, NC</option>
                            <option value="Nashville, TN">Nashville, TN</option>
                            <option value="Indianapolis, IN">Indianapolis, IN</option>
                            <option value="Columbus, OH">Columbus, OH</option>
                            <option value="Kansas City, MO">Kansas City, MO</option>
                            <option value="Omaha, NE">Omaha, NE</option>
                            <option value="Lincoln, NE">Lincoln, NE</option>
                            <option value="Other US Metro">Other US Metro</option>
                            <option value="Rural US">Rural US</option>
                        </select>
                        <div class="settings-help">Your location affects skill market valuations (cost of living adjustment)</div>
                    </div>
                </div>
            `;
        }
        
        function renderJobPreferences() {
            return `
                <div class="blueprint-section">
                    <div class="blueprint-section-header">
                        <div class="blueprint-section-title">
                            <span class="section-icon">üéØ</span>
                            <span>Job Matching Preferences</span>
                        </div>
                    </div>
                    
                    <div class="coaching-tip">
                        <div class="coaching-tip-title">
                            üí° HOW JOB MATCHING WORKS
                        </div>
                        <div class="coaching-tip-content">
                            These settings control which jobs appear in your Opportunities feed. 
                            Set your seniority level to filter out irrelevant positions.
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <label class="settings-label">Seniority Level</label>
                        <select class="settings-select" id="settingSeniority">
                            <option value="Entry" ${userData.preferences.seniorityLevel === 'Entry' ? 'selected' : ''}>Entry Level</option>
                            <option value="Mid" ${userData.preferences.seniorityLevel === 'Mid' ? 'selected' : ''}>Mid Level</option>
                            <option value="Senior" ${userData.preferences.seniorityLevel === 'Senior' ? 'selected' : ''}>Senior Level</option>
                            <option value="Executive" ${userData.preferences.seniorityLevel === 'Executive' ? 'selected' : ''}>Executive Level</option>
                        </select>
                        <div class="settings-help">
                            <strong>Entry:</strong> Includes junior, associate roles<br>
                            <strong>Mid:</strong> Includes senior, lead, manager roles<br>
                            <strong>Senior:</strong> Includes senior manager, director roles<br>
                            <strong>Executive:</strong> VP, Chief, Head of roles only
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <label class="settings-label">Minimum Match Score</label>
                        <input type="range" min="0" max="100" value="${userData.preferences.minimumMatchScore}" 
                               class="match-slider" style="width: 100%;"
                               oninput="document.getElementById('matchScoreValue').textContent = this.value + '%'">
                        <div style="text-align: center; color: #fbbf24; font-weight: 600; font-size: 1.2em; margin-top: 10px;">
                            <span id="matchScoreValue">${userData.preferences.minimumMatchScore}%</span>
                        </div>
                        <div class="settings-help">Only show jobs with at least this match percentage</div>
                    </div>
                    
                    <div class="settings-group">
                        <label class="settings-label">Minimum Skill Matches</label>
                        <input type="number" min="1" max="10" class="settings-input" id="settingMinSkills"
                               value="${userData.preferences.minimumSkillMatches}">
                        <div class="settings-help">Jobs must match at least this many of your skills</div>
                    </div>
                    
                    <div class="settings-group">
                        <label class="settings-label">Minimum Salary (Optional)</label>
                        <input type="number" class="settings-input" id="settingMinSalary" 
                               value="${userData.preferences.minSalary || ''}"
                               placeholder="e.g., 150000">
                        <div class="settings-help">Leave blank for no minimum. Enter annual salary (USD).</div>
                    </div>
                    
                    <button class="save-settings-btn" onclick="saveSettings()">
                        üíæ Save Settings
                    </button>
                </div>
                
                <div class="blueprint-section" style="margin-top: 30px;">
                    <div class="blueprint-section-header">
                        <div class="blueprint-section-title">
                            <span class="section-icon">üíæ</span>
                            <span>Backup & Restore</span>
                        </div>
                    </div>
                    
                    <div class="coaching-tip">
                        <div class="coaching-tip-title">
                            üí° DATA PORTABILITY
                        </div>
                        <div class="coaching-tip-content">
                            Export your complete Work Blueprint as JSON to back up all your data. 
                            Import from a previous export to restore or transfer to another device.
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div style="background: rgba(96, 165, 250, 0.1); border: 1px solid rgba(96, 165, 250, 0.3); border-radius: 8px; padding: 20px;">
                            <h3 style="color: #60a5fa; margin-bottom: 10px;">üì§ Export Profile</h3>
                            <p style="color: #9ca3af; font-size: 0.9em; margin-bottom: 15px;">
                                Download complete backup including skills, outcomes, values, and all settings
                            </p>
                            <button class="export-btn-large" onclick="exportFullProfile()" style="width: 100%;">
                                Download Backup
                            </button>
                        </div>
                        
                        <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 8px; padding: 20px;">
                            <h3 style="color: #10b981; margin-bottom: 10px;">üì• Import Profile</h3>
                            <p style="color: #9ca3af; font-size: 0.9em; margin-bottom: 15px;">
                                Restore from a previous backup or transfer from another device
                            </p>
                            <input type="file" id="importFileInput" accept=".json" style="display: none;" onchange="importFullProfile(this)">
                            <button class="export-btn-large" onclick="document.getElementById('importFileInput').click()" 
                                    style="width: 100%; background: #10b981;">
                                Select Backup File
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: rgba(239, 68, 68, 0.1); border-left: 3px solid #ef4444; border-radius: 4px;">
                        <strong style="color: #ef4444;">‚ö†Ô∏è Warning:</strong>
                        <span style="color: #d1d5db; font-size: 0.9em;">
                            Importing will replace all current data. Make sure to export first if you want to keep your current profile!
                        </span>
                    </div>
                </div>
            `;
        }
        
        function saveUserData() {
            try {
                const dataToSave = {
                    userData: userData,
                    blueprintData: blueprintData,
                    skillsData: {
                        skills: skillsData.skills,
                        roles: skillsData.roles
                    },
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem('workBlueprintData', JSON.stringify(dataToSave));
                console.log('Data saved successfully');
                return true;
            } catch (e) {
                console.error('Failed to save data:', e);
                return false;
            }
        }
        
        // LEGACY: Migrate v1.x data to v2.0 format (kept for backward compatibility)
        function loadUserData() {
            try {
                // Try v2.0 format first
                const v2Data = localStorage.getItem('workBlueprint_userData');
                if (v2Data) {
                    return true; // Already migrated
                }
                
                // Try v1.x format
                const saved = localStorage.getItem('workBlueprintData');
                if (!saved) return false;
                
                const data = JSON.parse(saved);
                
                console.log('üîÑ Migrating v1.x data to v2.0 format...');
                
                // Migrate to v2.0 structure
                userData = {
                    initialized: true,
                    profile: data.userData?.profile || {},
                    skills: skillsData.skills || [],  // Keep hardcoded skills for now
                    skillDetails: skillsData.skillDetails || {},
                    values: data.blueprintData?.values || [],
                    purpose: data.blueprintData?.purpose || "",
                    roles: skillsData.roles || [],
                    preferences: data.userData || {},
                    applications: data.userData?.applications || []
                };
                
                // Save in new format
                localStorage.setItem('workBlueprint_userData', JSON.stringify(userData));
                console.log('‚úì Migration complete');
                
                return true;
            } catch (e) {
                console.error('Failed to load/migrate data:', e);
                return false;
            }
        }
        
        function exportFullProfile() {
            const fullData = {
                userData: userData,
                blueprintData: blueprintData,
                skillsData: {
                    skills: skillsData.skills,
                    roles: skillsData.roles,
                    skillDetails: skillsData.skillDetails
                },
                version: '1.0',
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(fullData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `work-blueprint-full-${userData.profile.name || 'profile'}-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }
        
        function importFullProfile(fileInput) {
            const file = fileInput.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    
                    if (confirm('This will replace your current Work Blueprint data. Continue?')) {
                        // Restore all data
                        if (imported.userData) Object.assign(userData, imported.userData);
                        if (imported.blueprintData) Object.assign(blueprintData, imported.blueprintData);
                        if (imported.skillsData) {
                            if (imported.skillsData.skills) skillsData.skills = imported.skillsData.skills;
                            if (imported.skillsData.roles) skillsData.roles = imported.skillsData.roles;
                            if (imported.skillsData.skillDetails) skillsData.skillDetails = imported.skillsData.skillDetails;
                        }
                        
                        // Save to localStorage
                        saveUserData();
                        
                        alert('Profile imported successfully! Refreshing page...');
                        location.reload();
                    }
                } catch (err) {
                    alert('Error importing profile: ' + err.message);
                }
            };
            reader.readAsText(file);
        }
        
        // ===== APPLICATIONS TRACKER SYSTEM =====
        
        function initApplications() {
            const view = document.getElementById('applicationsView');
            
            view.innerHTML = `
                <div class="applications-header">
                    <h2 style="font-size: 2em; color: #60a5fa; margin-bottom: 10px;">Application Tracker</h2>
                    <p style="color: #9ca3af; margin-bottom: 20px;">Track your job applications and follow-ups</p>
                    <button class="export-btn-large" onclick="addApplicationModal()" style="display: inline-flex; align-items: center; gap: 8px;">
                        ‚ûï Add Application
                    </button>
                </div>
                
                <div id="applicationsContainer"></div>
            `;
            
            renderApplications();
        }
        
        function renderApplications() {
            const container = document.getElementById('applicationsContainer');
            
            if (!userData.applications || userData.applications.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #9ca3af;">
                        <div style="font-size: 3em; margin-bottom: 20px;">üìã</div>
                        <h3 style="color: #d1d5db; margin-bottom: 10px;">No applications tracked yet</h3>
                        <p>Click "Add Application" above to start tracking your job search</p>
                        <div style="margin-top: 30px; text-align: left; max-width: 500px; margin-left: auto; margin-right: auto;">
                            <strong style="color: #60a5fa;">Track from Opportunities:</strong>
                            <p style="font-size: 0.9em; margin-top: 8px;">When you generate a pitch for a job, you'll have the option to automatically add it to your application tracker.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Group by status
            const grouped = {
                applied: userData.applications.filter(a => a.status === 'applied'),
                interviewing: userData.applications.filter(a => a.status === 'interviewing'),
                offer: userData.applications.filter(a => a.status === 'offer'),
                rejected: userData.applications.filter(a => a.status === 'rejected')
            };
            
            container.innerHTML = `
                <div style="margin-bottom: 30px; display: flex; gap: 15px; flex-wrap: wrap;">
                    <div class="application-status status-applied">${grouped.applied.length} Applied</div>
                    <div class="application-status status-interviewing">${grouped.interviewing.length} Interviewing</div>
                    <div class="application-status status-offer">${grouped.offer.length} Offers</div>
                    <div class="application-status status-rejected">${grouped.rejected.length} Closed</div>
                </div>
                
                <div class="applications-grid">
                    ${userData.applications.map((app, idx) => renderApplicationCard(app, idx)).join('')}
                </div>
            `;
        }
        
        function renderApplicationCard(app, idx) {
            const statusLabels = {
                applied: 'Applied',
                interviewing: 'Interviewing',
                offer: 'Offer Received',
                rejected: 'Closed'
            };
            
            return `
                <div class="application-card">
                    <div class="application-status status-${app.status}">
                        ${statusLabels[app.status]}
                    </div>
                    
                    <div class="application-title">${app.title}</div>
                    <div class="application-company">${app.company}</div>
                    
                    <div class="application-meta-grid">
                        <div class="application-meta-item">
                            <div class="application-meta-label">Applied</div>
                            <div class="application-meta-value">${new Date(app.appliedDate).toLocaleDateString()}</div>
                        </div>
                        <div class="application-meta-item">
                            <div class="application-meta-label">Match</div>
                            <div class="application-meta-value">${app.matchScore || 'N/A'}%</div>
                        </div>
                        ${app.salary ? `
                            <div class="application-meta-item">
                                <div class="application-meta-label">Salary</div>
                                <div class="application-meta-value">${app.salary}</div>
                            </div>
                        ` : ''}
                        ${app.nextFollowUp ? `
                            <div class="application-meta-item">
                                <div class="application-meta-label">Follow Up</div>
                                <div class="application-meta-value">${new Date(app.nextFollowUp).toLocaleDateString()}</div>
                            </div>
                        ` : ''}
                    </div>
                    
                    ${app.notes ? `
                        <div class="application-notes">
                            üìù ${app.notes}
                        </div>
                    ` : ''}
                    
                    <div class="application-actions">
                        <button class="application-btn" onclick="updateApplicationStatus(${idx})">
                            üîÑ Update Status
                        </button>
                        <button class="application-btn" onclick="editApplication(${idx})">
                            ‚úèÔ∏è Edit
                        </button>
                        ${app.url ? `
                            <button class="application-btn" onclick="window.open('${app.url}', '_blank')">
                                üîó View Job
                            </button>
                        ` : ''}
                        <button class="application-btn delete" onclick="deleteApplication(${idx})">
                            üóëÔ∏è Remove
                        </button>
                    </div>
                </div>
            `;
        }
        
        function addApplicationModal(jobData = null) {
            const modal = document.getElementById('exportModal');
            const modalContent = modal.querySelector('.modal-content');
            
            modalContent.innerHTML = `
                <div class="modal-header">
                    <div class="modal-header-left">
                        <h2 class="modal-title">Add Application</h2>
                        <p style="color: #9ca3af; margin-top: 5px;">Track a job you've applied to</p>
                    </div>
                    <button class="modal-close" onclick="closeExportModal()">√ó</button>
                </div>
                <div class="modal-body" style="padding: 30px;">
                    <div style="display: grid; gap: 20px;">
                        <div>
                            <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">Job Title *</label>
                            <input type="text" id="appTitle" value="${jobData?.title || ''}" class="settings-input" required>
                        </div>
                        
                        <div>
                            <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">Company *</label>
                            <input type="text" id="appCompany" value="${jobData?.company || ''}" class="settings-input" required>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">Applied Date *</label>
                                <input type="date" id="appDate" value="${new Date().toISOString().split('T')[0]}" class="settings-input" required>
                            </div>
                            <div>
                                <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">Status</label>
                                <select id="appStatus" class="settings-select">
                                    <option value="applied">Applied</option>
                                    <option value="interviewing">Interviewing</option>
                                    <option value="offer">Offer Received</option>
                                    <option value="rejected">Closed</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">Salary Range</label>
                                <input type="text" id="appSalary" value="${jobData?.salary || ''}" placeholder="e.g., $150k-$200k" class="settings-input">
                            </div>
                            <div>
                                <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">Match Score</label>
                                <input type="number" id="appMatch" value="${jobData?.matchScore || ''}" min="0" max="100" class="settings-input">
                            </div>
                        </div>
                        
                        <div>
                            <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">Job URL</label>
                            <input type="url" id="appUrl" value="${jobData?.url || ''}" placeholder="https://" class="settings-input">
                        </div>
                        
                        <div>
                            <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">Follow-Up Date</label>
                            <input type="date" id="appFollowUp" class="settings-input">
                        </div>
                        
                        <div>
                            <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">Notes</label>
                            <textarea id="appNotes" class="purpose-editor" style="min-height: 80px;" placeholder="Contact names, interview details, etc."></textarea>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 25px;">
                        <button class="action-btn" onclick="closeExportModal()" style="padding: 10px 20px;">
                            Cancel
                        </button>
                        <button class="export-btn-large" onclick="saveApplication()" style="padding: 10px 20px;">
                            ‚ûï Add Application
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }
        
        function saveApplication() {
            const title = document.getElementById('appTitle').value.trim();
            const company = document.getElementById('appCompany').value.trim();
            
            if (!title || !company) {
                alert('Please enter job title and company');
                return;
            }
            
            const newApp = {
                id: Date.now(),
                title: title,
                company: company,
                appliedDate: document.getElementById('appDate').value,
                status: document.getElementById('appStatus').value,
                salary: document.getElementById('appSalary').value.trim(),
                matchScore: document.getElementById('appMatch').value ? parseInt(document.getElementById('appMatch').value) : null,
                url: document.getElementById('appUrl').value.trim(),
                nextFollowUp: document.getElementById('appFollowUp').value || null,
                notes: document.getElementById('appNotes').value.trim()
            };
            
            if (!userData.applications) userData.applications = [];
            userData.applications.unshift(newApp);
            
            saveUserData();
            closeExportModal();
            renderApplications();
            
            alert('Application added successfully!');
        }
        
        function updateApplicationStatus(idx) {
            const app = userData.applications[idx];
            const newStatus = prompt(`Update status for "${app.title}":\n\n1 = Applied\n2 = Interviewing\n3 = Offer\n4 = Closed\n\nEnter number:`, 
                                     app.status === 'applied' ? '1' : app.status === 'interviewing' ? '2' : app.status === 'offer' ? '3' : '4');
            
            if (newStatus) {
                const statusMap = {'1': 'applied', '2': 'interviewing', '3': 'offer', '4': 'rejected'};
                userData.applications[idx].status = statusMap[newStatus] || app.status;
                saveUserData();
                renderApplications();
            }
        }
        
        function editApplication(idx) {
            const app = userData.applications[idx];
            const modal = document.getElementById('exportModal');
            const modalContent = modal.querySelector('.modal-content');
            
            modalContent.innerHTML = `
                <div class="modal-header">
                    <div class="modal-header-left">
                        <h2 class="modal-title">Edit Application</h2>
                    </div>
                    <button class="modal-close" onclick="closeExportModal()">√ó</button>
                </div>
                <div class="modal-body" style="padding: 30px;">
                    <div style="display: grid; gap: 20px;">
                        <div>
                            <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">Job Title</label>
                            <input type="text" id="editAppTitle" value="${app.title}" class="settings-input">
                        </div>
                        
                        <div>
                            <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">Company</label>
                            <input type="text" id="editAppCompany" value="${app.company}" class="settings-input">
                        </div>
                        
                        <div>
                            <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">Status</label>
                            <select id="editAppStatus" class="settings-select">
                                <option value="applied" ${app.status === 'applied' ? 'selected' : ''}>Applied</option>
                                <option value="interviewing" ${app.status === 'interviewing' ? 'selected' : ''}>Interviewing</option>
                                <option value="offer" ${app.status === 'offer' ? 'selected' : ''}>Offer Received</option>
                                <option value="rejected" ${app.status === 'rejected' ? 'selected' : ''}>Closed</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">Follow-Up Date</label>
                            <input type="date" id="editAppFollowUp" value="${app.nextFollowUp || ''}" class="settings-input">
                        </div>
                        
                        <div>
                            <label style="color: #60a5fa; font-weight: 600; display: block; margin-bottom: 8px;">Notes</label>
                            <textarea id="editAppNotes" class="purpose-editor" style="min-height: 80px;">${app.notes || ''}</textarea>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 25px;">
                        <button class="action-btn" onclick="closeExportModal()">Cancel</button>
                        <button class="export-btn-large" onclick="saveApplicationEdit(${idx})">üíæ Save Changes</button>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }
        
        function saveApplicationEdit(idx) {
            userData.applications[idx].title = document.getElementById('editAppTitle').value;
            userData.applications[idx].company = document.getElementById('editAppCompany').value;
            userData.applications[idx].status = document.getElementById('editAppStatus').value;
            userData.applications[idx].nextFollowUp = document.getElementById('editAppFollowUp').value || null;
            userData.applications[idx].notes = document.getElementById('editAppNotes').value.trim();
            
            saveUserData();
            closeExportModal();
            renderApplications();
        }
        
        function deleteApplication(idx) {
            const app = userData.applications[idx];
            if (confirm(`Remove "${app.title}" at ${app.company} from tracker?`)) {
                userData.applications.splice(idx, 1);
                saveUserData();
                renderApplications();
            }
        }
        
        // ===== CONSENT & SHARING SYSTEM =====
        
        let sharePresets = {
            'full': { name: 'Full Transparency', skills: 'all', outcomes: 'all', values: 'all', purpose: true },
            'executive': { name: 'Executive Brief', skills: 'top20', outcomes: 'all', values: 'all', purpose: true },
            'advisory': { name: 'Advisory Pitch', skills: 'strategic', outcomes: 'strategic', values: 'all', purpose: true },
            'board': { name: 'Board Candidate', skills: 'leadership', outcomes: 'business', values: 'selected', purpose: true },
            'custom': { name: 'Custom', skills: 'selected', outcomes: 'selected', values: 'selected', purpose: true }
        };
        
        let currentPreset = 'custom';
        
        function initConsent() {
            const view = document.getElementById('consentView');
            
            view.innerHTML = `
                <div class="blueprint-container">
                    <div class="blueprint-header">
                        <h1 class="blueprint-title">Consent & Sharing</h1>
                        <p class="blueprint-subtitle">Your Data, Your Control</p>
                        <p class="blueprint-tagline">Choose exactly what you share and with whom</p>
                    </div>
                    
                    ${renderSharePresets()}
                    ${renderSharingStatus()}
                    ${renderLegalSection()}
                </div>
            `;
        }
        
        function renderSharePresets() {
            return `
                <div class="blueprint-section">
                    <div class="blueprint-section-header">
                        <div class="blueprint-section-title">
                            <span class="section-icon">üéöÔ∏è</span>
                            <span>Share Profile Presets</span>
                        </div>
                    </div>
                    
                    <div class="coaching-tip">
                        <div class="coaching-tip-title">
                            üí° CHOOSE YOUR SHARING LEVEL
                        </div>
                        <div class="coaching-tip-content">
                            Select a preset that matches your audience, or use Custom to choose exactly what to share.
                            All presets respect your individual item toggles from the Work Blueprint.
                        </div>
                    </div>
                    
                    <div class="values-grid">
                        ${Object.entries(sharePresets).map(([key, preset]) => renderPresetCard(key, preset)).join('')}
                    </div>
                </div>
            `;
        }
        
        function renderPresetCard(key, preset) {
            const selectedClass = currentPreset === key ? 'selected' : '';
            const descriptions = {
                'full': 'Share everything - all 73 skills, outcomes, values, and purpose',
                'executive': 'Top 20 skills + all outcomes and values - ideal for executive search',
                'advisory': 'Strategic & thought leadership skills + relevant outcomes - for advisory/consulting',
                'board': 'Leadership & business outcomes + governance experience - for board positions',
                'custom': 'You choose exactly which skills, outcomes, and values to share'
            };
            
            return `
                <div class="value-card ${selectedClass}" onclick="selectPreset('${key}')">
                    <div class="value-title">${preset.name}</div>
                    <div class="value-description">${descriptions[key]}</div>
                </div>
            `;
        }
        
        function renderSharingStatus() {
            const sharedSkills = currentPreset === 'all' ? skillsData.skills.length : 
                                currentPreset === 'top20' ? 20 :
                                skillsData.skills.filter((s, idx) => idx < 20).length;
            const sharedOutcomes = blueprintData.outcomes.filter(o => o.shared).length;
            const sharedValues = blueprintData.values.filter(v => v.selected).length;
            
            return `
                <div class="blueprint-section">
                    <div class="blueprint-section-header">
                        <div class="blueprint-section-title">
                            <span class="section-icon">üìä</span>
                            <span>What You're Sharing</span>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div style="background: rgba(96, 165, 250, 0.1); border: 1px solid rgba(96, 165, 250, 0.3); border-radius: 8px; padding: 20px; text-align: center;">
                            <div style="font-size: 2em; color: #60a5fa; font-weight: bold;">${sharedSkills}</div>
                            <div style="color: #9ca3af; margin-top: 5px;">Skills</div>
                        </div>
                        <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 8px; padding: 20px; text-align: center;">
                            <div style="font-size: 2em; color: #10b981; font-weight: bold;">${sharedOutcomes}</div>
                            <div style="color: #9ca3af; margin-top: 5px;">Outcomes</div>
                        </div>
                        <div style="background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 8px; padding: 20px; text-align: center;">
                            <div style="font-size: 2em; color: #fbbf24; font-weight: bold;">${sharedValues}</div>
                            <div style="color: #9ca3af; margin-top: 5px;">Values</div>
                        </div>
                        <div style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 8px; padding: 20px; text-align: center;">
                            <div style="font-size: 2em; color: #a78bfa; font-weight: bold;">‚úì</div>
                            <div style="color: #9ca3af; margin-top: 5px;">Purpose</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: rgba(251, 191, 36, 0.1); border-left: 3px solid #fbbf24; border-radius: 4px;">
                        <strong style="color: #fbbf24;">Note:</strong> 
                        <span style="color: #d1d5db;">Sensitive content (recovery, personal loss) is flagged in Work Blueprint. Review before sharing.</span>
                    </div>
                </div>
            `;
        }
        
        function renderLegalSection() {
            return `
                <div class="blueprint-section">
                    <div class="blueprint-section-header">
                        <div class="blueprint-section-title">
                            <span class="section-icon">‚öñÔ∏è</span>
                            <span>Legal & Privacy</span>
                        </div>
                    </div>
                    
                    <div style="color: #d1d5db; line-height: 1.7;">
                        <h3 style="color: #60a5fa; margin-bottom: 15px;">Your Rights & Protections</h3>
                        
                        <p style="margin-bottom: 20px;">
                            Your Work Blueprint data is stored locally in your browser. You have complete control over what you share, 
                            when you share it, and with whom. This tool respects your privacy and employment data rights.
                        </p>
                        
                        <h4 style="color: #60a5fa; margin-bottom: 10px; margin-top: 20px;">Relevant Privacy Laws:</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li style="padding: 10px; background: rgba(255, 255, 255, 0.03); margin-bottom: 8px; border-radius: 6px;">
                                <strong>üá∫üá∏ CCPA (California Consumer Privacy Act)</strong><br>
                                <span style="font-size: 0.9em; color: #9ca3af;">
                                    Right to know what data is collected, right to delete, right to opt-out of sale
                                </span><br>
                                <a href="https://oag.ca.gov/privacy/ccpa" target="_blank" style="color: #60a5fa; text-decoration: none; font-size: 0.85em;">Learn more ‚Üí</a>
                            </li>
                            <li style="padding: 10px; background: rgba(255, 255, 255, 0.03); margin-bottom: 8px; border-radius: 6px;">
                                <strong>üá™üá∫ GDPR (General Data Protection Regulation)</strong><br>
                                <span style="font-size: 0.9em; color: #9ca3af;">
                                    Right to access, rectify, erase, and port your personal data
                                </span><br>
                                <a href="https://gdpr.eu/" target="_blank" style="color: #60a5fa; text-decoration: none; font-size: 0.85em;">Learn more ‚Üí</a>
                            </li>
                            <li style="padding: 10px; background: rgba(255, 255, 255, 0.03); margin-bottom: 8px; border-radius: 6px;">
                                <strong>üìã Employment Data Rights (US)</strong><br>
                                <span style="font-size: 0.9em; color: #9ca3af;">
                                    Employers must handle your data fairly and can't discriminate based on protected characteristics
                                </span><br>
                                <a href="https://www.eeoc.gov/" target="_blank" style="color: #60a5fa; text-decoration: none; font-size: 0.85em;">EEOC Guidelines ‚Üí</a>
                            </li>
                        </ul>
                        
                        <h4 style="color: #60a5fa; margin-bottom: 10px; margin-top: 25px;">Best Practices:</h4>
                        <ul style="margin-left: 20px; color: #d1d5db;">
                            <li style="margin: 8px 0;">Never share sensitive personal information (SSN, financial details)</li>
                            <li style="margin: 8px 0;">Review what you're sharing before exporting or creating links</li>
                            <li style="margin: 8px 0;">Use time-limited shareable links when possible</li>
                            <li style="margin: 8px 0;">Keep Work Blueprint data up to date but don't embellish</li>
                            <li style="margin: 8px 0;">Consider context before sharing recovery/advocacy work</li>
                        </ul>
                    </div>
                </div>
            `;
        }
        
        function saveSettings() {
            // Get values from form
            userData.profile.name = document.getElementById('settingName').value;
            userData.profile.email = document.getElementById('settingEmail').value;
            userData.profile.location = document.getElementById('settingLocation').value;
            
            const newSeniority = document.getElementById('settingSeniority').value;
            userData.preferences.seniorityLevel = newSeniority;
            userData.preferences.minimumMatchScore = parseInt(document.querySelector('#settingsView .match-slider').value);
            userData.preferences.minimumSkillMatches = parseInt(document.getElementById('settingMinSkills').value);
            const minSalaryInput = document.getElementById('settingMinSalary').value;
            userData.preferences.minSalary = minSalaryInput ? parseInt(minSalaryInput) : null;
            
            // Update seniority keywords based on level
            if (newSeniority === 'Entry') {
                userData.preferences.seniorityKeywords = ['junior', 'associate', 'entry', 'coordinator'];
                userData.preferences.excludeRoles = ['senior', 'lead', 'manager', 'director', 'vp', 'chief', 'principal'];
            } else if (newSeniority === 'Mid') {
                userData.preferences.seniorityKeywords = ['senior', 'lead', 'manager', 'specialist'];
                userData.preferences.excludeRoles = ['junior', 'entry', 'associate', 'intern'];
            } else if (newSeniority === 'Senior') {
                userData.preferences.seniorityKeywords = ['senior manager', 'director', 'senior director', 'principal'];
                userData.preferences.excludeRoles = ['junior', 'entry', 'mid-level', 'associate'];
            } else { // Executive
                userData.preferences.seniorityKeywords = ['vp', 'vice president', 'chief', 'head of', 'director', 'principal', 'senior director'];
                userData.preferences.excludeRoles = ['engineer', 'developer', 'designer', 'analyst', 'coordinator', 'specialist', 
                                                    'junior', 'mid-level', 'associate', 'intern', 'entry'];
            }
            
            // Update header
            const userNameEl = document.getElementById('userName');
            if (userData.profile.name) {
                userNameEl.textContent = userData.profile.name + "'s";
            } else {
                userNameEl.textContent = "Your";
            }
            
            // Save to localStorage
            saveUserData();
            
            alert('Settings saved successfully!\n\nGo to Opportunities tab and click "Find Matching Jobs" to see updated results.');
        }
        
        function selectPreset(key) {
            currentPreset = key;
            initConsent(); // Re-render to show selection
            
            // Apply preset logic (for future export functionality)
            if (key === 'full') {
                // Mark all items as shared
                blueprintData.outcomes.forEach(o => o.shared = true);
                blueprintData.values.forEach(v => v.selected = true);
            }
            // Other presets would filter accordingly during export
        }
        
        function searchSkills(searchTerm) {
            const term = searchTerm.toLowerCase().trim();
            
            if (currentSkillsView === 'network') {
                // Filter network nodes
                const svg = d3.select("#networkView");
                const nodes = svg.selectAll(".node");
                
                nodes.style("opacity", function(d) {
                    if (d.type !== "skill") return 1;  // Keep center and roles visible
                    if (!term) return 1;  // No search, show all
                    return d.name.toLowerCase().includes(term) ? 1 : 0.1;
                });
                
                // Also filter text labels
                const labels = svg.selectAll(".node-label");
                labels.style("opacity", function(d) {
                    if (d.type !== "skill") return 1;
                    if (!term) return 1;
                    return d.name.toLowerCase().includes(term) ? 1 : 0.1;
                });
                
            } else {
                // Filter card view
                const cards = document.querySelectorAll('.skill-card');
                cards.forEach(card => {
                    const skillName = card.querySelector('h3').textContent.toLowerCase();
                    if (!term || skillName.includes(term)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }
        }
        
        function showValuationBreakdown() {
            const totalValue = calculateTotalMarketValue();
            const modal = document.getElementById('exportModal');
            const modalContent = modal.querySelector('.modal-content');
            
            modalContent.innerHTML = `
                <div class="modal-header">
                    <div class="modal-header-left">
                        <h2 class="modal-title">Market Valuation Breakdown</h2>
                        <p style="color: #9ca3af; margin-top: 5px;">Complete analysis of your $${totalValue.total.toLocaleString()}/year value</p>
                    </div>
                    <button class="modal-close" onclick="closeExportModal()">√ó</button>
                </div>
                <div class="modal-body" style="padding: 30px; max-height: 70vh; overflow-y: auto;">
                    <div style="background: rgba(16, 185, 129, 0.1); padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                        <div style="font-size: 2em; font-weight: 700; color: #10b981; margin-bottom: 10px;">
                            $${totalValue.total.toLocaleString()}/year
                        </div>
                        <div style="color: #d1d5db;">
                            Total Market Value (${userData.profile.location})
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 25px;">
                        <h3 style="color: #60a5fa; margin-bottom: 15px;">All ${skillsData.skills.length} Skills (Sorted by Value)</h3>
                        <div style="display: grid; gap: 8px; max-height: 400px; overflow-y: auto; padding-right: 10px;">
                            ${totalValue.breakdown.sort((a, b) => b.value - a.value).map((skill, idx) => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(255, 255, 255, 0.03); border-radius: 6px; border-left: 3px solid ${idx < 10 ? '#10b981' : 'rgba(255,255,255,0.1)'};">
                                    <div style="flex: 1;">
                                        <span style="color: #9ca3af; margin-right: 8px; font-size: 0.9em;">${idx + 1}.</span>
                                        <span style="color: #e0e0e0;">${skill.skill}</span>
                                        <span style="color: #9ca3af; font-size: 0.85em; margin-left: 8px;">(${skill.level})</span>
                                    </div>
                                    <div style="color: ${idx < 10 ? '#10b981' : '#9ca3af'}; font-weight: 600; min-width: 100px; text-align: right;">
                                        $${skill.value.toLocaleString()}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="background: rgba(96, 165, 250, 0.1); padding: 20px; border-radius: 8px;">
                        <h3 style="color: #60a5fa; margin-bottom: 15px;">Value Calculation</h3>
                        <div style="color: #d1d5db; line-height: 1.8;">
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <span>Base Skills Total:</span>
                                <strong>$${totalValue.baseTotal.toLocaleString()}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <span>Rarity Bonuses:</span>
                                <strong style="color: #10b981;">+$${totalValue.rarity.toLocaleString()}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; font-size: 1.2em; margin-top: 10px;">
                                <strong>Total Market Value:</strong>
                                <strong style="color: #10b981;">$${totalValue.total.toLocaleString()}</strong>
                            </div>
                        </div>
                    </div>
                    
                    <button class="export-btn-large" onclick="closeExportModal()" style="width: 100%; margin-top: 25px;">
                        Close
                    </button>
                </div>
            `;
            
            modal.classList.add('active');
        }
        
        function showNegotiationGuide() {
            const totalValue = calculateTotalMarketValue();
            const negotiationGap = totalValue.yourWorth - totalValue.standardOffer;
            
            const modal = document.getElementById('exportModal');
            const modalContent = modal.querySelector('.modal-content');
            
            modalContent.innerHTML = `
                <div class="modal-header">
                    <div class="modal-header-left">
                        <h2 class="modal-title">üíº Salary Negotiation Strategy</h2>
                        <p style="color: #9ca3af; margin-top: 5px;">Compa-ratio based negotiation guidance</p>
                    </div>
                    <button class="modal-close" onclick="closeExportModal()">√ó</button>
                </div>
                <div class="modal-body" style="padding: 30px; max-height: 70vh; overflow-y: auto;">
                    <div style="background: rgba(16, 185, 129, 0.1); padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                        <div style="color: #10b981; font-weight: 600; margin-bottom: 10px;">Your Market Worth</div>
                        <div style="font-size: 2em; font-weight: 700; color: #e0e0e0;">
                            $${totalValue.yourWorth.toLocaleString()}/year
                        </div>
                        <div style="color: #9ca3af; margin-top: 8px;">
                            ${totalValue.roleLevel} ‚Ä¢ ${totalValue.compaRatio}% compa-ratio ‚Ä¢ ${userData.profile.location}
                        </div>
                    </div>
                    
                    <div style="background: rgba(96, 165, 250, 0.1); padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                        <h3 style="color: #60a5fa; margin-bottom: 15px;">üìä Understanding Compa-Ratios</h3>
                        <div style="color: #d1d5db; font-size: 0.95em; line-height: 1.7;">
                            <strong>Compa-ratio</strong> = Your salary √∑ Market median √ó 100%
                            <br><br>
                            <strong>How Companies Use This:</strong>
                            <br>‚Ä¢ <strong>80-120%</strong> = Acceptable range
                            <br>‚Ä¢ <strong>100%</strong> = Exactly at market median
                            <br>‚Ä¢ <strong>&lt;80%</strong> = Underpaid (flight risk)
                            <br>‚Ä¢ <strong>&gt;120%</strong> = Overpaid for role
                            <br><br>
                            <strong>Market Rate (50th percentile):</strong> $${totalValue.marketRate.toLocaleString()}
                            <br><strong>Your Worth (with premiums):</strong> $${totalValue.yourWorth.toLocaleString()} (${totalValue.compaRatio}%)
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 25px;">
                        <h3 style="color: #fbbf24; margin-bottom: 15px;">üí∞ Expected Offer Ranges</h3>
                        <div style="color: #9ca3af; font-size: 0.9em; margin-bottom: 15px;">
                            Companies typically offer <strong>75-95%</strong> of your market worth. Here's what to expect:
                        </div>
                        
                        <div style="background: rgba(107, 114, 128, 0.2); padding: 15px; border-radius: 8px; margin-bottom: 12px; border-left: 3px solid #9ca3af;">
                            <div style="color: #9ca3af; font-weight: 600; margin-bottom: 5px;">Conservative Offer (75%)</div>
                            <div style="font-size: 1.3em; color: #e0e0e0; font-weight: 600;">
                                $${totalValue.conservativeOffer.toLocaleString()}
                            </div>
                            <div style="color: #9ca3af; font-size: 0.9em; margin-top: 5px;">
                                Budget-constrained companies ‚Ä¢ Startups ‚Ä¢ Non-profits
                            </div>
                        </div>
                        
                        <div style="background: rgba(96, 165, 250, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 12px; border-left: 3px solid #60a5fa;">
                            <div style="color: #60a5fa; font-weight: 600; margin-bottom: 5px;">Standard Offer (85%) ‚Üê Most Common</div>
                            <div style="font-size: 1.3em; color: #e0e0e0; font-weight: 600;">
                                $${totalValue.standardOffer.toLocaleString()}
                            </div>
                            <div style="color: #9ca3af; font-size: 0.9em; margin-top: 5px;">
                                Typical initial offers ‚Ä¢ Room to negotiate up
                            </div>
                        </div>
                        
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                            <div style="color: #10b981; font-weight: 600; margin-bottom: 5px;">Competitive Offer (95%)</div>
                            <div style="font-size: 1.3em; color: #e0e0e0; font-weight: 600;">
                                $${totalValue.competitiveOffer.toLocaleString()}
                            </div>
                            <div style="color: #9ca3af; font-size: 0.9em; margin-top: 5px;">
                                High-demand roles ‚Ä¢ Top-tier companies ‚Ä¢ Multiple offers
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px; padding: 15px; background: rgba(251, 191, 36, 0.2); border-radius: 8px;">
                            <div style="color: #fbbf24; font-weight: 600; margin-bottom: 5px;">üí° Your Negotiation Gap</div>
                            <div style="color: #d1d5db; font-size: 0.95em;">
                                <strong>$${negotiationGap.toLocaleString()}</strong> between standard offer and your worth
                                <br>This is your leverage. Start at your worth ($${totalValue.yourWorth.toLocaleString()}) and negotiate down to competitive range ($${totalValue.competitiveOffer.toLocaleString()}+).
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(251, 191, 36, 0.1); padding: 20px; border-radius: 8px; border-left: 3px solid #fbbf24; margin-bottom: 25px;">
                        <h3 style="color: #fbbf24; margin-bottom: 15px;">üéØ Your Talking Points</h3>
                        <div style="color: #d1d5db; line-height: 1.8;">
                            <p style="margin-bottom: 15px;">
                                <strong style="color: #fbbf24;">1. Lead with Your Worth:</strong><br>
                                "Based on my skill profile and market analysis, my value is in the $${Math.round(totalValue.yourWorth * 0.95 / 1000) * 1000}-$${Math.round(totalValue.yourWorth * 1.05 / 1000) * 1000} range for ${totalValue.roleLevel} roles in ${userData.profile.location}."
                            </p>
                            <p style="margin-bottom: 15px;">
                                <strong style="color: #fbbf24;">2. Reference Your Top 10 Skills:</strong><br>
                                "I bring ${totalValue.top10Skills.filter(s => s.level === 'Mastery').length} mastery-level skills including ${totalValue.top10Skills.slice(0, 3).map(s => s.skill).join(', ')}. These command premiums in the current market."
                            </p>
                            <p style="margin-bottom: 15px;">
                                <strong style="color: #fbbf24;">3. Show the Data:</strong><br>
                                "The market rate for ${totalValue.roleLevel} is $${totalValue.marketRate.toLocaleString()}. My AI and strategy expertise justify a ${Math.round((totalValue.domainPremium + totalValue.rarityBonus) * 100)}% premium."
                            </p>
                            <p style="margin-bottom: 15px;">
                                <strong style="color: #fbbf24;">4. Use Your Outcomes:</strong><br>
                                "I've consistently delivered [cite 2-3 quantified outcomes from your Work Blueprint]. This track record supports my valuation."
                            </p>
                        </div>
                    </div>
                    
                    <div style="background: rgba(96, 165, 250, 0.1); padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                        <h3 style="color: #60a5fa; margin-bottom: 15px;">üìã Negotiation Script</h3>
                        <div style="color: #d1d5db; line-height: 1.8; font-size: 0.95em;">
                            <strong>When they ask for salary expectations:</strong>
                            <br><br>
                            <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 6px; margin: 10px 0; font-style: italic;">
                            "I appreciate you asking. Based on my research and skill profile, I'm looking at the $${Math.round(totalValue.competitiveOffer / 1000) * 1000}-$${Math.round(totalValue.yourWorth / 1000) * 1000} range. But I'm flexible depending on the total compensation package, including equity and benefits. What range were you considering?"
                            </div>
                            <br>
                            <strong>When they give a low offer ($${totalValue.conservativeOffer.toLocaleString()}):</strong>
                            <br><br>
                            <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 6px; margin: 10px 0; font-style: italic;">
                            "I appreciate the offer. Based on market data for ${totalValue.roleLevel} roles with my skill set‚Äîparticularly my ${totalValue.top10Skills[0].skill} expertise‚Äîthe range is typically closer to $${totalValue.standardOffer.toLocaleString()}-$${totalValue.competitiveOffer.toLocaleString()}. Can we explore options in that range?"
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(96, 165, 250, 0.1); padding: 20px; border-radius: 8px;">
                        <h3 style="color: #60a5fa; margin-bottom: 15px;">‚úì Best Practices</h3>
                        <div style="color: #d1d5db; line-height: 1.8;">
                            <div style="margin-bottom: 15px;">
                                <strong style="color: #10b981;">DO:</strong>
                                <ul style="margin-left: 20px; margin-top: 8px;">
                                    <li>Start at your worth ($${totalValue.yourWorth.toLocaleString()})</li>
                                    <li>Reference the $${negotiationGap.toLocaleString()} gap as your leverage</li>
                                    <li>Cite your top 10 skills as justification</li>
                                    <li>Ask about total comp (equity, bonus, benefits)</li>
                                    <li>Get offers in writing before negotiating</li>
                                </ul>
                            </div>
                            <div>
                                <strong style="color: #ef4444;">DON'T:</strong>
                                <ul style="margin-left: 20px; margin-top: 8px;">
                                    <li>Accept the first offer‚Äîthey expect negotiation</li>
                                    <li>Give a range first‚Äîmake them lead</li>
                                    <li>Focus only on base salary</li>
                                    <li>Negotiate without data</li>
                                    <li>Accept below $${totalValue.conservativeOffer.toLocaleString()} (75%)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <button class="export-btn-large" onclick="closeExportModal()" style="width: 100%; margin-top: 25px;">
                        Close Guide
                    </button>
                </div>
            `;
            
            modal.classList.add('active');
        }
        
        // Resize handler
        window.addEventListener('resize', () => {
            if (currentView === 'network') {
                initNetwork();
            }
        });
    </script>
</body>
</html>